# 端口配置说明

## 默认端口

### VabHub 默认端口：**8092**

**选择原因**：
- ✅ 避免与常见NAS系统端口冲突
  - Synology DSM：5000（HTTP）、5001（HTTPS）、8000（HTTP）、8001（HTTPS）
  - QNAP QTS：8080（HTTP）、8081（HTTPS）
- ✅ 避免与下载器端口冲突
  - qBittorrent：8080
  - Transmission：9091
- ✅ 避免与媒体库端口冲突
  - Emby：8096
  - Jellyfin：8096
  - Plex：32400
- ✅ 避免与其他常见服务端口冲突
  - 6000、6001（某些服务）
  - 8080（HTTP代理）

---

## 常见端口冲突列表

| 服务/系统 | 默认端口 | 说明 |
|----------|---------|------|
| **NAS系统** | | |
| Synology DSM | 5000, 5001, 8000, 8001 | HTTP/HTTPS管理端口 |
| QNAP QTS | 8080, 8081 | HTTP/HTTPS管理端口 |
| **下载器** | | |
| qBittorrent | 8080 | Web UI端口 |
| Transmission | 9091 | Web UI端口 |
| **媒体库** | | |
| Emby | 8096 | Web UI端口 |
| Jellyfin | 8096 | Web UI端口 |
| Plex | 32400 | Web UI端口 |
| **其他服务** | | |
| HTTP代理 | 8080 | 常见代理端口 |
| 其他服务 | 6000, 6001 | 某些应用服务 |

---

## 端口配置方法

### 方法1：环境变量（推荐）

```bash
# 临时修改
export PORT=8092
python main.py

# 永久修改（添加到 ~/.bashrc 或 ~/.zshrc）
echo 'export PORT=8092' >> ~/.bashrc
source ~/.bashrc
```

### 方法2：修改配置文件

编辑 `VabHub/backend/app/core/config.py`：

```python
PORT: int = int(os.getenv("PORT", "8092"))
```

### 方法3：Docker环境变量

```yaml
# docker-compose.yml
environment:
  - PORT=8092
```

或

```bash
docker run -e PORT=8092 ...
```

---

## 访问方式

### 本地访问
```
http://localhost:8092
http://127.0.0.1:8092
```

### 局域网访问
```
http://192.168.x.x:8092
```

### 通过Nginx反向代理（推荐生产环境）
```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    location / {
        proxy_pass http://localhost:8092;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

---

## 前端配置

前端会自动从环境变量读取API地址，或使用默认值：

```typescript
// 默认值
const baseURL = import.meta.env.VITE_API_BASE_URL || 'http://localhost:8092/api/v1'
```

### 修改前端API地址

创建 `.env` 文件：

```bash
# .env
VITE_API_BASE_URL=http://localhost:8092/api/v1
```

或

```bash
# .env.production
VITE_API_BASE_URL=https://your-domain.com/api/v1
```

---

## 测试脚本端口

所有测试脚本已更新为使用端口 **8092**：

- `check_backend_health.py`
- `test_subscription_rule_engine.py`
- `test_subscription_history.py`
- `test_subscription_status.py`
- `test_system_monitoring.py`
- `test_all_new_features.py`

---

## 端口检查

### 检查端口是否被占用

**Linux/macOS**:
```bash
lsof -i :8092
# 或
netstat -an | grep 8092
```

**Windows**:
```cmd
netstat -ano | findstr :8092
```

### 如果端口被占用

1. **更换端口**：使用环境变量设置其他端口（如8093、8094等）
2. **停止占用端口的服务**：找到占用端口的进程并停止
3. **使用Nginx反向代理**：将应用绑定到其他端口，通过Nginx访问

---

## 推荐端口范围

如果8092也被占用，可以考虑以下端口：

- **8092** - 默认推荐（当前使用）
- **8093** - 备选方案1
- **8094** - 备选方案2
- **8095** - 备选方案3
- **8097** - 备选方案4（避免8096 Emby/Jellyfin）

**注意**：避免使用以下端口范围：
- 5000-5001（Synology DSM）
- 6000-6001（某些服务）
- 8000-8001（Synology DSM）
- 8080-8081（QNAP/qBittorrent）
- 8096（Emby/Jellyfin）

---

## 总结

- ✅ **默认端口**：8092
- ✅ **可配置**：通过环境变量 `PORT` 修改
- ✅ **避免冲突**：不与常见NAS/下载器/媒体库端口冲突
- ✅ **测试脚本**：已更新为使用8092端口

---

**最后更新**：2025-11-13

