# é˜¶æ®µ1å®æ–½å®Œæˆæ€»ç»“

## âœ… å®Œæˆæ—¶é—´
2025-11-14

---

## ğŸ“‹ å®æ–½å†…å®¹

### 1. âœ… ä¿®æ”¹é…ç½® (`backend/app/core/config.py`)

**æ·»åŠ çš„é…ç½®å­—æ®µ**:
```python
# ================== Intel / Shared Intelligence é…ç½® ==================
INTEL_ENABLED: bool = os.getenv("INTEL_ENABLED", "true").lower() == "true"
INTEL_MODE: str = os.getenv("INTEL_MODE", "local")  # local | cloud | hybrid
INTEL_SCHEDULER_ENDPOINT: str = os.getenv("INTEL_SCHEDULER_ENDPOINT", "https://mesh.hbnetwork.top")
INTEL_INTEL_ENDPOINT: str = os.getenv("INTEL_INTEL_ENDPOINT", "https://intel.hbnetwork.top")
INTEL_SNAPSHOT_BASE_URL: str = os.getenv("INTEL_SNAPSHOT_BASE_URL", "https://snap.hbnetwork.top")
INTEL_FALLBACK_TO_LOCAL: bool = os.getenv("INTEL_FALLBACK_TO_LOCAL", "true").lower() == "true"
```

**é…ç½®è¯´æ˜**:
- `INTEL_ENABLED`: æ˜¯å¦å¯ç”¨IntelåŠŸèƒ½ï¼ˆé»˜è®¤ï¼štrueï¼‰
- `INTEL_MODE`: è¿è¡Œæ¨¡å¼ï¼ˆlocal/cloud/hybridï¼Œé»˜è®¤ï¼šlocalï¼‰
- `INTEL_SCHEDULER_ENDPOINT`: Meshè°ƒåº¦ä¸­å¿ƒç«¯ç‚¹
- `INTEL_INTEL_ENDPOINT`: Intelæ™ºèƒ½å¤§è„‘ç«¯ç‚¹
- `INTEL_SNAPSHOT_BASE_URL`: å¿«ç…§CDNç«¯ç‚¹
- `INTEL_FALLBACK_TO_LOCAL`: äº‘ç«¯å¤±è´¥æ—¶æ˜¯å¦é™çº§åˆ°æœ¬åœ°ï¼ˆé»˜è®¤ï¼štrueï¼‰

---

### 2. âœ… åˆ›å»ºIntelæœåŠ¡ (`backend/app/core/intel/service.py`)

**åˆ›å»ºçš„æ–‡ä»¶**:
- `backend/app/core/intel/__init__.py` - æ¨¡å—åˆå§‹åŒ–
- `backend/app/core/intel/service.py` - IntelæœåŠ¡å®ç°

**å®ç°çš„åŠŸèƒ½**:
1. **IntelServiceæŠ½è±¡æ¥å£**
   - `resolve_title()` - è§£ææ ‡é¢˜ï¼Œè¿”å›æ ‡å‡†åŒ–ä½œå“ä¿¡æ¯
   - `get_release_sites()` - è·å–å‘å¸ƒåœ¨å„ç«™ç‚¹çš„åˆ†å¸ƒä¿¡æ¯

2. **LocalIntelServiceï¼ˆæœ¬åœ°å®ç°ï¼‰**
   - ä½¿ç”¨JSONæ–‡ä»¶å­˜å‚¨åˆ«åå’Œç´¢å¼•
   - æ•°æ®ç›®å½•ï¼š`backend/data/intel/`
   - æ”¯æŒæ¨¡ç³ŠåŒ¹é…
   - è‡ªåŠ¨åŠ è½½æ•°æ®

3. **CloudIntelServiceï¼ˆäº‘ç«¯å®ç°ï¼‰**
   - HTTPè¯·æ±‚äº‘ç«¯API
   - è¶…æ—¶å¤„ç†ï¼ˆ5ç§’ï¼‰
   - é”™è¯¯å¤„ç†

4. **HybridIntelServiceï¼ˆæ··åˆå®ç°ï¼‰**
   - äº‘ç«¯ä¼˜å…ˆï¼ˆ5ç§’è¶…æ—¶ï¼‰
   - å¤±è´¥è‡ªåŠ¨é™çº§æœ¬åœ°
   - æ ¹æ®é…ç½®æ§åˆ¶é™çº§

5. **å·¥å‚å‡½æ•°**
   - `get_intel_service()` - æ ¹æ®é…ç½®è¿”å›å¯¹åº”å®ç°

---

### 3. âœ… é›†æˆæœç´¢æœåŠ¡ (`backend/app/modules/search/service.py`)

**ä¿®æ”¹å†…å®¹**:
1. **æ·»åŠ import**
   ```python
   from app.core.intel.service import get_intel_service, IntelService
   ```

2. **åœ¨__init__ä¸­æ³¨å…¥IntelæœåŠ¡**
   ```python
   self.intel: IntelService = get_intel_service()
   ```

3. **åœ¨search()æ–¹æ³•ä¸­æ·»åŠ Intelé¢„å¤„ç†**
   - è°ƒç”¨ `intel.resolve_title()` æ ‡å‡†åŒ–æ ‡é¢˜
   - è°ƒç”¨ `intel.get_release_sites()` è·å–ä¼˜å…ˆç«™ç‚¹
   - ä½¿ç”¨æ ‡å‡†åŒ–æŸ¥è¯¢å’Œä¼˜å…ˆç«™ç‚¹è¿›è¡Œæœç´¢

**å·¥ä½œæµç¨‹**:
1. ç”¨æˆ·è¾“å…¥æœç´¢å…³é”®è¯
2. IntelæœåŠ¡è§£ææ ‡é¢˜ï¼Œè·å–æ ‡å‡†åŒ–ä¿¡æ¯
3. å¦‚æœæœ‰release_keyï¼Œè·å–ä¼˜å…ˆç«™ç‚¹åˆ—è¡¨
4. ä½¿ç”¨æ ‡å‡†åŒ–æŸ¥è¯¢å’Œä¼˜å…ˆç«™ç‚¹è¿›è¡Œæœç´¢
5. è¿”å›æœç´¢ç»“æœ

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
VabHub/backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ config.py                    # âœ… å·²æ·»åŠ INTELé…ç½®
â”‚   â”‚   â””â”€â”€ intel/
â”‚   â”‚       â”œâ”€â”€ __init__.py              # âœ… æ–°å»º
â”‚   â”‚       â””â”€â”€ service.py                # âœ… æ–°å»ºï¼ˆIntelæœåŠ¡å®ç°ï¼‰
â”‚   â””â”€â”€ modules/
â”‚       â””â”€â”€ search/
â”‚           â””â”€â”€ service.py               # âœ… å·²é›†æˆIntelæœåŠ¡
â””â”€â”€ data/
    â””â”€â”€ intel/                            # æ•°æ®ç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
        â”œâ”€â”€ aliases.json                  # åˆ«åæ•°æ®ï¼ˆå¯é€‰ï¼‰
        â””â”€â”€ index.json                    # ç´¢å¼•æ•°æ®ï¼ˆå¯é€‰ï¼‰
```

---

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### 1. æœ¬åœ°æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰
- âœ… ä¸ä¾èµ–äº‘ç«¯æœåŠ¡
- âœ… ä½¿ç”¨æœ¬åœ°JSONæ–‡ä»¶å­˜å‚¨
- âœ… æ”¯æŒæ¨¡ç³ŠåŒ¹é…
- âœ… è‡ªåŠ¨åˆ›å»ºæ•°æ®ç›®å½•

### 2. äº‘ç«¯æ¨¡å¼
- âœ… HTTPè¯·æ±‚äº‘ç«¯API
- âœ… è¶…æ—¶å’Œé”™è¯¯å¤„ç†
- âœ… æ”¯æŒè‡ªå®šä¹‰ç«¯ç‚¹

### 3. æ··åˆæ¨¡å¼
- âœ… äº‘ç«¯ä¼˜å…ˆ
- âœ… è‡ªåŠ¨é™çº§æœ¬åœ°
- âœ… å¯é…ç½®é™çº§ç­–ç•¥

---

## ğŸ”§ é…ç½®ç¤ºä¾‹

### .env é…ç½®
```env
# Intelé…ç½®
INTEL_ENABLED=true
INTEL_MODE=local
INTEL_SCHEDULER_ENDPOINT=https://mesh.hbnetwork.top
INTEL_INTEL_ENDPOINT=https://intel.hbnetwork.top
INTEL_SNAPSHOT_BASE_URL=https://snap.hbnetwork.top
INTEL_FALLBACK_TO_LOCAL=true
```

### æ¨¡å¼åˆ‡æ¢
- **æœ¬åœ°æ¨¡å¼**: `INTEL_MODE=local`ï¼ˆé»˜è®¤ï¼‰
- **äº‘ç«¯æ¨¡å¼**: `INTEL_MODE=cloud`
- **æ··åˆæ¨¡å¼**: `INTEL_MODE=hybrid`

---

## ğŸ“ æ•°æ®æ ¼å¼

### åˆ«åæ•°æ®æ ¼å¼ (`data/intel/aliases.json`)
```json
{
  "å‡é¢éª‘å£« zzz": {
    "title": "å‡é¢éª‘å£« ZZZ",
    "year": 2025,
    "type": "tv",
    "tmdb_id": 123456,
    "release_key": "kamen-rider-zzz-2025-tv",
    "aliases": [
      "å‡é¢éª‘å£« ZZZ",
      "Kamen Rider ZZZ",
      "å‡é¢éª‘å£«zzz"
    ]
  }
}
```

### ç´¢å¼•æ•°æ®æ ¼å¼ (`data/intel/index.json`)
```json
{
  "kamen-rider-zzz-2025-tv": {
    "release_key": "kamen-rider-zzz-2025-tv",
    "sites": [
      {
        "site": "site1",
        "score": 100,
        "last_seen": "2025-11-14T00:00:00Z"
      }
    ]
  }
}
```

---

## âœ… æµ‹è¯•å»ºè®®

### 1. æµ‹è¯•æœ¬åœ°æ¨¡å¼
```python
# æµ‹è¯•IntelæœåŠ¡å¯¼å…¥
from app.core.intel.service import get_intel_service

intel = get_intel_service()
result = await intel.resolve_title("å‡é¢éª‘å£« ZZZ")
print(result)
```

### 2. æµ‹è¯•æœç´¢é›†æˆ
- å¯åŠ¨åç«¯æœåŠ¡
- æ‰§è¡Œæœç´¢è¯·æ±‚
- æŸ¥çœ‹æ—¥å¿—ç¡®è®¤IntelæœåŠ¡è°ƒç”¨

### 3. æµ‹è¯•æ•°æ®åŠ è½½
- åˆ›å»º `data/intel/aliases.json` æ–‡ä»¶
- æ·»åŠ æµ‹è¯•æ•°æ®
- éªŒè¯æ•°æ®åŠ è½½

---

## ğŸš€ ä¸‹ä¸€æ­¥

### é˜¶æ®µ2: äº‘ç«¯æœåŠ¡åŸºç¡€ç‰ˆ
1. éƒ¨ç½²Mesh Schedulerï¼ˆRailway + Supabase/Neonï¼‰
2. éƒ¨ç½²Intel Centerï¼ˆDeta.Spaceï¼‰
3. éƒ¨ç½²Snapshotsï¼ˆCloudflare Pages/R2ï¼‰

### é˜¶æ®µ3: æœ¬åœ°ç«¯é›†æˆäº‘ç«¯
1. é…ç½®äº‘ç«¯ç«¯ç‚¹
2. æµ‹è¯•äº‘ç«¯è¿æ¥
3. åˆ‡æ¢åˆ°Hybridæ¨¡å¼

---

## ğŸ“Š å®ŒæˆçŠ¶æ€

- âœ… é˜¶æ®µ1.1: ä¿®æ”¹config.pyæ·»åŠ INTELé…ç½®å­—æ®µ
- âœ… é˜¶æ®µ1.2: åˆ›å»ºapp/core/intel/service.pyï¼ˆIntelæœåŠ¡æŠ½è±¡å±‚ï¼‰
- âœ… é˜¶æ®µ1.3: ä¿®æ”¹SearchServiceé›†æˆIntelæœåŠ¡
- â³ é˜¶æ®µ1.4: æµ‹è¯•æœ¬åœ°IntelåŠŸèƒ½ï¼ˆå¾…æµ‹è¯•ï¼‰

---

**çŠ¶æ€**: âœ… é˜¶æ®µ1ä»£ç å®æ–½å®Œæˆï¼Œç­‰å¾…æµ‹è¯•éªŒè¯

