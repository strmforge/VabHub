# STRM系统媒体库地址栏功能实现总结

## 📋 功能概述

在STRM配置中添加了本地STRM文件存放的媒体库地址栏，支持：
- **输入路径**：用户可以直接在地址栏中输入路径
- **选择路径**：用户可以通过下拉列表选择常用路径
- **浏览按钮**：点击文件夹图标按钮可以输入新路径

## 🔧 实现详情

### 1. 后端API实现

#### 新增API端点

**获取STRM配置**：
- **端点**：`GET /api/strm/config`
- **功能**：获取STRM配置信息
- **实现**：
  - 优先从数据库读取配置（`settings` 表，`category="strm"`）
  - 如果数据库中没有配置，使用默认配置
  - 返回配置字典

**更新STRM配置**：
- **端点**：`PUT /api/strm/config`
- **功能**：更新STRM配置信息
- **实现**：
  - 更新内存中的配置对象
  - 将配置保存到数据库（`settings` 表，`category="strm"`，键名格式：`strm_{key}`）
  - 返回更新后的配置

#### 代码位置
- `VabHub/backend/app/api/strm.py`

### 2. 前端界面实现

#### Settings页面新增STRM配置分类

**位置**：`VabHub/frontend/src/pages/Settings.vue`

**新增内容**：
1. **配置分类**：在设置分类列表中添加"STRM设置"分类
2. **媒体库路径设置**：
   - 使用 `v-combobox` 组件实现路径输入和选择
   - 添加文件夹图标（`mdi-folder`）
   - 添加浏览按钮（`mdi-folder-open`）
   - 支持从下拉列表选择常用路径
   - 支持手动输入路径
3. **分类路径设置**：
   - 电影STRM文件存放路径
   - 电视剧STRM文件存放路径
   - 动漫STRM文件存放路径
   - 其他类型STRM文件存放路径
4. **STRM文件生成设置**：
   - 生成NFO文件开关
   - 生成字幕文件开关
5. **刮削设置**：
   - 对网盘文件进行刮削开关
   - 对本地STRM文件进行刮削开关

#### 路径选择功能

**实现方式**：
- 使用 `v-combobox` 组件，支持：
  - 输入路径（用户可以直接输入）
  - 选择路径（从下拉列表选择常用路径）
  - 浏览按钮（点击后弹出输入框，让用户输入新路径）

**常用路径选项**：
- 自动加载系统默认保存路径
- 预置常用路径：
  - `/media_library`
  - `/mnt/media_library`
  - `/volume1/media_library`
  - `D:/media_library`
  - `E:/media_library`
- 用户输入的路径会自动添加到选项列表

#### 代码实现

```vue
<!-- 本地STRM文件存放的媒体库地址 -->
<v-combobox
  v-model="strmConfig.media_library_path"
  :items="mediaLibraryPathOptions"
  label="本地STRM文件存放的媒体库地址 *"
  variant="outlined"
  density="compact"
  prepend-inner-icon="mdi-folder"
  hint="本地STRM文件存放的媒体库地址，可通过输入或点击选择按钮选择路径"
  persistent-hint
  class="mb-4"
  clearable
  required
>
  <template #append>
    <v-btn
      icon="mdi-folder-open"
      variant="text"
      size="small"
      @click="browseMediaLibraryPath"
      title="浏览文件夹（输入路径）"
    />
  </template>
</v-combobox>
```

## 📊 功能特性

### 1. 路径输入和选择

- ✅ **直接输入**：用户可以直接在地址栏中输入路径
- ✅ **下拉选择**：从常用路径列表中选择
- ✅ **浏览按钮**：点击文件夹图标按钮，弹出输入框输入新路径
- ✅ **路径记忆**：用户输入的路径会自动添加到选项列表

### 2. 配置持久化

- ✅ **数据库存储**：配置保存到数据库的 `settings` 表
- ✅ **分类管理**：使用 `category="strm"` 分类管理STRM配置
- ✅ **键名格式**：使用 `strm_{key}` 格式存储配置键

### 3. 配置加载

- ✅ **优先数据库**：优先从数据库读取配置
- ✅ **默认配置**：如果数据库中没有配置，使用默认配置
- ✅ **自动同步**：配置更新后自动同步到内存和数据库

## 🎯 使用方式

### 1. 访问STRM设置

1. 打开"设置"页面
2. 在左侧分类列表中选择"STRM设置"
3. 在"媒体库路径设置"部分找到"本地STRM文件存放的媒体库地址"字段

### 2. 输入或选择路径

**方式1：直接输入**
- 在地址栏中直接输入路径，如：`/mnt/media_library`

**方式2：下拉选择**
- 点击地址栏右侧的下拉箭头
- 从常用路径列表中选择一个路径

**方式3：浏览按钮**
- 点击地址栏右侧的文件夹图标按钮
- 在弹出的输入框中输入新路径
- 输入的路径会自动添加到选项列表

### 3. 保存配置

- 点击页面右上角的"保存设置"按钮
- 配置会自动保存到数据库

## 📝 配置项说明

### 媒体库路径设置

- **本地STRM文件存放的媒体库地址**（`media_library_path`）：
  - 必填项
  - STRM文件存放的根目录
  - 支持输入或选择路径

### 分类路径设置（相对于媒体库路径）

- **电影STRM文件存放路径**（`movie_path`）：
  - 默认：`/media_library/Movies`
  - 电影STRM文件的存放路径

- **电视剧STRM文件存放路径**（`tv_path`）：
  - 默认：`/media_library/TV Shows`
  - 电视剧STRM文件的存放路径

- **动漫STRM文件存放路径**（`anime_path`）：
  - 默认：`/media_library/Anime`
  - 动漫STRM文件的存放路径

- **其他类型STRM文件存放路径**（`other_path`）：
  - 默认：`/media_library/Other`
  - 其他类型STRM文件的存放路径

## ✅ 优势

1. **灵活输入**：支持直接输入、下拉选择、浏览按钮三种方式
2. **路径记忆**：用户输入的路径会自动保存到选项列表
3. **配置持久化**：配置保存到数据库，重启后不丢失
4. **统一界面**：与系统其他路径选择功能保持一致
5. **易于使用**：界面直观，操作简单

## 🔄 与其他功能的一致性

STRM系统的媒体库地址栏与系统其他路径选择功能保持一致：
- **订阅管理**：使用 `v-combobox` 实现保存路径选择
- **下载器设置**：使用 `v-text-field` 实现默认保存路径输入
- **STRM设置**：使用 `v-combobox` + 浏览按钮实现媒体库路径选择

## 📚 相关文档

- **`简化版STRM系统功能清单.md`**：STRM系统功能清单
- **`STRM系统同步流程说明.md`**：STRM系统同步流程说明
- **`STRM系统生命周期追踪和自动删除功能实现总结.md`**：生命周期追踪和自动删除功能实现总结

## 🎯 下一步

1. ✅ 添加STRM配置API端点
2. ✅ 在Settings页面添加STRM配置分类
3. ✅ 实现媒体库路径选择功能
4. ⏳ 优化路径选择体验（如添加路径验证）
5. ⏳ 添加路径自动补全功能
6. ⏳ 添加路径历史记录功能

