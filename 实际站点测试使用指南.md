# 实际站点测试使用指南

**创建时间**: 2025-01-XX  
**目的**: 指导用户如何使用实际PT站点进行测试

---

## 📋 一、准备工作

### 1.1 获取测试站点信息

**需要的信息**:
- 站点URL（如：`https://my-pt-site.com`）
- Cookie（可选，用于需要登录的站点）
- 种子列表页面URL（可选，如：`https://my-pt-site.com/browse.php`）

### 1.2 获取Cookie

**方法1: 浏览器开发者工具**
1. 打开浏览器，访问PT站点并登录
2. 按F12打开开发者工具
3. 切换到"Network"标签
4. 刷新页面
5. 找到任意请求，查看"Request Headers"
6. 复制"Cookie"字段的值

**方法2: 浏览器扩展**
- 使用Cookie导出扩展（如：EditThisCookie）
- 导出Cookie并复制

---

## 📋 二、配置测试脚本

### 2.1 编辑测试脚本

**文件**: `backend/scripts/test_real_site.py`

**找到并修改以下配置**:

```python
TEST_SITES = [
    {
        "name": "我的PT站点",  # 站点名称
        "url": "https://my-pt-site.com",  # 站点URL
        "cookie": "your_cookie_here",  # Cookie（可选）
        "page_url": "https://my-pt-site.com/browse.php"  # 种子列表页面（可选）
    },
    # 可以添加更多测试站点
    {
        "name": "另一个PT站点",
        "url": "https://another-pt-site.com",
        "cookie": "another_cookie_here",
        "page_url": "https://another-pt-site.com/torrents.php"
    }
]
```

### 2.2 Cookie格式

**标准格式**:
```
key1=value1; key2=value2; key3=value3
```

**示例**:
```
uid=12345; pass=abc123; c_secure_uid=12345; c_secure_pass=abc123
```

---

## 📋 三、运行测试

### 3.1 基本测试

```bash
cd backend
python scripts/test_real_site.py
```

### 3.2 测试内容

**测试脚本会执行以下测试**:

1. **站点识别测试**
   - 自动识别站点类型
   - 显示匹配的配置文件信息

2. **站点验证测试**
   - 测试验证规则引擎
   - 验证站点是否符合配置

3. **站点解析测试**
   - 解析种子列表
   - 显示解析结果

4. **完整工作流程测试**
   - 从识别到解析的完整流程
   - 端到端测试

---

## 📋 四、测试结果解读

### 4.1 成功示例

```
[OK] 站点识别成功!
  配置文件ID: nexusphp
  站点名称: NexusPHP通用配置
  站点类型: nexusphp
  版本: 1.0.0

[OK] 解析成功! 找到 20 个种子
[INFO] 第一个种子示例:
  title_raw: 电影名称 2024 1080p BluRay
  size_bytes: 8589934592
  seeders: 150
```

### 4.2 失败示例

```
[FAIL] 未找到匹配的配置文件
```

**可能原因**:
- 站点类型不在支持的配置列表中
- 验证规则不匹配
- 需要创建新的配置文件

---

## 📋 五、常见问题

### 5.1 识别失败

**问题**: 站点识别失败，未找到匹配的配置文件

**解决方案**:
1. 检查站点URL是否正确
2. 检查Cookie是否有效
3. 查看站点页面源代码，确认meta generator或标题
4. 可能需要创建新的配置文件

### 5.2 解析失败

**问题**: 解析失败，未找到种子列表

**解决方案**:
1. 检查`page_url`是否正确
2. 检查CSS选择器是否匹配实际页面结构
3. 使用浏览器开发者工具检查页面结构
4. 调整配置文件中的选择器

### 5.3 Cookie过期

**问题**: 测试失败，提示需要登录

**解决方案**:
1. 重新获取Cookie
2. 确保Cookie格式正确
3. 检查Cookie是否包含必要的认证信息

---

## 📋 六、优化配置文件

### 6.1 调整选择器

**如果解析失败，需要调整选择器**:

1. **使用浏览器开发者工具**
   - 打开站点页面
   - 按F12打开开发者工具
   - 使用元素选择器找到目标元素
   - 复制CSS选择器

2. **更新配置文件**
   ```yaml
   parse:
     list:
       row: "table.torrents > tbody > tr"  # 更新为实际选择器
       fields:
         title_raw:
           selector: "a.torrent_title"  # 更新为实际选择器
           text: true
   ```

### 6.2 添加验证规则

**如果需要提高识别准确率**:

```yaml
verify:
  any:
    - meta_generator_equals: "NexusPHP"
    - title_contains: "NexusPHP"
    - selector_exists: "table.torrents"
    - url_contains: "my-pt-site.com"  # 添加URL匹配
```

---

## 📋 七、测试最佳实践

### 7.1 测试顺序

1. **先测试识别**
   - 确保站点能被正确识别
   - 如果识别失败，先解决识别问题

2. **再测试解析**
   - 识别成功后，测试解析功能
   - 根据解析结果调整选择器

3. **最后测试完整流程**
   - 测试端到端流程
   - 确保所有功能正常

### 7.2 测试多个站点

**建议测试不同类型的站点**:
- NexusPHP站点
- Gazelle站点
- Unit3D站点
- 其他类型站点

### 7.3 记录测试结果

**建议记录**:
- 测试站点名称和URL
- 识别结果
- 解析结果
- 遇到的问题
- 配置文件调整

---

## 📋 八、贡献配置文件

### 8.1 创建新配置文件

如果测试发现新的站点类型，可以创建新的配置文件：

1. **复制模板文件**
   ```bash
   cp resources/site-profiles/_template.yml resources/site-profiles/{site_id}.yml
   ```

2. **编辑配置文件**
   - 修改meta信息
   - 配置verify规则
   - 配置parse规则

3. **测试配置文件**
   - 使用测试脚本验证
   - 确保识别和解析正常

4. **更新catalog.json**
   ```json
   {
     "profiles": {
       "{site_id}.yml": "1.0.0"
     }
   }
   ```

---

## 📋 九、安全注意事项

### 9.1 Cookie安全

⚠️ **重要**: Cookie包含敏感信息，请妥善保管

- 不要将Cookie提交到公共仓库
- 不要在不安全的环境中存储Cookie
- 定期更新Cookie

### 9.2 测试环境

- 建议在测试环境中进行测试
- 避免在生产环境中测试
- 使用测试账号进行测试

---

## 📋 十、总结

### ✅ 测试流程

1. **准备**: 获取站点URL和Cookie
2. **配置**: 编辑测试脚本
3. **运行**: 执行测试脚本
4. **分析**: 查看测试结果
5. **优化**: 根据结果调整配置文件

### ✅ 支持的功能

- ✅ 站点自动识别
- ✅ 站点验证
- ✅ 内容解析（列表、详情、用户信息）
- ✅ 完整工作流程测试

---

**文档生成时间**: 2025-01-XX  
**状态**: ✅ 可用

