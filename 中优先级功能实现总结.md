# VabHub ä¸­ä¼˜å…ˆçº§åŠŸèƒ½å®ç°æ€»ç»“

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. æ¨èåŠŸèƒ½å¢å¼º âœ…

#### 1.1 Bangumiæ”¯æŒ
- **å®ç°ä½ç½®**: 
  - `VabHub/backend/app/core/bangumi_client.py` - Bangumi APIå®¢æˆ·ç«¯
  - `VabHub/backend/app/modules/recommendation/service.py` - æ¨èæœåŠ¡å¢å¼º
  - `VabHub/backend/app/api/recommendation.py` - æ¨èAPIå¢å¼º
- **åŠŸèƒ½**:
  - âœ… Bangumi APIå®¢æˆ·ç«¯ï¼ˆæœç´¢ã€è¯¦æƒ…ã€æ—¥å†ã€çƒ­é—¨åŠ¨æ¼«ï¼‰
  - âœ… Bangumiæ¨èï¼ˆæ¯æ—¥æ”¾é€ã€çƒ­é—¨åŠ¨æ¼«ï¼‰
  - âœ… è‡ªåŠ¨ç¼“å­˜Bangumiæ•°æ®
- **APIç«¯ç‚¹**:
  - `GET /api/recommendation/bangumi` - è·å–BangumiåŠ¨æ¼«æ¨è
    - å‚æ•°: `limit` (æ¨èæ•°é‡), `source` (calendar/popular)

#### 1.2 ä¸ªæ€§åŒ–é…ç½®
- **å®ç°ä½ç½®**: 
  - `VabHub/backend/app/modules/recommendation/service.py` - æ¨èæœåŠ¡å¢å¼º
  - `VabHub/backend/app/api/recommendation.py` - æ¨èAPIå¢å¼º
- **åŠŸèƒ½**:
  - âœ… ç”¨æˆ·åå¥½è®¾ç½®ï¼ˆåŒ…å«ç”µå½±/ç”µè§†å‰§/åŠ¨æ¼«ã€åå¥½ç±»å‹ã€æœ€ä½è¯„åˆ†ã€ç®—æ³•é€‰æ‹©ã€æƒé‡é…ç½®ï¼‰
  - âœ… åå¥½è®¾ç½®æŒä¹…åŒ–ï¼ˆä½¿ç”¨SettingsServiceï¼‰
  - âœ… åå¥½è®¾ç½®æŸ¥è¯¢å’Œæ›´æ–°API
- **APIç«¯ç‚¹**:
  - `GET /api/recommendation/preferences` - è·å–ç”¨æˆ·æ¨èåå¥½è®¾ç½®
  - `PUT /api/recommendation/preferences` - æ›´æ–°ç”¨æˆ·æ¨èåå¥½è®¾ç½®

---

## âš ï¸ å¾…å®ç°åŠŸèƒ½

### 2. æ¢ç´¢åŠŸèƒ½å¢å¼º âš ï¸

#### 2.1 æ’åºåŠŸèƒ½å¢å¼º
- **å½“å‰çŠ¶æ€**: åŸºç¡€æ’åºå·²å®ç°ï¼ˆseeders, size, dateï¼‰
- **å¾…å®Œæˆ**:
  - [ ] æ·»åŠ æ›´å¤šæ’åºé€‰é¡¹ï¼ˆè¯„åˆ†ã€å¹´ä»½ã€çƒ­åº¦ã€æ›´æ–°æ—¶é—´ï¼‰
  - [ ] å¤šå­—æ®µç»„åˆæ’åº
  - [ ] æ’åºæ€§èƒ½ä¼˜åŒ–

#### 2.2 Bangumiæ¢ç´¢
- **å½“å‰çŠ¶æ€**: Bangumiå®¢æˆ·ç«¯å·²å®ç°
- **å¾…å®Œæˆ**:
  - [ ] åœ¨æœç´¢APIä¸­é›†æˆBangumiæ¢ç´¢
  - [ ] Bangumiæœç´¢ç»“æœä¸PTæœç´¢ç»“æœåˆå¹¶
  - [ ] Bangumiæ¢ç´¢ä¸“ç”¨APIç«¯ç‚¹

---

### 3. éŸ³ä¹åŠŸèƒ½å®Œå–„ âš ï¸

#### 3.1 æ¨èç®—æ³•å®Œå–„
- **å½“å‰çŠ¶æ€**: åŸºç¡€æ¨èç®—æ³•å·²å®ç°
- **å¾…å®Œæˆ**:
  - [ ] éŸ³ä¹æ¨èç®—æ³•ä¼˜åŒ–ï¼ˆåŸºäºæ’­æ”¾å†å²ã€åå¥½ã€ç›¸ä¼¼åº¦ï¼‰
  - [ ] éŸ³ä¹æ¨èAPIç«¯ç‚¹

#### 3.2 å…ƒæ•°æ®ç®¡ç†å¢å¼º
- **å½“å‰çŠ¶æ€**: åŸºç¡€å…ƒæ•°æ®ç®¡ç†å·²å®ç°
- **å¾…å®Œæˆ**:
  - [ ] éŸ³ä¹æ ‡ç­¾ç®¡ç†API
  - [ ] éŸ³ä¹åˆ†ç±»ç®¡ç†API
  - [ ] å…ƒæ•°æ®æ‰¹é‡æ›´æ–°åŠŸèƒ½

---

## ğŸ“Š å®ç°è¿›åº¦

| åŠŸèƒ½ | çŠ¶æ€ | å®Œæˆåº¦ |
|------|------|--------|
| æ¨èåŠŸèƒ½å¢å¼º | âœ… å·²å®Œæˆ | 100% |
| æ¢ç´¢åŠŸèƒ½å¢å¼º | âš ï¸ éƒ¨åˆ†å®Œæˆ | 30% |
| éŸ³ä¹åŠŸèƒ½å®Œå–„ | âš ï¸ éƒ¨åˆ†å®Œæˆ | 20% |

---

## ğŸ”— ç›¸å…³æ–‡ä»¶

### å·²å®Œæˆ
- `VabHub/backend/app/core/bangumi_client.py` - Bangumi APIå®¢æˆ·ç«¯
- `VabHub/backend/app/modules/recommendation/service.py` - æ¨èæœåŠ¡å¢å¼ºï¼ˆBangumiæ”¯æŒã€ä¸ªæ€§åŒ–é…ç½®ï¼‰
- `VabHub/backend/app/api/recommendation.py` - æ¨èAPIå¢å¼ºï¼ˆBangumiæ¨èã€åå¥½è®¾ç½®ï¼‰

### å¾…åˆ›å»º/å¢å¼º
- `VabHub/backend/app/modules/search/sorter.py` - æ’åºåŠŸèƒ½å¢å¼º
- `VabHub/backend/app/modules/search/bangumi_explorer.py` - Bangumiæ¢ç´¢æ”¯æŒ
- `VabHub/backend/app/modules/music/recommendation_enhanced.py` - éŸ³ä¹æ¨èç®—æ³•å®Œå–„
- `VabHub/backend/app/modules/music/metadata_manager.py` - éŸ³ä¹å…ƒæ•°æ®ç®¡ç†å¢å¼º

---

## ğŸ“ æŠ€æœ¯ç»†èŠ‚

### Bangumiå®¢æˆ·ç«¯å®ç°

1. **æœç´¢åŠŸèƒ½** (`search_subject`):
   - æ”¯æŒå…³é”®è¯æœç´¢
   - è‡ªåŠ¨è¿‡æ»¤åŠ¨ç”»ç±»å‹ï¼ˆtype=2ï¼‰
   - ç»“æœç¼“å­˜1å°æ—¶

2. **è¯¦æƒ…åŠŸèƒ½** (`get_subject_detail`):
   - è·å–å®Œæ•´ä¸»é¢˜ä¿¡æ¯
   - åŒ…å«è¯„åˆ†ã€æ ‡ç­¾ã€å¹³å°ç­‰ä¿¡æ¯
   - ç»“æœç¼“å­˜24å°æ—¶

3. **æ—¥å†åŠŸèƒ½** (`get_calendar`):
   - è·å–æ¯æ—¥æ”¾é€åˆ—è¡¨
   - æŒ‰æ˜ŸæœŸåˆ†ç»„
   - ç»“æœç¼“å­˜1å°æ—¶

4. **çƒ­é—¨åŠ¨æ¼«** (`get_popular_anime`):
   - æŒ‰æ’åæ’åº
   - ç»“æœç¼“å­˜6å°æ—¶

### ä¸ªæ€§åŒ–é…ç½®å®ç°

1. **åå¥½è®¾ç½®å­˜å‚¨**:
   - ä½¿ç”¨`SettingsService`æŒä¹…åŒ–
   - åˆ†ç±»: `recommendation`
   - æ”¯æŒçš„ç±»å‹: å¸ƒå°”å€¼ã€åˆ—è¡¨ã€å­—å…¸ã€æµ®ç‚¹æ•°ã€å­—ç¬¦ä¸²

2. **åå¥½è®¾ç½®é¡¹**:
   - `recommendation_include_movies` - æ˜¯å¦åŒ…å«ç”µå½±
   - `recommendation_include_tv_shows` - æ˜¯å¦åŒ…å«ç”µè§†å‰§
   - `recommendation_include_anime` - æ˜¯å¦åŒ…å«åŠ¨æ¼«
   - `recommendation_preferred_genres` - åå¥½ç±»å‹åˆ—è¡¨
   - `recommendation_min_rating` - æœ€ä½è¯„åˆ†
   - `recommendation_algorithm` - æ¨èç®—æ³•
   - `recommendation_weights` - ç®—æ³•æƒé‡

3. **åå¥½åº”ç”¨**:
   - åœ¨`get_recommendations`æ–¹æ³•ä¸­è‡ªåŠ¨åº”ç”¨åå¥½è¿‡æ»¤
   - æ ¹æ®åå¥½è®¾ç½®è¿‡æ»¤æ¨èç»“æœ

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æµ‹è¯•Bangumiæ¨è
```bash
# è·å–æ¯æ—¥æ”¾é€
curl http://localhost:8000/api/recommendation/bangumi?source=calendar&limit=20

# è·å–çƒ­é—¨åŠ¨æ¼«
curl http://localhost:8000/api/recommendation/bangumi?source=popular&limit=20
```

### æµ‹è¯•ä¸ªæ€§åŒ–é…ç½®
```bash
# è·å–ç”¨æˆ·åå¥½è®¾ç½®
curl http://localhost:8000/api/recommendation/preferences?user_id=1

# æ›´æ–°ç”¨æˆ·åå¥½è®¾ç½®
curl -X PUT http://localhost:8000/api/recommendation/preferences?user_id=1 \
  -H "Content-Type: application/json" \
  -d '{
    "includeMovies": true,
    "includeTVShows": true,
    "includeAnime": true,
    "preferredGenres": ["åŠ¨ä½œ", "ç§‘å¹»"],
    "minRating": 7.0,
    "algorithm": "hybrid",
    "weights": {
      "collaborative": 30,
      "content": 30,
      "popularity": 20,
      "deep_learning": 20
    }
  }'
```

---

## ğŸ“Œ æ³¨æ„äº‹é¡¹

1. **Bangumi API**: ä½¿ç”¨å®˜æ–¹API (`https://api.bgm.tv`)ï¼Œæ— éœ€è®¤è¯ï¼Œä½†å»ºè®®éµå®ˆAPIä½¿ç”¨è§„èŒƒ
2. **ç¼“å­˜ç­–ç•¥**: Bangumiæ•°æ®ä½¿ç”¨ä¸åŒTTLç¼“å­˜ï¼Œå‡å°‘APIè°ƒç”¨
3. **åå¥½è®¾ç½®**: åå¥½è®¾ç½®å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œæ”¯æŒå¤šç”¨æˆ·ï¼ˆå½“å‰ä¸ºå•ç”¨æˆ·ç³»ç»Ÿï¼Œuser_id=1ï¼‰
4. **æ¨èç®—æ³•**: ä¸ªæ€§åŒ–é…ç½®ä¼šå½±å“æ¨èç»“æœï¼Œå»ºè®®æ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µè°ƒæ•´æƒé‡

---

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

1. **æ¢ç´¢åŠŸèƒ½å¢å¼º**:
   - å®ç°æ›´å¤šæ’åºé€‰é¡¹
   - é›†æˆBangumiæ¢ç´¢åˆ°æœç´¢API
   - ä¼˜åŒ–æœç´¢ç»“æœå±•ç¤º

2. **éŸ³ä¹åŠŸèƒ½å®Œå–„**:
   - ä¼˜åŒ–éŸ³ä¹æ¨èç®—æ³•
   - å®ç°éŸ³ä¹æ ‡ç­¾å’Œåˆ†ç±»ç®¡ç†
   - æ·»åŠ éŸ³ä¹å…ƒæ•°æ®æ‰¹é‡æ›´æ–°åŠŸèƒ½

