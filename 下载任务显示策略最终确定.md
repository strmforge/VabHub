# 下载任务显示策略最终确定

## 策略说明

**只显示带VABHUB标签的任务**（唯一选择）

### 核心原则
- **唯一选择**：系统只显示带VABHUB标签的下载任务
- **支持手动添加**：用户可以在qBittorrent/Transmission中手动添加VABHUB标签，系统可以识别
- **自动识别**：无论是系统创建还是用户手动添加的VABHUB标签，都能被识别

## 实现方式

### 后端
- **API端点**：`GET /api/downloads`
- **默认参数**：`vabhub_only=True`（固定为True）
- **过滤逻辑**：
  1. 从数据库获取所有任务
  2. 从下载器API获取每个任务的标签
  3. 只返回包含VABHUB标签的任务（包括用户手动添加的）

### 前端
- **固定参数**：始终传递 `vabhub_only=true`
- **无用户选择**：不提供开关，因为这是唯一选择
- **标签显示**：在任务列表中显示标签信息（可选，如果用户觉得太乱可以移除）

## 标签识别

### qBittorrent
- 通过 `tags` 字段识别VABHUB标签
- 支持逗号分隔的多个标签

### Transmission
- 通过 `labels` 字段识别VABHUB标签
- 支持数组格式的多个标签

### 识别逻辑
```python
# qBittorrent
tags = torrent_info.get("tags", "")
tags_list = [tag.strip() for tag in tags.split(",") if tag.strip()]

# Transmission
labels = torrent_info.get("labels", [])
tags_list = labels if isinstance(labels, list) else []

# 检查是否包含VABHUB标签
if "VABHUB" in tags_list:
    # 显示该任务
```

## 修改文件

1. **后端API**：`VabHub/backend/app/api/download.py`
   - 默认值：`vabhub_only=True`

2. **服务层**：`VabHub/backend/app/modules/download/service.py`
   - 默认值：`vabhub_only=True`
   - 注释说明：只显示带VABHUB标签的任务（唯一选择，包括用户手动添加的）

3. **前端页面**：`VabHub/frontend/src/pages/Downloads.vue`
   - 固定传递 `vabhub_only=true`
   - 移除 `vabhubOnly` 过滤条件（因为只有一种选择）

## 设计理念

- **简单明确**：只有一种选择，不需要用户配置
- **灵活支持**：支持用户手动添加标签
- **自动识别**：系统自动识别VABHUB标签，无论来源

---

**确定时间**: 2025-11-13
**状态**: ✅ 已确定并实施

