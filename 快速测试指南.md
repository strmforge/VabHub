# VabHub 快速测试指南

## 🚀 快速开始

### 方法1: 自动化测试（推荐）

1. **启动服务**（在一个终端窗口）
   ```bash
   python backend/run_server.py
   ```

2. **运行自动化测试**（在另一个终端窗口）
   ```bash
   python backend/scripts/run_tests.py
   ```

### 方法2: 手动测试

1. **启动服务**
   ```bash
   python backend/run_server.py
   ```

2. **运行基础测试**
   ```bash
   python backend/scripts/test_simple.py
   ```

3. **运行功能测试**
   ```bash
   python backend/scripts/test_functional.py
   ```

4. **运行API端点测试**
   ```bash
   python backend/scripts/test_api_endpoints.py
   ```

## 📋 测试检查清单

### 服务启动检查
- [ ] 服务成功启动
- [ ] 端口8000可访问
- [ ] API文档可访问 (http://localhost:8000/docs)

### 基础功能测试
- [ ] 根端点测试通过
- [ ] API文档测试通过
- [ ] 健康检查测试通过（Redis未运行可能失败，非关键）

### 功能模块测试
- [ ] 用户注册/登录成功
- [ ] 获取用户信息成功
- [ ] 创建订阅成功
- [ ] 获取订阅列表成功
- [ ] 获取仪表盘数据成功
- [ ] 获取设置成功

### API序列化验证
- [ ] 所有API响应包含 `success` 字段
- [ ] `data` 字段正确序列化
- [ ] 无序列化错误
- [ ] 错误处理正常

## 🎯 重点验证项

### 1. 订阅管理API (6个端点)
- [ ] POST /api/v1/subscriptions/ - 创建订阅
- [ ] GET /api/v1/subscriptions/ - 获取订阅列表
- [ ] GET /api/v1/subscriptions/{id} - 获取订阅详情
- [ ] PUT /api/v1/subscriptions/{id} - 更新订阅
- [ ] POST /api/v1/subscriptions/{id}/enable - 启用订阅
- [ ] POST /api/v1/subscriptions/{id}/disable - 禁用订阅

### 2. 站点管理API (4个端点)
- [ ] POST /api/v1/sites/ - 创建站点
- [ ] GET /api/v1/sites/ - 获取站点列表
- [ ] GET /api/v1/sites/{id} - 获取站点详情
- [ ] PUT /api/v1/sites/{id} - 更新站点

### 3. 下载管理API (3个端点)
- [ ] GET /api/v1/downloads/ - 获取下载列表
- [ ] GET /api/v1/downloads/{task_id} - 获取下载详情
- [ ] POST /api/v1/downloads/ - 创建下载任务

### 4. 音乐管理API (3个端点)
- [ ] POST /api/v1/music/subscriptions - 创建音乐订阅
- [ ] GET /api/v1/music/subscriptions - 获取音乐订阅列表
- [ ] GET /api/v1/music/subscriptions/{id} - 获取音乐订阅详情

## 📊 预期结果

### 基础功能测试
- **通过率**: 66.7%+ (2/3)
- **健康检查**: 可能失败（Redis未运行，非关键）

### 功能模块测试
- **通过率**: 85%+ (6/7)
- **所有API响应**: 包含 `success` 字段
- **序列化**: 正确

### API端点测试
- **通过率**: 90%+
- **401状态码**: 预期（需要认证）
- **422状态码**: 预期（参数验证）

## 🐛 常见问题

### 问题1: 服务无法启动
**症状**: 端口被占用或启动错误

**解决方案**:
1. 检查端口是否被占用: `netstat -ano | findstr :8000`
2. 停止占用端口的进程
3. 检查数据库连接
4. 查看服务日志

### 问题2: 测试连接失败
**症状**: `ConnectError: All connection attempts failed`

**解决方案**:
1. 确保服务已启动
2. 检查服务端口是否正确
3. 等待服务完全启动（可能需要几秒钟）
4. 检查防火墙设置

### 问题3: 认证失败
**症状**: 401 Unauthorized

**解决方案**:
1. 确保测试用户已创建
2. 检查用户登录是否成功
3. 验证Token是否有效
4. 检查Token是否过期

### 问题4: 序列化错误
**症状**: `KeyError: 'success'` 或序列化错误

**解决方案**:
1. 检查API响应格式
2. 验证Pydantic模型转换
3. 查看服务日志
4. 重新运行测试

## 📝 测试结果记录

### 记录位置
- `测试执行记录.md` - 详细测试记录
- `完整测试报告.md` - 完整测试报告

### 记录格式
```markdown
## 测试结果 - YYYY-MM-DD HH:MM:SS

### 基础功能测试
- ✅ 根端点: 通过
- ✅ API文档: 通过
- ⚠️ 健康检查: 失败（Redis未运行，非关键）

### 功能模块测试
- ✅ 用户注册: 通过
- ✅ 用户登录: 通过
- ✅ 获取用户信息: 通过
- ✅ 创建订阅: 通过
- ✅ 获取订阅列表: 通过
- ✅ 获取仪表盘数据: 通过
- ✅ 获取设置: 通过

### 通过率统计
- 基础功能测试: 66.7% (2/3)
- 功能模块测试: 100% (7/7)
- 总体通过率: 90%+ (9/10)
```

## 🔗 相关文档

- [测试执行指南.md](./测试执行指南.md)
- [下一步执行计划-测试验证.md](./下一步执行计划-测试验证.md)
- [测试执行记录.md](./测试执行记录.md)
- [完整测试报告.md](./完整测试报告.md)
- [最终修复总结.md](./最终修复总结.md)

---

**创建时间**: 2025-11-09  
**状态**: 准备就绪  
**下一步**: 启动服务并运行测试
