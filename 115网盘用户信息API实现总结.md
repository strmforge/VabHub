# 115ç½‘ç›˜ç”¨æˆ·ä¿¡æ¯APIå®ç°æ€»ç»“

## âœ… å·²å®Œæˆ

åŸºäº115ç½‘ç›˜å®˜æ–¹APIæ–‡æ¡£ï¼Œå·²å®ç°ç”¨æˆ·ä¿¡æ¯APIåŠŸèƒ½ã€‚

## ğŸ“‹ APIç«¯ç‚¹

### è·å–ç”¨æˆ·ä¿¡æ¯

**ç«¯ç‚¹**: `GET https://proapi.115.com/open/user/info`

**è¯´æ˜**: è·å–ç”¨æˆ·ç©ºé—´å’ŒVIPä¿¡æ¯

**è¯·æ±‚å¤´**:
```
Authorization: Bearer {access_token}
```

**å“åº”æ•°æ®**:
```json
{
    "state": true,
    "message": "",
    "code": "0",
    "data": {
        "user_id": "123456",
        "user_name": "ç”¨æˆ·å",
        "user_face_s": "https://example.com/face_s.jpg",
        "user_face_m": "https://example.com/face_m.jpg",
        "user_face_l": "https://example.com/face_l.jpg",
        "rt_space_info": {
            "all_total": {
                "size": 1152921504606846976,
                "size_format": "1TB"
            },
            "all_remain": {
                "size": 576460752303423488,
                "size_format": "500GB"
            },
            "all_use": {
                "size": 576460752303423488,
                "size_format": "500GB"
            }
        },
        "vip_info": {
            "level_name": "å¹´è´¹VIP",
            "expire": 1735689600
        }
    }
}
```

## ğŸ¯ å®ç°åŠŸèƒ½

### 1. è·å–ç”¨æˆ·ä¿¡æ¯ (`get_user_info`)

**æ–¹æ³•**: `async def get_user_info(self) -> Dict[str, Any]`

**åŠŸèƒ½**:
- è·å–å®Œæ•´çš„ç”¨æˆ·ä¿¡æ¯
- åŒ…æ‹¬ç”¨æˆ·IDã€ç”¨æˆ·åã€å¤´åƒï¼ˆå°/ä¸­/å¤§å°ºå¯¸ï¼‰
- åŒ…æ‹¬ç”¨æˆ·ç©ºé—´ä¿¡æ¯ï¼ˆæ€»ç©ºé—´ã€å‰©ä½™ç©ºé—´ã€å·²ä½¿ç”¨ç©ºé—´ï¼‰
- åŒ…æ‹¬ç”¨æˆ·VIPä¿¡æ¯ï¼ˆç­‰çº§åç§°ã€è¿‡æœŸæ—¶é—´ï¼‰

**è¿”å›æ•°æ®**:
- `user_id`: ç”¨æˆ·ID
- `user_name`: ç”¨æˆ·åç§°
- `user_face_s`: å°å°ºå¯¸ç”¨æˆ·å¤´åƒ
- `user_face_m`: ä¸­å°ºå¯¸ç”¨æˆ·å¤´åƒ
- `user_face_l`: å¤§å°ºå¯¸ç”¨æˆ·å¤´åƒ
- `rt_space_info`: ç”¨æˆ·ç©ºé—´ä¿¡æ¯
  - `all_total`: ç”¨æˆ·æ€»ç©ºé—´ (size, size_format)
  - `all_remain`: ç”¨æˆ·å‰©ä½™ç©ºé—´ (size, size_format)
  - `all_use`: ç”¨æˆ·å·²ä½¿ç”¨ç©ºé—´ (size, size_format)
- `vip_info`: ç”¨æˆ·VIPç­‰çº§ä¿¡æ¯
  - `level_name`: VIPç­‰çº§åç§°
  - `expire`: è¿‡æœŸæ—¶é—´æˆ³

### 2. è·å–ç”¨æˆ·ç©ºé—´ä¿¡æ¯ (`get_user_space_info`)

**æ–¹æ³•**: `async def get_user_space_info(self) -> Dict[str, Any]`

**åŠŸèƒ½**: ä¾¿æ·æ–¹æ³•ï¼Œä»…è·å–ç”¨æˆ·ç©ºé—´ä¿¡æ¯

**è¿”å›æ•°æ®**:
```json
{
    "all_total": {
        "size": 1152921504606846976,
        "size_format": "1TB"
    },
    "all_remain": {
        "size": 576460752303423488,
        "size_format": "500GB"
    },
    "all_use": {
        "size": 576460752303423488,
        "size_format": "500GB"
    }
}
```

### 3. è·å–ç”¨æˆ·VIPä¿¡æ¯ (`get_user_vip_info`)

**æ–¹æ³•**: `async def get_user_vip_info(self) -> Dict[str, Any]`

**åŠŸèƒ½**: ä¾¿æ·æ–¹æ³•ï¼Œä»…è·å–ç”¨æˆ·VIPä¿¡æ¯

**è¿”å›æ•°æ®**:
```json
{
    "level_name": "å¹´è´¹VIP",
    "expire": 1735689600
}
```

## ğŸ“Š VIPç­‰çº§è¯´æ˜

æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼ŒVIPç­‰çº§åç§°åŒ…æ‹¬ï¼š

- `åŸçŸ³ä¼šå‘˜`: åŸçŸ³ä¼šå‘˜
- `å°é²œVIP`: å°é²œVIP
- `ä½“éªŒVIP`: ä½“éªŒVIP
- `æœˆè´¹VIP`: æœˆè´¹VIP
- `å¹´è´¹VIP`: å¹´è´¹VIP
- `çº§ç‰ˆ`: çº§ç‰ˆ
- `å¹´è´¹VIPç‰¹çº§ç‰ˆ`: å¹´è´¹VIPç‰¹çº§ç‰ˆ
- `è¶…çº§VIP`: è¶…çº§VIP
- `é•¿æœŸVIP`: é•¿æœŸVIP

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### 1. è·å–å®Œæ•´ç”¨æˆ·ä¿¡æ¯

```python
from app.core.cloud_storage.providers.cloud_115_api import Cloud115API

# åˆå§‹åŒ–APIå®¢æˆ·ç«¯
api = Cloud115API(access_token=token_info["access_token"])

# è·å–ç”¨æˆ·ä¿¡æ¯
user_info = await api.get_user_info()

# æ‰“å°ç”¨æˆ·ä¿¡æ¯
print(f"ç”¨æˆ·ID: {user_info.get('user_id')}")
print(f"ç”¨æˆ·å: {user_info.get('user_name')}")
print(f"ç”¨æˆ·å¤´åƒ: {user_info.get('user_face_l')}")

# æ‰“å°ç©ºé—´ä¿¡æ¯
space_info = user_info.get("rt_space_info", {})
print(f"æ€»ç©ºé—´: {space_info.get('all_total', {}).get('size_format')}")
print(f"å‰©ä½™ç©ºé—´: {space_info.get('all_remain', {}).get('size_format')}")
print(f"å·²ä½¿ç”¨ç©ºé—´: {space_info.get('all_use', {}).get('size_format')}")

# æ‰“å°VIPä¿¡æ¯
vip_info = user_info.get("vip_info", {})
print(f"VIPç­‰çº§: {vip_info.get('level_name')}")
print(f"è¿‡æœŸæ—¶é—´: {vip_info.get('expire')}")
```

### 2. è·å–ç”¨æˆ·ç©ºé—´ä¿¡æ¯

```python
# è·å–ç”¨æˆ·ç©ºé—´ä¿¡æ¯ï¼ˆä¾¿æ·æ–¹æ³•ï¼‰
space_info = await api.get_user_space_info()

# è®¡ç®—ä½¿ç”¨ç‡
total_size = space_info.get("all_total", {}).get("size", 0)
used_size = space_info.get("all_use", {}).get("size", 0)
usage_rate = (used_size / total_size * 100) if total_size > 0 else 0

print(f"ç©ºé—´ä½¿ç”¨ç‡: {usage_rate:.2f}%")
```

### 3. è·å–ç”¨æˆ·VIPä¿¡æ¯

```python
# è·å–ç”¨æˆ·VIPä¿¡æ¯ï¼ˆä¾¿æ·æ–¹æ³•ï¼‰
vip_info = await api.get_user_vip_info()

# æ£€æŸ¥VIPæ˜¯å¦æœ‰æ•ˆ
import time
expire_time = vip_info.get("expire", 0)
current_time = int(time.time())

if expire_time > current_time:
    print(f"VIPæœ‰æ•ˆï¼Œè¿‡æœŸæ—¶é—´: {time.strftime('%Y-%m-%d %H:%M:%S', time.localtime(expire_time))}")
else:
    print("VIPå·²è¿‡æœŸ")
```

## ğŸ” é”™è¯¯å¤„ç†

### 1. è®¿é—®ä»¤ç‰Œæ— æ•ˆ

å¦‚æœè®¿é—®ä»¤ç‰Œæ— æ•ˆæˆ–å·²è¿‡æœŸï¼ŒAPIä¼šè¿”å›401é”™è¯¯ï¼š

```python
user_info = await api.get_user_info()
if not user_info:
    # è®¿é—®ä»¤ç‰Œæ— æ•ˆï¼Œéœ€è¦åˆ·æ–°
    new_token = await oauth.refresh_access_token(refresh_token)
    api = Cloud115API(access_token=new_token["access_token"])
    user_info = await api.get_user_info()
```

### 2. APIå“åº”æ ¼å¼

115 APIæˆåŠŸå“åº”æ ¼å¼ï¼š
- `state`: `true` æˆ– `code`: `0` è¡¨ç¤ºæˆåŠŸ
- `state`: `false` æˆ– `code` != `0` è¡¨ç¤ºå¤±è´¥
- é”™è¯¯ä¿¡æ¯åœ¨ `message` å­—æ®µä¸­

## ğŸ¯ å“åº”å­—æ®µè¯´æ˜

### ç”¨æˆ·åŸºæœ¬ä¿¡æ¯

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| user_id | string | ç”¨æˆ·ID |
| user_name | string | ç”¨æˆ·åç§° |
| user_face_s | string | å°å°ºå¯¸ç”¨æˆ·å¤´åƒURL |
| user_face_m | string | ä¸­å°ºå¯¸ç”¨æˆ·å¤´åƒURL |
| user_face_l | string | å¤§å°ºå¯¸ç”¨æˆ·å¤´åƒURL |

### ç©ºé—´ä¿¡æ¯ (rt_space_info)

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| all_total | object | ç”¨æˆ·æ€»ç©ºé—´ |
| all_total.size | int | ç”¨æˆ·æ€»ç©ºé—´å¤§å°ï¼ˆå­—èŠ‚ï¼‰ |
| all_total.size_format | string | ç”¨æˆ·æ€»ç©ºé—´å¤§å°ï¼ˆæ ¼å¼åŒ–ï¼‰ |
| all_remain | object | ç”¨æˆ·å‰©ä½™ç©ºé—´ |
| all_remain.size | int | ç”¨æˆ·å‰©ä½™ç©ºé—´å¤§å°ï¼ˆå­—èŠ‚ï¼‰ |
| all_remain.size_format | string | ç”¨æˆ·å‰©ä½™ç©ºé—´å¤§å°ï¼ˆæ ¼å¼åŒ–ï¼‰ |
| all_use | object | ç”¨æˆ·å·²ä½¿ç”¨ç©ºé—´ |
| all_use.size | int | ç”¨æˆ·å·²ä½¿ç”¨ç©ºé—´å¤§å°ï¼ˆå­—èŠ‚ï¼‰ |
| all_use.size_format | string | ç”¨æˆ·å·²ä½¿ç”¨ç©ºé—´å¤§å°ï¼ˆæ ¼å¼åŒ–ï¼‰ |

### VIPä¿¡æ¯ (vip_info)

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| level_name | string | VIPç­‰çº§åç§° |
| expire | int | è¿‡æœŸæ—¶é—´æˆ³ |

## âœ… å®ç°æ£€æŸ¥æ¸…å•

- [x] è·å–ç”¨æˆ·ä¿¡æ¯APIå®ç°
- [x] è·å–ç”¨æˆ·ç©ºé—´ä¿¡æ¯ä¾¿æ·æ–¹æ³•
- [x] è·å–ç”¨æˆ·VIPä¿¡æ¯ä¾¿æ·æ–¹æ³•
- [x] é”™è¯¯å¤„ç†ï¼ˆ401æœªæˆæƒï¼‰
- [x] å“åº”æ ¼å¼è§£æï¼ˆstate/codeå­—æ®µï¼‰
- [x] æ—¥å¿—è®°å½•
- [ ] å•å…ƒæµ‹è¯•ï¼ˆå¾…å®ç°ï¼‰
- [ ] ç¼“å­˜æœºåˆ¶ï¼ˆå¾…å®ç°ï¼‰

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [115ç½‘ç›˜å®˜æ–¹APIæ–‡æ¡£](https://www.yuque.com/115yun/open/qur839kyx9cgxpxi)
- [OAuth2è®¤è¯æµç¨‹](./115ç½‘ç›˜å®˜æ–¹APIæ–‡æ¡£é›†æˆå®Œæˆæ€»ç»“.md)
- [ä»¤ç‰Œåˆ·æ–°æœºåˆ¶](./115ç½‘ç›˜OAuth2ä»¤ç‰Œåˆ·æ–°æœºåˆ¶è¯´æ˜.md)

## ğŸ‰ æ€»ç»“

ç”¨æˆ·ä¿¡æ¯APIå·²æˆåŠŸå®ç°ï¼ŒåŒ…æ‹¬ï¼š
1. âœ… è·å–å®Œæ•´ç”¨æˆ·ä¿¡æ¯
2. âœ… è·å–ç”¨æˆ·ç©ºé—´ä¿¡æ¯ï¼ˆä¾¿æ·æ–¹æ³•ï¼‰
3. âœ… è·å–ç”¨æˆ·VIPä¿¡æ¯ï¼ˆä¾¿æ·æ–¹æ³•ï¼‰
4. âœ… å®Œå–„çš„é”™è¯¯å¤„ç†
5. âœ… è¯¦ç»†çš„æ—¥å¿—è®°å½•

**115ç½‘ç›˜ç”¨æˆ·ä¿¡æ¯APIå·²æˆåŠŸé›†æˆï¼**

