# MoviePilot 115ç½‘ç›˜åŠŸèƒ½å®Œæ•´å¯¹æ¯”

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†å¯¹æ¯”MoviePilotå’ŒVabHubåœ¨115ç½‘ç›˜åŠŸèƒ½ä¸Šçš„å®ç°æƒ…å†µï¼Œæ‰¾å‡ºç¼ºå¤±çš„åŠŸèƒ½ã€‚

## ğŸ” MoviePilotå®ç°çš„åŠŸèƒ½åˆ—è¡¨

### 1. è®¤è¯ç›¸å…³
- âœ… `generate_qrcode()` - ç”ŸæˆäºŒç»´ç 
- âœ… `check_login()` - æ£€æŸ¥ç™»å½•çŠ¶æ€
- âœ… `__get_access_token()` - è·å–è®¿é—®ä»¤ç‰Œ
- âœ… `__refresh_access_token()` - åˆ·æ–°è®¿é—®ä»¤ç‰Œ
- âœ… `access_token` (property) - è‡ªåŠ¨åˆ·æ–°token

### 2. æ–‡ä»¶æ“ä½œ
- âœ… `list()` - åˆ—å‡ºæ–‡ä»¶/ç›®å½•
- âœ… `get_item()` - è·å–æŒ‡å®šè·¯å¾„çš„æ–‡ä»¶/ç›®å½•é¡¹
- âœ… `get_folder()` - **è·å–æŒ‡å®šè·¯å¾„çš„æ–‡ä»¶å¤¹ï¼Œå¦‚ä¸å­˜åœ¨åˆ™åˆ›å»º** â­
- âœ… `detail()` - è·å–æ–‡ä»¶/ç›®å½•è¯¦ç»†ä¿¡æ¯
- âœ… `create_folder()` - åˆ›å»ºæ–‡ä»¶å¤¹
- âœ… `delete()` - åˆ é™¤æ–‡ä»¶/ç›®å½•
- âœ… `rename()` - é‡å‘½åæ–‡ä»¶/ç›®å½•
- âœ… `upload()` - ä¸Šä¼ æ–‡ä»¶ï¼ˆæ”¯æŒç§’ä¼ ã€åˆ†ç‰‡ä¸Šä¼ ï¼‰
- âœ… `download()` - ä¸‹è½½æ–‡ä»¶ï¼ˆæ”¯æŒè¿›åº¦æ˜¾ç¤ºï¼‰

### 3. æ–‡ä»¶ç®¡ç†
- âœ… `move()` - ç§»åŠ¨æ–‡ä»¶/ç›®å½•
- âœ… `copy()` - å¤åˆ¶æ–‡ä»¶/ç›®å½•ï¼ˆæ”¯æŒé€’å½’ï¼‰
- âœ… `link()` - åˆ›å»ºé“¾æ¥ï¼ˆæœªå®ç°ï¼Œpassï¼‰
- âœ… `softlink()` - åˆ›å»ºè½¯é“¾æ¥ï¼ˆæœªå®ç°ï¼Œpassï¼‰

### 4. å·¥å…·æ–¹æ³•
- âœ… `_delay_get_item()` - æ™ºèƒ½å»¶è¿Ÿè·å–æ–‡ä»¶ä¿¡æ¯
- âœ… `_calc_sha1()` - è®¡ç®—æ–‡ä»¶SHA1
- âœ… `_request_api()` - ç»Ÿä¸€APIè¯·æ±‚æ–¹æ³•
- âœ… `usage()` - è·å–å­˜å‚¨ä½¿ç”¨æƒ…å†µ
- âœ… `check()` - æ£€æŸ¥æ˜¯å¦å·²è®¤è¯

## ğŸ” VabHubå®ç°çš„åŠŸèƒ½åˆ—è¡¨

### 1. è®¤è¯ç›¸å…³
- âœ… `generate_qr_code()` - ç”ŸæˆäºŒç»´ç 
- âœ… `check_qr_status()` - æ£€æŸ¥ç™»å½•çŠ¶æ€
- âœ… `_get_access_token()` - è·å–è®¿é—®ä»¤ç‰Œ
- âœ… `refresh_token()` - åˆ·æ–°è®¿é—®ä»¤ç‰Œ
- âœ… `_save_tokens_to_db()` - ä¿å­˜tokenåˆ°æ•°æ®åº“

### 2. æ–‡ä»¶æ“ä½œ
- âœ… `list_files()` - åˆ—å‡ºæ–‡ä»¶/ç›®å½•
- âœ… `get_file_info()` - æ ¹æ®æ–‡ä»¶IDè·å–æ–‡ä»¶ä¿¡æ¯
- âœ… `get_file_info_by_path()` - æ ¹æ®è·¯å¾„è·å–æ–‡ä»¶ä¿¡æ¯
- âŒ `get_folder()` - **ç¼ºå¤±ï¼šè·å–æŒ‡å®šè·¯å¾„çš„æ–‡ä»¶å¤¹ï¼Œå¦‚ä¸å­˜åœ¨åˆ™åˆ›å»º** âš ï¸
- âœ… `create_folder()` - åˆ›å»ºæ–‡ä»¶å¤¹
- âœ… `delete_file()` - åˆ é™¤æ–‡ä»¶/ç›®å½•
- âœ… `rename_file()` - é‡å‘½åæ–‡ä»¶/ç›®å½•
- âœ… `upload_file()` - ä¸Šä¼ æ–‡ä»¶ï¼ˆæ”¯æŒç§’ä¼ ã€åˆ†ç‰‡ä¸Šä¼ ï¼‰
- âœ… `download_file()` - ä¸‹è½½æ–‡ä»¶ï¼ˆæ”¯æŒè¿›åº¦æ˜¾ç¤ºå’Œå–æ¶ˆï¼‰

### 3. æ–‡ä»¶ç®¡ç†
- âœ… `move_file()` - ç§»åŠ¨æ–‡ä»¶/ç›®å½•
- âœ… `copy_file()` - å¤åˆ¶æ–‡ä»¶/ç›®å½•ï¼ˆæ”¯æŒé€’å½’ï¼‰
- âŒ `link_file()` - åˆ›å»ºé“¾æ¥ï¼ˆæœªå®ç°ï¼‰
- âŒ `softlink_file()` - åˆ›å»ºè½¯é“¾æ¥ï¼ˆæœªå®ç°ï¼‰

### 4. å·¥å…·æ–¹æ³•
- âœ… `_delay_get_item()` - æ™ºèƒ½å»¶è¿Ÿè·å–æ–‡ä»¶ä¿¡æ¯
- âœ… `_calc_sha1()` - è®¡ç®—æ–‡ä»¶SHA1
- âœ… `_request()` - ç»Ÿä¸€APIè¯·æ±‚æ–¹æ³•
- âœ… `get_storage_usage()` - è·å–å­˜å‚¨ä½¿ç”¨æƒ…å†µ
- âœ… `is_authenticated()` - æ£€æŸ¥æ˜¯å¦å·²è®¤è¯

## âš ï¸ ç¼ºå¤±çš„åŠŸèƒ½

### 1. `get_folder()` - è·å–æˆ–åˆ›å»ºæ–‡ä»¶å¤¹ â­â­â­

**MoviePilotå®ç°**ï¼š
```python
def get_folder(self, path: Path) -> Optional[schemas.FileItem]:
    """
    è·å–æŒ‡å®šè·¯å¾„çš„æ–‡ä»¶å¤¹ï¼Œå¦‚ä¸å­˜åœ¨åˆ™åˆ›å»º
    """
    def __find_dir(_fileitem: schemas.FileItem, _name: str) -> Optional[schemas.FileItem]:
        """æŸ¥æ‰¾ä¸‹çº§ç›®å½•ä¸­åŒ¹é…åç§°çš„ç›®å½•"""
        for sub_folder in self.list(_fileitem):
            if sub_folder.type != "dir":
                continue
            if sub_folder.name == _name:
                return sub_folder
        return None

    # æ˜¯å¦å·²å­˜åœ¨
    folder = self.get_item(path)
    if folder:
        return folder
    # é€çº§æŸ¥æ‰¾å’Œåˆ›å»ºç›®å½•
    fileitem = schemas.FileItem(storage=self.schema.value, path="/")
    for part in path.parts[1:]:
        dir_file = __find_dir(fileitem, part)
        if dir_file:
            fileitem = dir_file
        else:
            dir_file = self.create_folder(fileitem, part)
            if not dir_file:
                logger.warn(f"ã€115ã€‘åˆ›å»ºç›®å½• {fileitem.path}{part} å¤±è´¥ï¼")
                return None
            fileitem = dir_file
    return fileitem
```

**åŠŸèƒ½è¯´æ˜**ï¼š
- å¦‚æœè·¯å¾„å­˜åœ¨ï¼Œç›´æ¥è¿”å›
- å¦‚æœè·¯å¾„ä¸å­˜åœ¨ï¼Œé€çº§åˆ›å»ºæ‰€æœ‰ç¼ºå¤±çš„ç›®å½•
- è¿™æ˜¯ä¸€ä¸ªéå¸¸å®ç”¨çš„åŠŸèƒ½ï¼Œå¯ä»¥ç¡®ä¿è·¯å¾„å­˜åœ¨

**ä½¿ç”¨åœºæ™¯**ï¼š
- ä¸Šä¼ æ–‡ä»¶å‰ç¡®ä¿ç›®æ ‡ç›®å½•å­˜åœ¨
- åˆ›å»ºåµŒå¥—ç›®å½•ç»“æ„
- æ‰¹é‡æ“ä½œå‰å‡†å¤‡ç›®å½•

### 2. `link_file()` / `softlink_file()` - åˆ›å»ºé“¾æ¥

**MoviePilotå®ç°**ï¼š
```python
def link(self, fileitem: schemas.FileItem, target_file: Path) -> bool:
    pass

def softlink(self, fileitem: schemas.FileItem, target_file: Path) -> bool:
    pass
```

**è¯´æ˜**ï¼š
- MoviePilotä¸­è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯`pass`ï¼Œæœªå®ç°
- 115ç½‘ç›˜APIå¯èƒ½ä¸æ”¯æŒé“¾æ¥åŠŸèƒ½
- ä¼˜å…ˆçº§ï¼šä½

## ğŸ“Š åŠŸèƒ½å¯¹æ¯”è¡¨

| åŠŸèƒ½ | MoviePilot | VabHub | ä¼˜å…ˆçº§ | çŠ¶æ€ |
|------|-----------|--------|--------|------|
| **è®¤è¯ç›¸å…³** |
| ç”ŸæˆäºŒç»´ç  | âœ… | âœ… | - | âœ… å·²å®ç° |
| æ£€æŸ¥ç™»å½•çŠ¶æ€ | âœ… | âœ… | - | âœ… å·²å®ç° |
| è·å–è®¿é—®ä»¤ç‰Œ | âœ… | âœ… | - | âœ… å·²å®ç° |
| åˆ·æ–°è®¿é—®ä»¤ç‰Œ | âœ… | âœ… | - | âœ… å·²å®ç° |
| **æ–‡ä»¶æ“ä½œ** |
| åˆ—å‡ºæ–‡ä»¶ | âœ… | âœ… | - | âœ… å·²å®ç° |
| è·å–æ–‡ä»¶ä¿¡æ¯ï¼ˆIDï¼‰ | âœ… | âœ… | - | âœ… å·²å®ç° |
| è·å–æ–‡ä»¶ä¿¡æ¯ï¼ˆè·¯å¾„ï¼‰ | âœ… | âœ… | - | âœ… å·²å®ç° |
| **è·å–æˆ–åˆ›å»ºæ–‡ä»¶å¤¹** | âœ… | âŒ | â­â­â­ | âš ï¸ **ç¼ºå¤±** |
| åˆ›å»ºæ–‡ä»¶å¤¹ | âœ… | âœ… | - | âœ… å·²å®ç° |
| åˆ é™¤æ–‡ä»¶/ç›®å½• | âœ… | âœ… | - | âœ… å·²å®ç° |
| é‡å‘½åæ–‡ä»¶/ç›®å½• | âœ… | âœ… | - | âœ… å·²å®ç° |
| ä¸Šä¼ æ–‡ä»¶ | âœ… | âœ… | - | âœ… å·²å®ç° |
| ä¸‹è½½æ–‡ä»¶ | âœ… | âœ… | - | âœ… å·²å®ç° |
| **æ–‡ä»¶ç®¡ç†** |
| ç§»åŠ¨æ–‡ä»¶/ç›®å½• | âœ… | âœ… | - | âœ… å·²å®ç° |
| å¤åˆ¶æ–‡ä»¶/ç›®å½• | âœ… | âœ… | - | âœ… å·²å®ç° |
| åˆ›å»ºé“¾æ¥ | âŒ (pass) | âŒ | â­ | ä½ä¼˜å…ˆçº§ |
| åˆ›å»ºè½¯é“¾æ¥ | âŒ (pass) | âŒ | â­ | ä½ä¼˜å…ˆçº§ |
| **å·¥å…·æ–¹æ³•** |
| æ™ºèƒ½å»¶è¿Ÿè·å– | âœ… | âœ… | - | âœ… å·²å®ç° |
| è®¡ç®—SHA1 | âœ… | âœ… | - | âœ… å·²å®ç° |
| ç»Ÿä¸€APIè¯·æ±‚ | âœ… | âœ… | - | âœ… å·²å®ç° |
| è·å–å­˜å‚¨ä½¿ç”¨æƒ…å†µ | âœ… | âœ… | - | âœ… å·²å®ç° |
| æ£€æŸ¥è®¤è¯çŠ¶æ€ | âœ… | âœ… | - | âœ… å·²å®ç° |

## ğŸ¯ éœ€è¦å®ç°çš„åŠŸèƒ½

### é«˜ä¼˜å…ˆçº§ï¼š`get_folder()` - è·å–æˆ–åˆ›å»ºæ–‡ä»¶å¤¹

**å®ç°å»ºè®®**ï¼š
```python
async def get_folder(self, path: str) -> Optional[CloudFileInfo]:
    """
    è·å–æŒ‡å®šè·¯å¾„çš„æ–‡ä»¶å¤¹ï¼Œå¦‚ä¸å­˜åœ¨åˆ™åˆ›å»ºï¼ˆå‚è€ƒMoviePilotå®ç°ï¼‰
    
    Args:
        path: æ–‡ä»¶å¤¹è·¯å¾„ï¼ˆå¦‚ï¼š/path/to/folderï¼‰
    
    Returns:
        æ–‡ä»¶å¤¹ä¿¡æ¯ï¼Œå¦‚æœåˆ›å»ºå¤±è´¥è¿”å›None
    """
    # 1. æ£€æŸ¥è·¯å¾„æ˜¯å¦å·²å­˜åœ¨
    folder = await self.get_file_info_by_path(path)
    if folder:
        return folder
    
    # 2. é€çº§æŸ¥æ‰¾å’Œåˆ›å»ºç›®å½•
    parts = [part for part in path.split("/") if part]
    current_path = "/"
    current_item = None
    
    for part in parts:
        # åœ¨å½“å‰è·¯å¾„ä¸‹æŸ¥æ‰¾
        files = await self.list_files(current_path)
        found = False
        for file in files:
            if file.name == part and file.type == "dir":
                current_item = file
                current_path = file.path
                found = True
                break
        
        if not found:
            # åˆ›å»ºç›®å½•
            new_folder = await self.create_folder(current_path, part)
            if not new_folder:
                logger.warn(f"ã€115ã€‘åˆ›å»ºç›®å½• {current_path}{part} å¤±è´¥ï¼")
                return None
            current_item = new_folder
            current_path = new_folder.path
    
    return current_item
```

**ä¼˜åŠ¿**ï¼š
- ç¡®ä¿è·¯å¾„å­˜åœ¨ï¼Œé¿å…ä¸Šä¼ å¤±è´¥
- æ”¯æŒåµŒå¥—ç›®å½•åˆ›å»º
- ä¸MoviePilotåŠŸèƒ½å¯¹ç­‰

## ğŸ“ æ€»ç»“

### å·²å®ç°åŠŸèƒ½ï¼ˆâœ…ï¼‰
- æ‰€æœ‰æ ¸å¿ƒæ–‡ä»¶æ“ä½œï¼ˆåˆ—è¡¨ã€ä¸Šä¼ ã€ä¸‹è½½ã€åˆ é™¤ã€é‡å‘½åï¼‰
- æ–‡ä»¶ç®¡ç†ï¼ˆç§»åŠ¨ã€å¤åˆ¶ï¼‰
- è®¤è¯ç›¸å…³åŠŸèƒ½
- å·¥å…·æ–¹æ³•

### ç¼ºå¤±åŠŸèƒ½ï¼ˆâš ï¸ï¼‰
1. **`get_folder()`** - è·å–æˆ–åˆ›å»ºæ–‡ä»¶å¤¹ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰
   - è¿™æ˜¯ä¸€ä¸ªéå¸¸å®ç”¨çš„åŠŸèƒ½
   - å¯ä»¥ç¡®ä¿è·¯å¾„å­˜åœ¨ï¼Œé¿å…æ“ä½œå¤±è´¥
   - å»ºè®®å°½å¿«å®ç°

2. **`link_file()` / `softlink_file()`** - åˆ›å»ºé“¾æ¥ï¼ˆä½ä¼˜å…ˆçº§ï¼‰
   - MoviePilotä¸­æœªå®ç°
   - 115ç½‘ç›˜APIå¯èƒ½ä¸æ”¯æŒ
   - å¯ä»¥æš‚æ—¶å¿½ç•¥

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **å®ç°`get_folder()`æ–¹æ³•**ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰
   - å‚è€ƒMoviePilotçš„å®ç°
   - æ”¯æŒåµŒå¥—ç›®å½•åˆ›å»º
   - æ·»åŠ å®Œæ•´çš„é”™è¯¯å¤„ç†

2. **æµ‹è¯•æ–°åŠŸèƒ½**
   - æµ‹è¯•è·¯å¾„å·²å­˜åœ¨çš„æƒ…å†µ
   - æµ‹è¯•è·¯å¾„ä¸å­˜åœ¨éœ€è¦åˆ›å»ºçš„æƒ…å†µ
   - æµ‹è¯•åµŒå¥—ç›®å½•åˆ›å»º

---

**çŠ¶æ€**: ğŸ“‹ åˆ†æå®Œæˆ  
**æœ€åæ›´æ–°**: 2025-01-XX

