# ç³»ç»Ÿç›‘æ§å®Œå–„æ€»ç»“

## âœ… å®ŒæˆçŠ¶æ€

**çŠ¶æ€**: âœ… **å·²å®Œæˆ**

**å®Œæˆæ—¶é—´**: 2025-11-13

---

## ğŸ¯ å®ç°å†…å®¹

### 1. ç³»ç»Ÿèµ„æºç›‘æ§ âœ…

#### ç³»ç»Ÿç›‘æ§æœåŠ¡ (`backend/app/modules/monitoring/system_monitor.py`)
- âœ… **å®æ—¶èµ„æºç›‘æ§**ï¼š
  - CPUä½¿ç”¨ç‡ï¼ˆå¤šæ ¸å¹³å‡ã€å•æ ¸ã€é¢‘ç‡ï¼‰
  - å†…å­˜ä½¿ç”¨æƒ…å†µï¼ˆæ€»é‡ã€å·²ç”¨ã€å¯ç”¨ã€ç©ºé—²ï¼‰
  - Swapä½¿ç”¨æƒ…å†µ
  - ç£ç›˜ä½¿ç”¨æƒ…å†µï¼ˆæ€»é‡ã€å·²ç”¨ã€ç©ºé—²ï¼‰
  - ç½‘ç»œä½¿ç”¨æƒ…å†µï¼ˆå‘é€/æ¥æ”¶å­—èŠ‚æ•°ã€åŒ…æ•°ï¼‰

- âœ… **å†å²è®°å½•**ï¼š
  - CPUå†å²è®°å½•ï¼ˆæœ€è¿‘1000æ¡ï¼‰
  - å†…å­˜å†å²è®°å½•ï¼ˆæœ€è¿‘1000æ¡ï¼‰
  - ç£ç›˜å†å²è®°å½•ï¼ˆæœ€è¿‘1000æ¡ï¼‰
  - ç½‘ç»œå†å²è®°å½•ï¼ˆæœ€è¿‘1000æ¡ï¼‰

- âœ… **ç»Ÿè®¡ä¿¡æ¯**ï¼š
  - å¹³å‡å€¼ã€æœ€å°å€¼ã€æœ€å¤§å€¼
  - æ”¯æŒæŒ‰èµ„æºç±»å‹æŸ¥è¯¢

#### APIç«¯ç‚¹ (`backend/app/api/monitoring.py`)
- âœ… **GET /monitoring/system/resources**: è·å–ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ
- âœ… **GET /monitoring/system/history**: è·å–ç³»ç»Ÿèµ„æºå†å²è®°å½•
- âœ… **GET /monitoring/system/statistics**: è·å–ç³»ç»Ÿèµ„æºç»Ÿè®¡ä¿¡æ¯

---

### 2. APIæ€§èƒ½ç›‘æ§ âœ…

#### APIç›‘æ§æœåŠ¡ (`backend/app/modules/monitoring/api_monitor.py`)
- âœ… **æ€§èƒ½æŒ‡æ ‡**ï¼š
  - å“åº”æ—¶é—´å†å²è®°å½•
  - é”™è¯¯å†å²è®°å½•
  - è¯·æ±‚æ•°é‡å†å²è®°å½•
  - æ…¢ç«¯ç‚¹åˆ—è¡¨
  - é”™è¯¯ç«¯ç‚¹åˆ—è¡¨

- âœ… **å†å²è®°å½•**ï¼š
  - å“åº”æ—¶é—´å†å²ï¼ˆæŒ‰ç«¯ç‚¹ï¼‰
  - é”™è¯¯å†å²ï¼ˆå…¨å±€ï¼‰
  - è¯·æ±‚æ•°é‡å†å²ï¼ˆæŒ‰ç«¯ç‚¹ï¼‰

- âœ… **åˆ†æåŠŸèƒ½**ï¼š
  - æ…¢ç«¯ç‚¹è¯†åˆ«ï¼ˆå¯é…ç½®é˜ˆå€¼ï¼‰
  - é”™è¯¯ç«¯ç‚¹è¯†åˆ«
  - æ€§èƒ½è¶‹åŠ¿åˆ†æ

#### APIç«¯ç‚¹ (`backend/app/api/monitoring.py`)
- âœ… **GET /monitoring/api/performance**: è·å–APIæ€§èƒ½æŒ‡æ ‡
- âœ… **GET /monitoring/api/history**: è·å–APIæ€§èƒ½å†å²è®°å½•
- âœ… **GET /monitoring/api/slow-endpoints**: è·å–æ…¢ç«¯ç‚¹åˆ—è¡¨
- âœ… **GET /monitoring/api/error-endpoints**: è·å–é”™è¯¯ç«¯ç‚¹åˆ—è¡¨

---

### 3. å®æ—¶æ•°æ®æ›´æ–° âœ…

#### WebSocketå¢å¼º (`backend/app/api/websocket.py`)
- âœ… **æ–°å¢ä¸»é¢˜**ï¼š
  - `api_performance`: APIæ€§èƒ½æŒ‡æ ‡

- âœ… **åå°ä»»åŠ¡**ï¼š
  - `system_resources_broadcast_task()`: æ¯2ç§’æ¨é€ç³»ç»Ÿèµ„æºæ•°æ®
  - `api_performance_broadcast_task()`: æ¯10ç§’æ¨é€APIæ€§èƒ½æ•°æ®
  - `dashboard_broadcast_task()`: æ¯5ç§’æ¨é€ä»ªè¡¨ç›˜æ•°æ®ï¼ˆå·²å­˜åœ¨ï¼‰

- âœ… **è‡ªåŠ¨å¯åŠ¨**ï¼š
  - åœ¨åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨æ‰€æœ‰WebSocketåå°ä»»åŠ¡

---

## ğŸ“Š åŠŸèƒ½ç‰¹æ€§

### 1. ç³»ç»Ÿèµ„æºç›‘æ§

#### ç›‘æ§æŒ‡æ ‡
- **CPU**ï¼š
  - ä½¿ç”¨ç‡ï¼ˆå¤šæ ¸å¹³å‡ï¼‰
  - å•æ ¸ä½¿ç”¨ç‡
  - CPUæ ¸å¿ƒæ•°
  - CPUé¢‘ç‡

- **å†…å­˜**ï¼š
  - ä½¿ç”¨ç‡
  - æ€»é‡ã€å·²ç”¨ã€å¯ç”¨ã€ç©ºé—²ï¼ˆGBï¼‰

- **Swap**ï¼š
  - ä½¿ç”¨ç‡
  - æ€»é‡ã€å·²ç”¨ã€ç©ºé—²ï¼ˆGBï¼‰

- **ç£ç›˜**ï¼š
  - ä½¿ç”¨ç‡
  - æ€»é‡ã€å·²ç”¨ã€ç©ºé—²ï¼ˆGBï¼‰

- **ç½‘ç»œ**ï¼š
  - å‘é€/æ¥æ”¶å­—èŠ‚æ•°
  - å‘é€/æ¥æ”¶åŒ…æ•°
  - å‘é€/æ¥æ”¶æ•°æ®é‡ï¼ˆGBï¼‰

#### å†å²è®°å½•
- æœ€è¿‘1000æ¡è®°å½•ï¼ˆå¯é…ç½®ï¼‰
- æ”¯æŒæŒ‰èµ„æºç±»å‹æŸ¥è¯¢
- è‡ªåŠ¨ä¿å­˜åˆ°å†…å­˜ï¼ˆé«˜æ€§èƒ½ï¼‰

#### ç»Ÿè®¡ä¿¡æ¯
- å¹³å‡å€¼ã€æœ€å°å€¼ã€æœ€å¤§å€¼
- æ”¯æŒæŒ‰èµ„æºç±»å‹æŸ¥è¯¢

### 2. APIæ€§èƒ½ç›‘æ§

#### ç›‘æ§æŒ‡æ ‡
- **å“åº”æ—¶é—´**ï¼š
  - å¹³å‡å“åº”æ—¶é—´
  - æŒ‰ç«¯ç‚¹ç»Ÿè®¡
  - å†å²è¶‹åŠ¿

- **é”™è¯¯ç‡**ï¼š
  - æ€»é”™è¯¯æ•°
  - é”™è¯¯ç‡ç™¾åˆ†æ¯”
  - é”™è¯¯å†å²è®°å½•

- **è¯·æ±‚æ•°é‡**ï¼š
  - æ€»è¯·æ±‚æ•°
  - æŒ‰ç«¯ç‚¹ç»Ÿè®¡
  - è¯·æ±‚å†å²è®°å½•

#### åˆ†æåŠŸèƒ½
- **æ…¢ç«¯ç‚¹è¯†åˆ«**ï¼š
  - å¯é…ç½®é˜ˆå€¼ï¼ˆé»˜è®¤1.0ç§’ï¼‰
  - æŒ‰å“åº”æ—¶é—´æ’åº
  - æ˜¾ç¤ºè¯·æ±‚æ•°é‡

- **é”™è¯¯ç«¯ç‚¹è¯†åˆ«**ï¼š
  - é”™è¯¯æ•°é‡ç»Ÿè®¡
  - é”™è¯¯ç‡è®¡ç®—
  - æ—¶é—´æˆ³è®°å½•

### 3. å®æ—¶æ•°æ®æ›´æ–°

#### WebSocketä¸»é¢˜
- `dashboard`: ä»ªè¡¨ç›˜æ•°æ®ï¼ˆæ¯5ç§’ï¼‰
- `system`: ç³»ç»Ÿèµ„æºæ•°æ®ï¼ˆæ¯2ç§’ï¼‰
- `api_performance`: APIæ€§èƒ½æ•°æ®ï¼ˆæ¯10ç§’ï¼‰
- `downloads`: ä¸‹è½½ä»»åŠ¡æ›´æ–°ï¼ˆäº‹ä»¶é©±åŠ¨ï¼‰

#### æ¨é€é¢‘ç‡
- ç³»ç»Ÿèµ„æºï¼š2ç§’ï¼ˆå®æ—¶æ€§è¦æ±‚é«˜ï¼‰
- ä»ªè¡¨ç›˜ï¼š5ç§’ï¼ˆå¹³è¡¡æ€§èƒ½å’Œå®æ—¶æ€§ï¼‰
- APIæ€§èƒ½ï¼š10ç§’ï¼ˆå˜åŒ–è¾ƒæ…¢ï¼‰

---

## ğŸ”„ ä»£ç å˜æ›´

### æ–°å¢æ–‡ä»¶
1. **system_monitor.py**ï¼š
   - ç³»ç»Ÿèµ„æºç›‘æ§æœåŠ¡
   - å†å²è®°å½•ç®¡ç†
   - ç»Ÿè®¡ä¿¡æ¯è®¡ç®—

2. **api_monitor.py**ï¼š
   - APIæ€§èƒ½ç›‘æ§æœåŠ¡
   - å†å²è®°å½•ç®¡ç†
   - æ…¢ç«¯ç‚¹/é”™è¯¯ç«¯ç‚¹åˆ†æ

3. **monitoring.py (API)**ï¼š
   - ç³»ç»Ÿç›‘æ§APIç«¯ç‚¹
   - èµ„æºç›‘æ§ç«¯ç‚¹
   - æ€§èƒ½ç›‘æ§ç«¯ç‚¹

4. **monitoring/__init__.py**ï¼š
   - æ¨¡å—å¯¼å‡º

### ä¿®æ”¹æ–‡ä»¶
1. **websocket.py**ï¼š
   - æ·»åŠ ç³»ç»Ÿèµ„æºå¹¿æ’­ä»»åŠ¡
   - æ·»åŠ APIæ€§èƒ½å¹¿æ’­ä»»åŠ¡
   - æ›´æ–°ä¸»é¢˜åˆ—è¡¨

2. **main.py**ï¼š
   - åœ¨åº”ç”¨å¯åŠ¨æ—¶å¯åŠ¨WebSocketåå°ä»»åŠ¡

3. **api/__init__.py**ï¼š
   - æ³¨å†Œç›‘æ§APIè·¯ç”±

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### è·å–ç³»ç»Ÿèµ„æº
```python
GET /api/monitoring/system/resources

# å“åº”
{
  "success": true,
  "data": {
    "timestamp": "2025-01-13T10:00:00Z",
    "cpu": {
      "usage_percent": 25.5,
      "usage_per_core": [20.0, 30.0, 25.0, 27.0],
      "count": 4,
      "frequency_mhz": 2400.0
    },
    "memory": {
      "usage_percent": 60.0,
      "total_gb": 16.0,
      "used_gb": 9.6,
      "available_gb": 6.4
    },
    "disk": {
      "usage_percent": 70.0,
      "total_gb": 500.0,
      "used_gb": 350.0,
      "free_gb": 150.0
    }
  }
}
```

### è·å–APIæ€§èƒ½æŒ‡æ ‡
```python
GET /api/monitoring/api/performance?endpoint=/api/search

# å“åº”
{
  "success": true,
  "data": {
    "timestamp": "2025-01-13T10:00:00Z",
    "summary": {
      "total_requests": 1000,
      "total_errors": 5,
      "error_rate": 0.005,
      "avg_response_time": 0.5
    },
    "endpoints": {
      "/api/search": {
        "request_count": 100,
        "avg_response_time": 0.3,
        "error_count": 0
      }
    }
  }
}
```

### WebSocketè®¢é˜…
```javascript
const ws = new WebSocket('ws://localhost:8092/api/ws/ws')

// è®¢é˜…ç³»ç»Ÿèµ„æº
ws.send(JSON.stringify({
  type: 'subscribe',
  topics: ['system', 'api_performance']
}))

// æ¥æ”¶ç³»ç»Ÿèµ„æºæ›´æ–°
ws.onmessage = (event) => {
  const data = JSON.parse(event.data)
  if (data.type === 'system_update') {
    console.log('ç³»ç»Ÿèµ„æº:', data.data)
  } else if (data.type === 'api_performance_update') {
    console.log('APIæ€§èƒ½:', data.data)
  }
}
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥

### å·²å®Œæˆ
- âœ… ç³»ç»Ÿèµ„æºç›‘æ§
- âœ… APIæ€§èƒ½ç›‘æ§
- âœ… å®æ—¶æ•°æ®æ›´æ–°ï¼ˆWebSocketï¼‰

### å¾…å®Œæˆ
- â³ æµ‹è¯•æ–°åŠŸèƒ½
- â³ å‰ç«¯ç›‘æ§ç•Œé¢ï¼ˆå¯é€‰ï¼‰

---

**çŠ¶æ€**: âœ… ç³»ç»Ÿç›‘æ§å®Œå–„å·²å®Œæˆ
**ä¸‹ä¸€æ­¥**: æµ‹è¯•æ–°åŠŸèƒ½æˆ–ç»§ç»­å¼€å‘å…¶ä»–åŠŸèƒ½

