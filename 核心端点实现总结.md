# æ ¸å¿ƒç«¯ç‚¹å®ç°æ€»ç»“

**å®Œæˆæ—¶é—´**: 2025-01-XX  
**çŠ¶æ€**: âœ… æ ¸å¿ƒç«¯ç‚¹å·²å®ç°

---

## ğŸ“‹ ä¸€ã€å·²å®ç°çš„ç¼ºå¤±ç«¯ç‚¹

### âœ… 1. è®¤è¯ç«¯ç‚¹

#### `/api/auth/logout` (POST)
- **æ–‡ä»¶**: `VabHub/backend/app/api/auth.py`
- **åŠŸèƒ½**: ç”¨æˆ·ç™»å‡º
- **å®ç°**: æ·»åŠ äº† `logout` ç«¯ç‚¹ï¼Œæ”¯æŒJWT tokenéªŒè¯å’Œç™»å‡ºæ—¥å¿—è®°å½•
- **çŠ¶æ€**: âœ… å·²å®Œæˆ

---

### âœ… 2. åª’ä½“åº“ç«¯ç‚¹

#### `/api/library/servers` (GET)
- **æ–‡ä»¶**: `VabHub/backend/app/api/library.py` (æ–°å»º)
- **åŠŸèƒ½**: è·å–åª’ä½“åº“æœåŠ¡å™¨åˆ—è¡¨
- **å®ç°**: æ˜ å°„åˆ° `MediaServerService.list_media_servers()`
- **çŠ¶æ€**: âœ… å·²å®Œæˆ

#### `/api/library/{server}/refresh` (POST)
- **æ–‡ä»¶**: `VabHub/backend/app/api/library.py` (æ–°å»º)
- **åŠŸèƒ½**: åˆ·æ–°åª’ä½“åº“
- **å®ç°**: æ˜ å°„åˆ° `MediaServerService.sync_libraries()`
- **çŠ¶æ€**: âœ… å·²å®Œæˆ

---

### âœ… 3. å­˜å‚¨ç«¯ç‚¹

#### `/api/storage/status` (GET)
- **æ–‡ä»¶**: `VabHub/backend/app/api/storage.py`
- **åŠŸèƒ½**: è·å–å­˜å‚¨çŠ¶æ€
- **å®ç°**: ä½¿ç”¨ `StorageMonitorService.get_all_directories_usage()` è®¡ç®—æ€»ä½“ç»Ÿè®¡
- **çŠ¶æ€**: âœ… å·²å®Œæˆ

#### `/api/storage/config` (GET/PUT)
- **æ–‡ä»¶**: `VabHub/backend/app/api/storage.py`
- **åŠŸèƒ½**: è·å–/æ›´æ–°å­˜å‚¨é…ç½®
- **å®ç°**: ä½¿ç”¨ `SettingsService` ç®¡ç†å­˜å‚¨é…ç½®
- **çŠ¶æ€**: âœ… å·²å®Œæˆ

---

### âœ… 4. å¥åº·æ£€æŸ¥å’ŒæŒ‡æ ‡ç«¯ç‚¹

#### `/healthz` (GET)
- **æ–‡ä»¶**: `VabHub/backend/main.py`
- **åŠŸèƒ½**: Kuberneteså…¼å®¹çš„å¥åº·æ£€æŸ¥ç«¯ç‚¹
- **å®ç°**: æ˜ å°„åˆ°ç°æœ‰çš„å¥åº·æ£€æŸ¥åŠŸèƒ½
- **çŠ¶æ€**: âœ… å·²å®Œæˆ

#### `/metrics` (GET)
- **æ–‡ä»¶**: `VabHub/backend/main.py`
- **åŠŸèƒ½**: Prometheuså…¼å®¹çš„æŒ‡æ ‡ç«¯ç‚¹
- **å®ç°**: ä½¿ç”¨ `PerformanceMonitor.get_metrics_prometheus()`
- **çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## ğŸ“‹ äºŒã€è·¯ç”±æ³¨å†Œ

### âœ… å·²æ³¨å†Œçš„è·¯ç”±

åœ¨ `VabHub/backend/app/api/__init__.py` ä¸­ï¼š
- âœ… `library.router` å·²æ³¨å†Œåˆ° `/library` å‰ç¼€

---

## ğŸ“‹ ä¸‰ã€å¾…å®ç°çš„ç«¯ç‚¹

æ ¹æ® `alignment_report.json`ï¼Œä»¥ä¸‹ç«¯ç‚¹ä»ç¼ºå¤±ï¼š

### é«˜ä¼˜å…ˆçº§ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰

1. **ä¸‹è½½ç®¡ç†**
   - `/api/downloads/{download_id}` - ä¸‹è½½è¯¦æƒ…ï¼ˆå·²æœ‰ `/{task_id}`ï¼Œéœ€è¦åˆ«åï¼‰
   - `/api/downloads/{download_id}/pause` - æš‚åœä¸‹è½½ï¼ˆå·²æœ‰ `/{task_id}/pause`ï¼Œéœ€è¦åˆ«åï¼‰
   - `/api/downloads/{download_id}/resume` - æ¢å¤ä¸‹è½½ï¼ˆå·²æœ‰ `/{task_id}/resume`ï¼Œéœ€è¦åˆ«åï¼‰

2. **åª’ä½“ç®¡ç†**
   - `/api/media` - åª’ä½“åˆ—è¡¨
   - `/api/media/{media_id}` - åª’ä½“è¯¦æƒ…

3. **ä¸‹è½½å™¨ç®¡ç†**
   - `/api/dl/instances` - ä¸‹è½½å™¨å®ä¾‹åˆ—è¡¨
   - `/api/dl/{did}/stats` - ä¸‹è½½å™¨ç»Ÿè®¡
   - `/api/dl/{did}/test` - æµ‹è¯•ä¸‹è½½å™¨è¿æ¥

4. **STRMç®¡ç†**
   - `/api/strm/emit` - STRMç”Ÿæˆ
   - `/api/strm/full-sync` - å…¨é‡åŒæ­¥
   - `/api/strm/incremental-sync` - å¢é‡åŒæ­¥
   - `/api/strm/network-info` - ç½‘ç»œä¿¡æ¯
   - `/api/strm/stream/{storage_type}/{token}` - æµåª’ä½“é‡å®šå‘
   - `/api/strm/subtitle/{storage_type}/{token}` - å­—å¹•æµ
   - `/api/strm/sync/history` - åŒæ­¥å†å²
   - `/api/strm/sync/start` - å¯åŠ¨åŒæ­¥
   - `/api/strm/sync/stop` - åœæ­¢åŒæ­¥
   - `/api/strm/sync/tasks` - åŒæ­¥ä»»åŠ¡åˆ—è¡¨
   - `/api/strm/sync/tasks/{task_id}` - åŒæ­¥ä»»åŠ¡è¯¦æƒ…
   - `/api/strm/sync/tasks/{task_id}/stop` - åœæ­¢åŒæ­¥ä»»åŠ¡

5. **å…¶ä»–æ ¸å¿ƒåŠŸèƒ½**
   - `/api/ruleset` - è§„åˆ™é›†ç®¡ç†
   - `/api/scraper/config` - åˆ®å‰Šå™¨é…ç½®
   - `/api/scraper/test` - åˆ®å‰Šå™¨æµ‹è¯•
   - `/api/secrets/status` - å¯†é’¥çŠ¶æ€
   - `/api/tasks` - ä»»åŠ¡åˆ—è¡¨
   - `/api/tasks/{tid}` - ä»»åŠ¡è¯¦æƒ…
   - `/api/tasks/{tid}/retry` - é‡è¯•ä»»åŠ¡
   - `/api/subscriptions/test` - æµ‹è¯•è®¢é˜…
   - `/api/subscriptions/{sid}` - è®¢é˜…è¯¦æƒ…/æ›´æ–°/åˆ é™¤
   - `/api/system/settings` - ç³»ç»Ÿè®¾ç½®
   - `/api/system/settings/{key}` - ç³»ç»Ÿè®¾ç½®é¡¹
   - `/api/gateway/sign` - ç½‘å…³ç­¾å
   - `/api/douban/detail/{douban_id}` - è±†ç“£è¯¦æƒ…
   - `/api/douban/rating/{douban_id}` - è±†ç“£è¯„åˆ†
   - `/api/music/tracks/{track_id}` - éŸ³ä¹æ›²ç›®è¯¦æƒ…
   - `/api/plugins/registry` - æ’ä»¶æ³¨å†Œè¡¨
   - `/api/plugins/{pid}/install` - å®‰è£…æ’ä»¶
   - `/api/rsshub/sources/{id}/preview` - RSSHubæºé¢„è§ˆ
   - `/api/sites/{site_id}/domains/check-all` - æ£€æŸ¥æ‰€æœ‰åŸŸå
   - `/api/sites/{site_id}/domains/set-active` - è®¾ç½®æ´»åŠ¨åŸŸå
   - `/api/dashboard/stats/media` - åª’ä½“ç»Ÿè®¡
   - `/api/dashboard/stats/system` - ç³»ç»Ÿç»Ÿè®¡
   - `/api/ws/ws` - WebSocketç«¯ç‚¹

---

## ğŸ“‹ å››ã€è·¯å¾„æ ¼å¼ç»Ÿä¸€

### å½“å‰çŠ¶æ€

- **åç«¯APIå‰ç¼€**: `/api/v1`
- **æœŸæœ›ç«¯ç‚¹æ ¼å¼**: `/api/...`ï¼ˆæ—  `/v1` å‰ç¼€ï¼‰

### è§£å†³æ–¹æ¡ˆ

#### é€‰é¡¹1: ç§»é™¤ `/v1` å‰ç¼€ï¼ˆæ¨èï¼‰
- **ä¼˜ç‚¹**: ä¸æœŸæœ›åˆ—è¡¨ä¸€è‡´ï¼Œæ›´ç®€æ´
- **ç¼ºç‚¹**: éœ€è¦æ›´æ–°æ‰€æœ‰APIè°ƒç”¨
- **å®æ–½**: ä¿®æ”¹ `app/core/config.py` ä¸­çš„ `API_PREFIX` ä» `/api/v1` æ”¹ä¸º `/api`

#### é€‰é¡¹2: æ›´æ–°æœŸæœ›åˆ—è¡¨
- **ä¼˜ç‚¹**: ä¸éœ€è¦ä¿®æ”¹åç«¯ä»£ç 
- **ç¼ºç‚¹**: å‰ç«¯éœ€è¦æ›´æ–°æ‰€æœ‰APIè°ƒç”¨
- **å®æ–½**: æ›´æ–° `tools/ui_expected_endpoints.txt`ï¼Œå°†æ‰€æœ‰ `/api/...` æ”¹ä¸º `/api/v1/...`

#### é€‰é¡¹3: åŒé‡æ”¯æŒï¼ˆå…¼å®¹æ€§ï¼‰
- **ä¼˜ç‚¹**: åŒæ—¶æ”¯æŒä¸¤ç§æ ¼å¼ï¼Œå‘åå…¼å®¹
- **ç¼ºç‚¹**: éœ€è¦ç»´æŠ¤ä¸¤å¥—è·¯ç”±
- **å®æ–½**: åœ¨ `main.py` ä¸­åŒæ—¶æ³¨å†Œ `/api` å’Œ `/api/v1` å‰ç¼€çš„è·¯ç”±

**å»ºè®®**: é‡‡ç”¨é€‰é¡¹1ï¼Œç§»é™¤ `/v1` å‰ç¼€ï¼Œç»Ÿä¸€ä½¿ç”¨ `/api/...` æ ¼å¼ã€‚

---

## ğŸ“‹ äº”ã€é¢å¤–ç«¯ç‚¹è¯„ä¼°

æ ¹æ® `alignment_report.json`ï¼Œåç«¯æœ‰ **292ä¸ªé¢å¤–ç«¯ç‚¹**ï¼ˆä¸åœ¨æœŸæœ›åˆ—è¡¨ä¸­ï¼‰ã€‚

### è¯„ä¼°æ ‡å‡†

1. **æ ¸å¿ƒåŠŸèƒ½ç«¯ç‚¹**: åº”è¯¥æ·»åŠ åˆ°æœŸæœ›åˆ—è¡¨
2. **è¾…åŠ©åŠŸèƒ½ç«¯ç‚¹**: å¯é€‰æ·»åŠ 
3. **å†…éƒ¨ç«¯ç‚¹**: ä¸éœ€è¦æ·»åŠ 

### å»ºè®®æ·»åŠ çš„ç«¯ç‚¹ï¼ˆéƒ¨åˆ†ï¼‰

1. **åª’ä½“æœåŠ¡å™¨ç®¡ç†** (`/api/media-servers/...`)
   - å·²å®ç°ä½†è·¯å¾„ä¸åŒï¼Œå»ºè®®æ·»åŠ åˆ°æœŸæœ›åˆ—è¡¨

2. **å­˜å‚¨ç›‘æ§** (`/api/storage-monitor/...`)
   - å·²å®ç°ä½†è·¯å¾„ä¸åŒï¼Œå»ºè®®æ·»åŠ åˆ°æœŸæœ›åˆ—è¡¨

3. **æ–‡ä»¶æµè§ˆå™¨** (`/api/file-browser/...`)
   - æ ¸å¿ƒåŠŸèƒ½ï¼Œå»ºè®®æ·»åŠ åˆ°æœŸæœ›åˆ—è¡¨

4. **è½¬ç§»å†å²** (`/api/transfer-history/...`)
   - æ ¸å¿ƒåŠŸèƒ½ï¼Œå»ºè®®æ·»åŠ åˆ°æœŸæœ›åˆ—è¡¨

5. **å…¶ä»–åŠŸèƒ½ç«¯ç‚¹**
   - æ ¹æ®å‰ç«¯éœ€æ±‚è¯„ä¼°æ˜¯å¦æ·»åŠ 

---

## ğŸ“‹ å…­ã€ä¸‹ä¸€æ­¥å»ºè®®

### 1. ç«‹å³æ‰§è¡Œï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰

1. **ç»Ÿä¸€è·¯å¾„æ ¼å¼**
   - ç§»é™¤ `/v1` å‰ç¼€æˆ–æ›´æ–°æœŸæœ›åˆ—è¡¨
   - æ›´æ–°å‰ç«¯APIè°ƒç”¨

2. **å®ç°å‰©ä½™æ ¸å¿ƒç«¯ç‚¹**
   - ä¸‹è½½ç®¡ç†åˆ«åç«¯ç‚¹
   - STRMç®¡ç†ç«¯ç‚¹
   - ä»»åŠ¡ç®¡ç†ç«¯ç‚¹
   - è®¢é˜…ç®¡ç†ç«¯ç‚¹

### 2. è¿‘æœŸæ‰§è¡Œï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰

1. **è¯„ä¼°é¢å¤–ç«¯ç‚¹**
   - åˆ†æ292ä¸ªé¢å¤–ç«¯ç‚¹
   - ç¡®å®šéœ€è¦æ·»åŠ åˆ°æœŸæœ›åˆ—è¡¨çš„ç«¯ç‚¹

2. **æ›´æ–°æœŸæœ›åˆ—è¡¨**
   - æ·»åŠ æ ¸å¿ƒåŠŸèƒ½ç«¯ç‚¹
   - ç§»é™¤å·²åºŸå¼ƒçš„ç«¯ç‚¹

### 3. é•¿æœŸä¼˜åŒ–ï¼ˆä½ä¼˜å…ˆçº§ï¼‰

1. **APIæ–‡æ¡£å®Œå–„**
   - æ›´æ–°OpenAPIæ–‡æ¡£
   - æ·»åŠ ç«¯ç‚¹ä½¿ç”¨ç¤ºä¾‹

2. **æµ‹è¯•è¦†ç›–**
   - ä¸ºæ–°å¢ç«¯ç‚¹æ·»åŠ æµ‹è¯•
   - ç¡®ä¿ç«¯ç‚¹åŠŸèƒ½æ­£å¸¸

---

## ğŸ“‹ ä¸ƒã€æ–‡ä»¶å˜æ›´æ¸…å•

### æ–°å»ºæ–‡ä»¶

1. `VabHub/backend/app/api/library.py` - åª’ä½“åº“å…¼å®¹æ€§ç«¯ç‚¹

### ä¿®æ”¹æ–‡ä»¶

1. `VabHub/backend/app/api/auth.py` - æ·»åŠ ç™»å‡ºç«¯ç‚¹
2. `VabHub/backend/app/api/storage.py` - æ·»åŠ å­˜å‚¨çŠ¶æ€å’Œé…ç½®ç«¯ç‚¹
3. `VabHub/backend/app/api/__init__.py` - æ³¨å†Œlibraryè·¯ç”±
4. `VabHub/backend/main.py` - æ·»åŠ  `/healthz` å’Œ `/metrics` ç«¯ç‚¹

---

**æ–‡æ¡£ç”Ÿæˆæ—¶é—´**: 2025-01-XX  
**çŠ¶æ€**: âœ… æ ¸å¿ƒç«¯ç‚¹å·²å®ç°ï¼Œè·¯å¾„æ ¼å¼ç»Ÿä¸€å¾…å¤„ç†

**å»ºè®®**: 
1. ä¼˜å…ˆç»Ÿä¸€è·¯å¾„æ ¼å¼ï¼ˆç§»é™¤ `/v1` å‰ç¼€ï¼‰
2. å®ç°å‰©ä½™æ ¸å¿ƒç«¯ç‚¹
3. è¯„ä¼°å¹¶æ›´æ–°æœŸæœ›ç«¯ç‚¹åˆ—è¡¨

