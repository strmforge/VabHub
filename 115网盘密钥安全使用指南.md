# 115ç½‘ç›˜å¯†é’¥å®‰å…¨ä½¿ç”¨æŒ‡å—

## ğŸ”’ å®‰å…¨è¯´æ˜

**é‡è¦**ï¼š115ç½‘ç›˜çš„å¼€å‘è€…å¯†é’¥ï¼ˆAppIDã€AppKeyï¼‰æ˜¯æ•æ„Ÿä¿¡æ¯ï¼Œå¿…é¡»åŠ å¯†å­˜å‚¨ï¼Œ**ç»ä¸èƒ½**ç¡¬ç¼–ç åœ¨ä»£ç ä¸­æˆ–æäº¤åˆ°Gitä»“åº“ã€‚

**è¯´æ˜**ï¼š115ç½‘ç›˜APIåªéœ€è¦AppIDå’ŒAppKeyï¼ŒAppSecretæ˜¯å¯é€‰çš„ï¼ˆé€šå¸¸ä¸éœ€è¦ï¼‰ã€‚

## âœ… å½“å‰å®‰å…¨çŠ¶æ€

### 1. åŠ å¯†ç³»ç»Ÿ âœ…
- **åŠ å¯†æ–¹å¼**ï¼šä½¿ç”¨Fernetå¯¹ç§°åŠ å¯†ï¼ˆAES-128ï¼‰
- **å­˜å‚¨ä½ç½®**ï¼š`~/.vabhub/cloud_keys.encrypted`
- **ä¸»å¯†é’¥**ï¼š`~/.vabhub/.master_key`ï¼ˆæ–‡ä»¶æƒé™ï¼š600ï¼‰
- **åŠ å¯†ç®¡ç†å™¨**ï¼š`app/core/cloud_key_manager.py`

### 2. å¯†é’¥è·å–æ–¹å¼ âœ…
- **ä¼˜å…ˆçº§1**ï¼šä»åŠ å¯†å­˜å‚¨è¯»å–ï¼ˆæœ€å®‰å…¨ï¼‰
- **ä¼˜å…ˆçº§2**ï¼šä»ç¯å¢ƒå˜é‡è¯»å–ï¼ˆå¤‡ç”¨æ–¹æ¡ˆï¼‰
- **ä¼˜å…ˆçº§3**ï¼šä»é…ç½®æ–‡ä»¶è¯»å–ï¼ˆä¸æ¨èï¼‰

### 3. å¯†é’¥ä½¿ç”¨ âœ…
- Provideråˆå§‹åŒ–æ—¶ä»å¯†é’¥ç®¡ç†å™¨è·å–
- å¯†é’¥åœ¨å†…å­˜ä¸­æ˜æ–‡å­˜åœ¨æ—¶é—´æœ€çŸ­
- æ—¥å¿—ä¸­åªæ˜¾ç¤ºå¯†é’¥çš„éƒ¨åˆ†å†…å®¹

## ğŸ“ è®¾ç½®å¯†é’¥çš„æ–¹æ³•

### æ–¹æ³•1ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼‰

#### Windows (PowerShell)
```powershell
# 115ç½‘ç›˜åªéœ€è¦AppIDå’ŒAppKey
$env:VABHUB_115_APP_ID="100197729"
$env:VABHUB_115_APP_KEY="d099625d59aba2a79e70b81fc4589b26"

# ç„¶åè¿è¡Œè®¾ç½®è„šæœ¬
python backend/scripts/setup_115_keys.py --from-env
```

#### Linux/Mac
```bash
# 115ç½‘ç›˜åªéœ€è¦AppIDå’ŒAppKey
export VABHUB_115_APP_ID="100197729"
export VABHUB_115_APP_KEY="d099625d59aba2a79e70b81fc4589b26"

# ç„¶åè¿è¡Œè®¾ç½®è„šæœ¬
python backend/scripts/setup_115_keys.py --from-env
```

#### ä½¿ç”¨.envæ–‡ä»¶
åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env` æ–‡ä»¶ï¼š
```env
# 115ç½‘ç›˜å¼€å‘è€…å¯†é’¥ï¼ˆåªéœ€è¦AppIDå’ŒAppKeyï¼‰
VABHUB_115_APP_ID=100197729
VABHUB_115_APP_KEY=d099625d59aba2a79e70b81fc4589b26
# AppSecretæ˜¯å¯é€‰çš„ï¼Œé€šå¸¸ä¸éœ€è¦
# VABHUB_115_APP_SECRET=your_app_secret
```

ç„¶åè¿è¡Œï¼š
```bash
python backend/scripts/setup_115_keys.py --from-env
```

### æ–¹æ³•2ï¼šäº¤äº’å¼è®¾ç½®

```bash
python backend/scripts/setup_115_keys.py --interactive
```

è„šæœ¬ä¼šæç¤ºæ‚¨è¾“å…¥å¯†é’¥ï¼Œè¾“å…¥åä¼šåŠ å¯†å­˜å‚¨ã€‚

### æ–¹æ³•3ï¼šä½¿ç”¨åˆå§‹åŒ–è„šæœ¬ï¼ˆå·²æ›´æ–°ï¼‰

```bash
# å…ˆè®¾ç½®ç¯å¢ƒå˜é‡
export VABHUB_115_APP_ID="..."
export VABHUB_115_APP_KEY="..."
export VABHUB_115_APP_SECRET="..."

# ç„¶åè¿è¡Œåˆå§‹åŒ–è„šæœ¬
python backend/scripts/init_cloud_storage.py
```

## ğŸ” å¯†é’¥ç®¡ç†

### æŸ¥çœ‹å·²å­˜å‚¨çš„å¯†é’¥

```python
from app.core.cloud_key_manager import get_key_manager

key_manager = get_key_manager()
keys = key_manager.get_115_keys()

if keys:
    print(f"AppID: {keys['app_id']}")
    print(f"AppKey: {keys['app_key'][:10]}...")
    print(f"AppSecret: {keys['app_secret'][:10]}...")
else:
    print("æœªæ‰¾åˆ°115ç½‘ç›˜å¯†é’¥")
```

### æ›´æ–°å¯†é’¥

```bash
# è®¾ç½®æ–°çš„ç¯å¢ƒå˜é‡
export VABHUB_115_APP_ID="new_app_id"
export VABHUB_115_APP_KEY="new_app_key"
export VABHUB_115_APP_SECRET="new_app_secret"

# è¿è¡Œè®¾ç½®è„šæœ¬ï¼ˆä¼šæç¤ºæ˜¯å¦æ›´æ–°ï¼‰
python backend/scripts/setup_115_keys.py --from-env
```

### åˆ é™¤å¯†é’¥

```python
from app.core.cloud_key_manager import get_key_manager

key_manager = get_key_manager()
key_manager.delete_keys("115")
```

## âš ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹

### 1. ä¸è¦ç¡¬ç¼–ç å¯†é’¥
âŒ **é”™è¯¯åšæ³•**ï¼š
```python
app_id = "100197729"  # ä¸è¦è¿™æ ·åšï¼
app_key = "d099625d59aba2a79e70b81fc4589b26"  # ä¸è¦è¿™æ ·åšï¼
```

âœ… **æ­£ç¡®åšæ³•**ï¼š
```python
from app.core.cloud_key_manager import get_key_manager

key_manager = get_key_manager()
keys = key_manager.get_115_keys()
app_id = keys["app_id"]  # 115ç½‘ç›˜åªéœ€è¦AppIDå’ŒAppKey
app_key = keys["app_key"]
```

### 2. ä¸è¦æäº¤å¯†é’¥åˆ°Git
- âœ… `.gitignore` å·²é…ç½®æ’é™¤ä»¥ä¸‹æ–‡ä»¶ï¼š
  - `.env`
  - `.env.local`
  - `*.encrypted`
  - `cloud_keys.encrypted`
  - `.master_key`

### 3. ä¿æŠ¤ä¸»å¯†é’¥æ–‡ä»¶
- ä¸»å¯†é’¥æ–‡ä»¶æƒé™è‡ªåŠ¨è®¾ç½®ä¸º 600ï¼ˆä»…æ‰€æœ‰è€…å¯è¯»å†™ï¼‰
- ä¸è¦å°†ä¸»å¯†é’¥æ–‡ä»¶å¤åˆ¶åˆ°å…¶ä»–åœ°æ–¹
- ä¸¢å¤±ä¸»å¯†é’¥å°†æ— æ³•è§£å¯†å­˜å‚¨çš„å¯†é’¥

### 4. ç”Ÿäº§ç¯å¢ƒå»ºè®®
- ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–å¯†é’¥ç®¡ç†æœåŠ¡ï¼ˆå¦‚AWS Secrets Managerï¼‰
- å®šæœŸè½®æ¢å¯†é’¥
- é™åˆ¶å¯†é’¥æ–‡ä»¶çš„è®¿é—®æƒé™
- ä½¿ç”¨ä¸“ç”¨å¯†é’¥ç®¡ç†æœåŠ¡

## ğŸ“Š å¯†é’¥ä½¿ç”¨æµç¨‹

```
1. åº”ç”¨å¯åŠ¨
   â†“
2. åˆ›å»ºCloudStorageService
   â†“
3. ä»å¯†é’¥ç®¡ç†å™¨è·å–å¯†é’¥ï¼ˆåŠ å¯†å­˜å‚¨ï¼‰
   â†“
4. è§£å¯†å¯†é’¥ï¼ˆä»…åœ¨å†…å­˜ä¸­ï¼‰
   â†“
5. åˆå§‹åŒ–115Provider
   â†“
6. ä½¿ç”¨å¯†é’¥è¿›è¡ŒAPIè°ƒç”¨
```

## ğŸ” éªŒè¯å¯†é’¥æ˜¯å¦æ­£ç¡®è®¾ç½®

```bash
# è¿è¡Œæµ‹è¯•è„šæœ¬
python backend/scripts/test_115_storage.py

# æˆ–ä½¿ç”¨Pythonäº¤äº’å¼ç¯å¢ƒ
python
>>> from app.core.cloud_key_manager import get_key_manager
>>> key_manager = get_key_manager()
>>> keys = key_manager.get_115_keys()
>>> print(keys)  # åº”è¯¥æ˜¾ç¤ºå¯†é’¥ä¿¡æ¯
```

## ğŸ“š ç›¸å…³æ–‡ä»¶

- **å¯†é’¥ç®¡ç†å™¨**ï¼š`backend/app/core/cloud_key_manager.py`
- **è®¾ç½®è„šæœ¬**ï¼š`backend/scripts/setup_115_keys.py`
- **åˆå§‹åŒ–è„šæœ¬**ï¼š`backend/scripts/init_cloud_storage.py`
- **115Provider**ï¼š`backend/app/core/cloud_storage/providers/cloud_115.py`
- **å­˜å‚¨æœåŠ¡**ï¼š`backend/app/modules/cloud_storage/service.py`

## ğŸ¯ æ€»ç»“

1. âœ… **å¯†é’¥å·²åº”ç”¨**ï¼š115Providerä½¿ç”¨å¯†é’¥ç®¡ç†å™¨è·å–å¯†é’¥
2. âœ… **å¯†é’¥å·²åŠ å¯†**ï¼šä½¿ç”¨FernetåŠ å¯†å­˜å‚¨åˆ°æœ¬åœ°æ–‡ä»¶
3. âœ… **å®‰å…¨æªæ–½**ï¼š
   - å¯†é’¥ä¸ç¡¬ç¼–ç åœ¨ä»£ç ä¸­
   - å¯†é’¥æ–‡ä»¶ä¸æäº¤åˆ°Git
   - ä¸»å¯†é’¥æ–‡ä»¶æƒé™é™åˆ¶
   - æ—¥å¿—ä¸­åªæ˜¾ç¤ºéƒ¨åˆ†å¯†é’¥

4. âš ï¸ **éœ€è¦æ”¹è¿›**ï¼š
   - `init_cloud_storage.py` å·²æ›´æ–°ä¸ºä»ç¯å¢ƒå˜é‡è¯»å–
   - æ–°å¢ `setup_115_keys.py` æä¾›æ›´å®‰å…¨çš„è®¾ç½®æ–¹å¼
   - å»ºè®®ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–äº¤äº’å¼è®¾ç½®

---

**æœ€åæ›´æ–°**ï¼š2025-01-XX  
**çŠ¶æ€**ï¼šâœ… å®‰å…¨

