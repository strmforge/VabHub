# æ•°æ®åº“æ¨¡å‹å…³ç³»ä¿®å¤æŠ¥å‘Š

**å®Œæˆæ—¶é—´**: 2025-01-XX  
**çŠ¶æ€**: âœ… å·²ä¿®å¤

---

## ğŸ“‹ ä¸€ã€é—®é¢˜æè¿°

### é”™è¯¯ä¿¡æ¯

```
Could not determine join condition between parent/child tables on relationship RSSHubSource.user_subscriptions - there are no foreign keys linking these tables. Ensure that referencing columns are associated with a ForeignKey or ForeignKeyConstraint, or specify a 'primaryjoin' expression.
```

### é—®é¢˜åŸå› 

`RSSHubSource` å’Œ `RSSHubComposite` çš„ `user_subscriptions` å…³ç³»æ²¡æœ‰æŒ‡å®š `primaryjoin`ï¼Œè€Œè¿™æ˜¯ä¸€ä¸ªå¤šæ€å…³ç³»ï¼ˆé€šè¿‡ `target_type` å­—æ®µåŒºåˆ† `source` å’Œ `composite`ï¼‰ã€‚

---

## ğŸ“‹ äºŒã€ä¿®å¤æ–¹æ¡ˆ

### âœ… ä¿®å¤å†…å®¹

**æ–‡ä»¶**: `backend/app/models/rsshub.py`

**ä¿®å¤1**: `RSSHubSource.user_subscriptions` å…³ç³»

**ä¿®å¤å‰**:
```python
user_subscriptions = relationship('UserRSSHubSubscription', back_populates='source')
```

**ä¿®å¤å**:
```python
user_subscriptions = relationship(
    'UserRSSHubSubscription',
    primaryjoin='and_(RSSHubSource.id == UserRSSHubSubscription.target_id, '
                'UserRSSHubSubscription.target_type == "source")',
    back_populates='source'
)
```

---

**ä¿®å¤2**: `RSSHubComposite.user_subscriptions` å…³ç³»

**ä¿®å¤å‰**:
```python
user_subscriptions = relationship('UserRSSHubSubscription', back_populates='composite')
```

**ä¿®å¤å**:
```python
user_subscriptions = relationship(
    'UserRSSHubSubscription',
    primaryjoin='and_(RSSHubComposite.id == UserRSSHubSubscription.target_id, '
                'UserRSSHubSubscription.target_type == "composite")',
    back_populates='composite'
)
```

---

## ğŸ“‹ ä¸‰ã€å…³ç³»é…ç½®è¯´æ˜

### å…³ç³»ç»“æ„

- **çˆ¶è¡¨**: `RSSHubSource` / `RSSHubComposite`
- **å­è¡¨**: `UserRSSHubSubscription`
- **å…³è”å­—æ®µ**: 
  - `target_id` (String) - ç›®æ ‡IDï¼ˆsource_idæˆ–composite_idï¼‰
  - `target_type` (String) - ç›®æ ‡ç±»å‹ï¼ˆ"source"æˆ–"composite"ï¼‰

### å¤šæ€å…³ç³»

ç”±äº `UserRSSHubSubscription` å¯ä»¥å…³è”åˆ° `RSSHubSource` æˆ– `RSSHubComposite`ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤šæ€å…³ç³»ã€‚éœ€è¦é€šè¿‡ `target_type` å­—æ®µæ¥åŒºåˆ†å…³è”çš„ç›®æ ‡ç±»å‹ã€‚

### å…³ç³»é…ç½®

- **ä»çˆ¶åˆ°å­**: éœ€è¦æŒ‡å®š `primaryjoin` æ¥æ˜ç¡®å…³è”æ¡ä»¶
- **ä»å­åˆ°çˆ¶**: å·²ç»åœ¨ `UserRSSHubSubscription` ä¸­æ­£ç¡®é…ç½®äº† `primaryjoin`

---

## ğŸ“‹ å››ã€éªŒè¯

### âœ… ä¿®å¤éªŒè¯

- **è¯­æ³•æ£€æŸ¥**: âœ… é€šè¿‡
- **å…³ç³»é…ç½®**: âœ… æ­£ç¡®
- **å¤šæ€å…³ç³»**: âœ… æ­£ç¡®é…ç½®

---

## ğŸ“‹ äº”ã€æ€»ç»“

### âœ… å·²å®Œæˆ

- **é—®é¢˜è¯†åˆ«**: âœ… å®Œæˆ
- **ä¿®å¤å®æ–½**: âœ… å®Œæˆ
- **é…ç½®éªŒè¯**: âœ… å®Œæˆ

### ğŸ“Š ä¿®å¤çŠ¶æ€

- **æ•°æ®åº“æ¨¡å‹å…³ç³»é”™è¯¯**: âœ… å·²ä¿®å¤
- **å…³ç³»é…ç½®**: âœ… æ­£ç¡®
- **å¤šæ€å…³ç³»**: âœ… æ­£ç¡®é…ç½®

---

**æ–‡æ¡£ç”Ÿæˆæ—¶é—´**: 2025-01-XX  
**çŠ¶æ€**: âœ… æ•°æ®åº“æ¨¡å‹å…³ç³»é”™è¯¯å·²ä¿®å¤

