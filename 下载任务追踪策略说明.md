# 下载任务追踪策略说明

## 设计原则（参考MoviePilot）

VabHub采用与MoviePilot相同的策略：**默认只显示和追踪有VABHUB标签的下载任务**。

## 为什么这样做？

1. **避免干扰**：用户可能手动在下载器中添加任务，这些任务不应该出现在VabHub的管理界面中
2. **清晰管理**：只追踪VabHub创建的任务，管理更清晰
3. **性能优化**：减少需要处理的任务数量，提高性能

## 实现方式

### 后端
- **API端点**：`GET /api/downloads`
- **默认参数**：`vabhub_only=True`
- **过滤逻辑**：
  1. 从数据库获取所有任务
  2. 如果 `vabhub_only=True`，则从下载器API获取每个任务的标签
  3. 只返回包含VABHUB标签的任务
  4. 在返回结果中包含所有标签信息（用于显示）

### 前端
- **默认设置**：`vabhubOnly: true`
- **用户控制**：提供开关让用户选择是否只显示VABHUB标签的任务
- **标签显示**：在任务列表中显示所有标签（包括VABHUB和其他标签）

## 标签管理

### 自动添加标签
- VabHub创建下载任务时，自动添加"VABHUB"标签
- 支持qBittorrent的`tags`字段和Transmission的`labels`字段

### 标签显示
- **VABHUB标签**：使用primary颜色（蓝色）显示
- **其他标签**：使用secondary颜色（灰色）显示
- 例如：`订阅中, 刷版, VABHUB` 会显示为三个标签chip

## 用户操作

### 查看所有任务
如果用户想查看下载器中的所有任务（包括手动添加的），可以：
1. 在前端关闭"仅显示VABHUB标签"开关
2. 或者直接访问下载器的Web界面

### 手动添加VABHUB标签
如果用户手动在下载器中添加了任务，想要在VabHub中管理，可以：
1. 使用 `add_vabhub_labels.py` 脚本为任务添加VABHUB标签
2. 或者在下载器的Web界面中手动添加"VABHUB"标签

## 相关文件

- `VabHub/backend/app/api/download.py` - API端点（默认`vabhub_only=True`）
- `VabHub/backend/app/modules/download/service.py` - 服务层（默认`vabhub_only=True`）
- `VabHub/frontend/src/pages/Downloads.vue` - 前端页面（默认`vabhubOnly: true`）
- `VabHub/backend/scripts/add_vabhub_labels.py` - 标签添加脚本

---

**设计理念**：只追踪VabHub创建的任务，避免干扰用户的其他下载任务。

