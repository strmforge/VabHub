# 115网盘API端点完整对比分析

## 📋 文档访问情况

### 文档链接
- **主页面**: https://www.yuque.com/115yun/open/qur839kyx9cgxpxi
- **状态**: ⚠️ 无法直接访问（可能需要登录或特定权限）

### 访问建议
1. **直接访问**: 使用浏览器访问链接，可能需要登录115网盘账号
2. **申请权限**: 联系115网盘开放平台申请开发者权限
3. **获取文档**: 申请成功后获取完整的API文档和示例代码

### 已知信息源
1. **VabHub-1版本**: `VabHub-1/U115_CLOUD_FUNCTIONALITY_GUIDE.md`
2. **当前版本实现**: `VabHub/backend/app/core/cloud_storage/providers/cloud_115.py`
3. **新API客户端**: `VabHub/backend/app/core/cloud_storage/providers/cloud_115_api.py`

## 🔍 API域名对比

### 当前版本 (`cloud_115_api.py`)
- **API域名**: `https://webapi.115.com`
- **用途**: 文件管理API（开放API）

### VabHub-1版本 (`cloud_115.py`)
- **API域名**: `https://proapi.115.com`
- **Passport域名**: `https://passportapi.115.com`
- **二维码域名**: `https://qrcodeapi.115.com`
- **用途**: 文件管理API、认证API

### 分析
- `webapi.115.com`: 可能是115网盘开放API的正式域名
- `proapi.115.com`: 可能是115网盘专业版API域名
- 两个域名可能指向不同的API版本或服务

## 📊 完整API端点对比

### 1. 认证相关API

| API端点 | 方法 | 功能 | cloud_115.py | cloud_115_api.py | 状态 |
|---------|------|------|--------------|------------------|------|
| `https://passportapi.115.com/open/authDeviceCode` | POST | 获取设备码 | ✅ | ❌ | 需集成 |
| `https://qrcodeapi.115.com/get/status/` | GET | 检查二维码状态 | ✅ | ❌ | 需集成 |
| `https://passportapi.115.com/open/deviceCodeToToken` | POST | 设备码转令牌 | ✅ | ❌ | 需集成 |
| `https://passportapi.115.com/open/refreshToken` | POST | 刷新令牌 | ✅ | ❌ | 需集成 |

### 2. 文件查询API

| API端点 | 方法 | 功能 | cloud_115.py | cloud_115_api.py | 状态 |
|---------|------|------|--------------|------------------|------|
| `https://proapi.115.com/open/folder/get_info` | GET/POST | 获取文件夹信息 | ✅ | ❌ | 域名不同 |
| `https://webapi.115.com/open/folder/get_info` | GET/POST | 获取文件(夹)详情 | ❌ | ✅ | 已实现 |
| `https://proapi.115.com/open/ufile/files` | GET/POST | 列出文件 | ✅ | ❌ | 需对比 |
| `https://webapi.115.com/open/folder/list` | GET/POST | 获取文件列表 | ❌ | ✅ | 已实现 |
| `https://proapi.115.com/open/ufile/search` | GET | 搜索文件 | ✅ | ❌ | 域名不同 |
| `https://webapi.115.com/open/ufile/search` | GET | 搜索文件(夹) | ❌ | ✅ | 已实现 |

### 3. 文件操作API

| API端点 | 方法 | 功能 | cloud_115.py | cloud_115_api.py | 状态 |
|---------|------|------|--------------|------------------|------|
| `https://proapi.115.com/open/folder/add` | POST | 新建文件夹 | ✅ | ❌ | 域名不同 |
| `https://webapi.115.com/open/folder/add` | POST | 新建文件夹 | ❌ | ✅ | 已实现 |
| `https://proapi.115.com/open/ufile/update` | POST | 重命名文件/目录 | ✅ | ❌ | 端点不同 |
| `https://webapi.115.com/open/file/rename` | POST | 重命名文件(夹) | ❌ | ✅ | 已实现 |
| `https://proapi.115.com/open/ufile/move` | POST | 移动文件/目录 | ✅ | ❌ | 端点不同 |
| `https://webapi.115.com/open/file/move` | POST | 移动文件(夹) | ❌ | ✅ | 已实现 |
| `https://proapi.115.com/open/ufile/copy` | POST | 复制文件/目录 | ✅ | ❌ | 端点不同 |
| `https://webapi.115.com/open/file/copy` | POST | 复制文件(夹) | ❌ | ✅ | 已实现 |
| `https://proapi.115.com/open/ufile/delete` | POST | 删除文件/目录 | ✅ | ❌ | 端点不同 |
| `https://webapi.115.com/open/file/delete` | POST | 删除文件(夹) | ❌ | ✅ | 已实现 |

### 4. 文件上传/下载API

| API端点 | 方法 | 功能 | cloud_115.py | cloud_115_api.py | 状态 |
|---------|------|------|--------------|------------------|------|
| `https://proapi.115.com/open/upload/init` | POST | 初始化上传 | ✅ | ❌ | 待集成 |
| `https://proapi.115.com/open/upload/get_token` | GET | 获取上传凭证 | ✅ | ❌ | 待集成 |
| `https://proapi.115.com/open/upload/resume` | POST | 断点续传 | ✅ | ❌ | 待集成 |
| `https://proapi.115.com/open/ufile/downurl` | POST | 获取下载链接 | ✅ | ❌ | 待集成 |

**详细说明**:
- **上传流程**: 初始化上传 → 二次认证（如需要）→ 秒传检测 → 获取上传凭证 → OSS分片上传 → 完成
- **下载流程**: 获取下载链接 → 流式下载 → 保存文件
- **秒传检测**: 基于文件SHA1值检测是否可以秒传
- **分片上传**: 使用OSS2库进行分片上传，支持断点续传

### 5. 用户信息API

| API端点 | 方法 | 功能 | cloud_115.py | cloud_115_api.py | 状态 |
|---------|------|------|--------------|------------------|------|
| `https://proapi.115.com/open/user/info` | GET | 获取用户信息和存储空间 | ✅ | ❌ | 待实现 |

## 🔍 API端点差异分析

### 1. 域名差异

#### `proapi.115.com` vs `webapi.115.com`
- **proapi.115.com**: VabHub-1版本使用，可能是专业版API
- **webapi.115.com**: 当前版本使用，可能是开放API
- **建议**: 需要确认哪个是官方推荐的API域名

#### API端点路径差异

| 功能 | proapi.115.com | webapi.115.com |
|------|----------------|----------------|
| 重命名 | `/open/ufile/update` | `/open/file/rename` |
| 移动 | `/open/ufile/move` | `/open/file/move` |
| 复制 | `/open/ufile/copy` | `/open/file/copy` |
| 删除 | `/open/ufile/delete` | `/open/file/delete` |
| 文件列表 | `/open/ufile/files` | `/open/folder/list` |

### 2. 功能差异

#### cloud_115.py (VabHub-1版本)
- ✅ 完整的OAuth2认证流程
- ✅ 二维码扫码登录
- ✅ 文件上传（秒传、分片上传、断点续传）
- ✅ 文件下载
- ✅ 文件管理（列表、重命名、移动、复制、删除）
- ✅ 用户信息查询
- ✅ 存储空间查询

#### cloud_115_api.py (当前版本)
- ✅ 文件查询（获取详情、列表、搜索）
- ✅ 文件操作（创建、删除、重命名、移动、复制）
- ✅ 文件夹操作（创建文件夹）
- ✅ 文件同步（时间范围搜索、文件变更检测）
- ❌ OAuth2认证（需要集成）
- ❌ 文件上传（待实现）
- ❌ 文件下载（待实现）
- ❌ 用户信息查询（待实现）

## 🎯 建议的整合方案

### 方案1: 统一使用webapi.115.com（推荐用于开放API）

**优点**:
- 当前版本的API端点更规范（`/open/file/*`）
- 可能是115网盘开放API的正式域名
- API端点命名更清晰
- 符合RESTful规范

**缺点**:
- 需要验证所有API端点是否可用
- 可能需要迁移现有的实现
- 可能缺少上传/下载功能

**适用场景**: 
- 文件查询和操作
- 文件管理
- 文件同步

### 方案2: 统一使用proapi.115.com（推荐用于完整功能）

**优点**:
- VabHub-1版本已经验证可用
- 功能更完整（包括上传、下载）
- 支持OAuth2认证
- 支持秒传、分片上传、断点续传

**缺点**:
- API端点命名不够规范（`/open/ufile/*`）
- 可能是专业版API

**适用场景**:
- 完整的文件管理功能
- 文件上传/下载
- OAuth2认证

### 方案3: 混合使用（当前状态，推荐）

**优点**:
- 充分利用两个版本的实现
- 功能更完整
- 可以根据场景选择API

**缺点**:
- 维护成本高
- 可能出现兼容性问题
- 需要统一接口抽象

**建议实现**:
- **cloud_115_api.py**: 用于文件查询和操作（使用webapi.115.com）
- **cloud_115.py**: 用于文件上传/下载和OAuth2认证（使用proapi.115.com）
- **统一接口**: 通过`CloudStorageProvider`基类统一接口

## 📝 待确认的问题

### 1. API域名
- [ ] `webapi.115.com`和`proapi.115.com`的区别是什么？
- [ ] 哪个域名是官方推荐使用的？
- [ ] 两个域名的API端点是否完全兼容？

### 2. API端点
- [ ] `/open/ufile/update`和`/open/file/rename`是否功能相同？
- [ ] `/open/ufile/files`和`/open/folder/list`是否功能相同？
- [ ] 两个版本的API响应格式是否一致？

### 3. 认证方式
- [ ] OAuth2认证流程是否相同？
- [ ] Access Token是否可以在两个域名间通用？
- [ ] 令牌刷新机制是否相同？

## 🚧 待实现的功能

### 高优先级

1. **OAuth2认证集成**
   - 集成到`cloud_115_api.py`
   - 实现二维码扫码登录
   - 实现令牌刷新

2. **文件上传API**
   - 实现文件上传到115网盘
   - 支持秒传检测
   - 支持分片上传
   - 支持断点续传

3. **文件下载API**
   - 实现从115网盘下载文件
   - 支持分片下载
   - 支持断点续传

4. **用户信息API**
   - 实现用户信息查询
   - 实现存储空间查询

### 中优先级

5. **API域名统一**
   - 确认使用的API域名
   - 统一API端点
   - 迁移现有实现

6. **功能对比测试**
   - 对比两个版本的API功能
   - 测试API兼容性
   - 验证API响应格式

## 🎉 总结

### 当前状态

1. **cloud_115_api.py** (新实现)
   - ✅ 使用`webapi.115.com`域名
   - ✅ 实现了文件查询和操作API
   - ✅ API端点命名更规范
   - ❌ 缺少OAuth2认证
   - ❌ 缺少文件上传/下载

2. **cloud_115.py** (VabHub-1版本)
   - ✅ 使用`proapi.115.com`域名
   - ✅ 实现了完整的OAuth2认证
   - ✅ 实现了文件上传/下载
   - ✅ 功能更完整
   - ⚠️ API端点命名不够规范

### 建议

1. **短期**: 保持两个实现，各自发挥优势
2. **中期**: 整合两个实现，统一API域名和端点
3. **长期**: 基于官方API文档，实现完整的115网盘API客户端

### 下一步行动

1. **获取官方API文档**
   - 联系115网盘开放平台
   - 申请开发者权限
   - 获取完整的API文档

2. **API功能测试**
   - 测试`webapi.115.com`的API端点
   - 测试`proapi.115.com`的API端点
   - 对比两个版本的API功能

3. **功能整合**
   - 整合OAuth2认证到`cloud_115_api.py`
   - 整合文件上传/下载功能
   - 统一API域名和端点

## 📚 参考资源

- **115网盘开放API文档**: https://www.yuque.com/115yun/open/qur839kyx9cgxpxi
- **VabHub-1 115网盘功能指南**: `VabHub-1/U115_CLOUD_FUNCTIONALITY_GUIDE.md`
- **当前版本115网盘API客户端**: `VabHub/backend/app/core/cloud_storage/providers/cloud_115_api.py`
- **VabHub-1 115网盘提供商**: `VabHub/backend/app/core/cloud_storage/providers/cloud_115.py`

