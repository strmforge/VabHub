# VabHub 用户文档 - 新功能

## 📋 目录

1. [媒体文件管理](#媒体文件管理)
2. [字幕管理](#字幕管理)
3. [豆瓣API集成](#豆瓣api集成)
4. [重复文件检测](#重复文件检测)
5. [文件质量比较](#文件质量比较)

---

## 媒体文件管理

### 功能概述

媒体文件管理功能可以帮助您：
- 识别媒体文件信息（标题、年份、类型、质量等）
- 自动重命名媒体文件
- 整理媒体文件到指定目录
- 批量处理多个媒体文件
- 自动下载字幕

### 使用步骤

#### 1. 文件识别

1. 访问 **媒体文件管理** 页面
2. 选择 **文件识别** 标签页
3. 输入文件路径（例如：`/path/to/movie.mkv`）
4. 点击 **识别文件** 按钮
5. 查看识别结果（标题、年份、类型、质量等）

#### 2. 文件整理

1. 选择 **文件整理** 标签页
2. 输入源文件路径和目标目录
3. 配置选项：
   - **重命名模板**（可选）：例如 `{title} ({year})`
   - **移动文件**：是否移动文件到目标目录
   - **下载字幕**：是否自动下载字幕
   - **字幕语言**：选择字幕语言（中文、英文等）
   - **使用分类规则**：是否使用分类规则整理文件
4. 点击 **整理文件** 按钮
5. 查看整理结果

#### 3. 批量处理

1. 选择 **批量处理** 标签页
2. 输入源目录路径和目标目录
3. 配置选项（同文件整理）
4. 点击 **批量整理** 按钮
5. 查看批量处理结果（成功数量、失败数量、详细结果）

### 注意事项

- 文件路径必须是服务器上的绝对路径
- 确保服务器有读取/写入文件的权限
- 大文件操作可能需要较长时间
- 建议先使用文件识别功能确认文件信息

---

## 字幕管理

### 功能概述

字幕管理功能可以帮助您：
- 查看所有字幕文件
- 搜索字幕
- 下载字幕
- 删除字幕
- 查看字幕详情

### 使用步骤

#### 1. 查看字幕列表

1. 访问 **字幕管理** 页面
2. 查看字幕列表
3. 使用搜索和过滤功能：
   - **搜索**：按媒体文件路径或标题搜索
   - **语言过滤**：按语言过滤字幕
4. 使用分页功能浏览更多字幕

#### 2. 下载字幕

1. 点击 **下载字幕** 按钮
2. 输入媒体文件路径
3. 选择字幕语言
4. 配置选项：
   - **保存路径**（可选）：留空则自动保存到媒体文件同目录
   - **强制下载**：是否强制下载（忽略自动下载设置）
5. 点击 **下载** 按钮
6. 等待下载完成

#### 3. 搜索字幕

1. 点击字幕项的操作菜单
2. 选择 **搜索字幕**
3. 输入媒体文件路径和语言
4. 点击 **搜索字幕** 按钮
5. 查看搜索结果
6. 选择并下载合适的字幕

#### 4. 删除字幕

1. 在字幕列表中找到要删除的字幕
2. 点击操作菜单
3. 选择 **删除**
4. 确认删除操作

### 注意事项

- 字幕会自动匹配媒体文件
- 支持多种字幕格式（SRT、ASS、VTT等）
- 字幕下载可能需要一些时间
- 删除字幕操作不可撤销

---

## 豆瓣API集成

### 功能概述

豆瓣API集成功能可以提供：
- 搜索豆瓣电影和电视剧
- 获取媒体详细信息
- 查看豆瓣评分
- 浏览TOP250榜单
- 查看热门电影和电视剧

### 使用方式

#### 1. 搜索媒体

**API端点**: `GET /api/v1/douban/search`

**参数**:
- `query`: 搜索关键词
- `media_type`: 媒体类型（movie 或 tv）
- `count`: 返回数量

**示例**:
```bash
GET /api/v1/douban/search?query=肖申克的救赎&media_type=movie&count=10
```

#### 2. 获取媒体详情

**API端点**: `GET /api/v1/douban/detail/{subject_id}`

**参数**:
- `subject_id`: 豆瓣主题ID
- `media_type`: 媒体类型

**示例**:
```bash
GET /api/v1/douban/detail/1292052?media_type=movie
```

#### 3. 获取评分

**API端点**: `GET /api/v1/douban/rating/{subject_id}`

**参数**:
- `subject_id`: 豆瓣主题ID
- `media_type`: 媒体类型

**示例**:
```bash
GET /api/v1/douban/rating/1292052?media_type=movie
```

#### 4. 获取TOP250榜单

**API端点**: `GET /api/v1/douban/top250`

**参数**:
- `start`: 起始位置
- `count`: 返回数量

**示例**:
```bash
GET /api/v1/douban/top250?start=0&count=20
```

### 注意事项

- 豆瓣API响应会被缓存1小时
- 某些功能可能需要网络连接
- API可能有请求频率限制

---

## 重复文件检测

### 功能概述

重复文件检测功能可以帮助您：
- 检测目录中的重复文件
- 按文件大小快速检测
- 按文件哈希值精确检测
- 比较重复文件的质量
- 推荐保留的文件

### 使用方式

#### 1. 检测重复文件

**API端点**: `POST /api/v1/duplicate-detection/detect`

**参数**:
- `directory`: 要检测的目录路径
- `extensions`: 文件扩展名列表（可选）
- `use_hash`: 是否使用哈希值检测（默认 true）

**示例**:
```bash
POST /api/v1/duplicate-detection/detect
{
  "directory": "/path/to/media",
  "extensions": [".mp4", ".mkv"],
  "use_hash": false
}
```

#### 2. 比较重复文件质量

**API端点**: `POST /api/v1/duplicate-detection/compare`

**请求体**:
```json
[
  "/path/to/file1.mkv",
  "/path/to/file2.mkv",
  "/path/to/file3.mkv"
]
```

### 注意事项

- 大目录检测可能需要较长时间
- 使用哈希值检测更精确但更慢
- 建议先使用快速检测（按大小）
- 检测结果会推荐保留质量最好的文件

---

## 文件质量比较

### 功能概述

文件质量比较功能可以帮助您：
- 分析单个文件的质量
- 比较多个文件的质量
- 计算文件质量评分
- 推荐质量最好的文件

### 质量评估标准

#### 分辨率优先级
- 4K (2160p): 最高优先级
- 1440p: 高优先级
- 1080p: 中高优先级
- 720p: 中优先级
- 480p: 低优先级
- 360p: 较低优先级
- 240p: 最低优先级

#### 编码器优先级
- H.266 (VVC): 最高优先级
- AV1: 高优先级
- H.265 (HEVC): 中高优先级
- H.264 (AVC): 中优先级
- VP9: 中低优先级

#### 质量评分
- 分辨率评分: 0-60分
- 编码器评分: 0-30分
- 文件大小评分: 0-10分
- 总分: 0-100分

### 使用方式

#### 1. 分析文件质量

**API端点**: `POST /api/v1/quality-comparison/analyze`

**参数**:
- `file_path`: 文件路径

**示例**:
```bash
POST /api/v1/quality-comparison/analyze?file_path=/path/to/movie.mkv
```

#### 2. 比较文件质量

**API端点**: `POST /api/v1/quality-comparison/compare`

**请求体**:
```json
[
  "/path/to/file1.mkv",
  "/path/to/file2.mkv",
  "/path/to/file3.mkv"
]
```

### 注意事项

- 质量评分基于文件名提取的信息
- 实际质量可能与评分有差异
- 建议结合文件大小和实际观看效果判断
- 质量评分仅供参考

---

## 常见问题

### Q: 文件识别失败怎么办？

A: 请检查：
1. 文件路径是否正确
2. 文件是否存在
3. 服务器是否有读取权限
4. 文件格式是否支持

### Q: 字幕下载失败怎么办？

A: 请检查：
1. 媒体文件路径是否正确
2. 网络连接是否正常
3. 字幕源是否可用
4. 字幕语言是否正确

### Q: 重复文件检测很慢怎么办？

A: 可以：
1. 使用快速检测（按大小）
2. 缩小检测目录范围
3. 指定文件扩展名
4. 使用哈希值检测（更精确但更慢）

### Q: 质量评分不准确怎么办？

A: 质量评分基于文件名提取的信息，可能不够准确。建议：
1. 结合文件大小判断
2. 实际观看效果
3. 使用专业的媒体分析工具

---

## 技术支持

如有问题，请：
1. 查看API文档
2. 查看错误日志
3. 联系技术支持

---

**最后更新**: 2025-01-XX

