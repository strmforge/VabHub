# COOKIECLOUD-1 å®Œæ•´ä½¿ç”¨æŒ‡å—

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**CookieCloud-1** æ˜¯ VabHub çš„ Cookie åŒæ­¥åŠŸèƒ½æ¨¡å—ï¼Œå®ç°äº† æµè§ˆå™¨ â†’ CookieCloud â†’ VabHub â†’ PTç«™ç‚¹ çš„ä¸€æ¡é“¾è·¯åŒæ­¥ã€‚

**æ ¸å¿ƒç‰¹æ€§**ï¼š
- ğŸ”„ è‡ªåŠ¨ Cookie åŒæ­¥ï¼ˆåŸºäºå®šæ—¶ä»»åŠ¡ï¼‰
- ğŸ›¡ï¸ å®‰å…¨åŸŸåç™½åå•ä¿æŠ¤
- ğŸ“Š å®Œæ•´çš„åŒæ­¥çŠ¶æ€ç›‘æ§
- ğŸ”§ çµæ´»çš„é…ç½®ç®¡ç†
- ğŸš€ æ‰¹é‡å¤„ç†å’Œé‡è¯•æœºåˆ¶

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æµè§ˆå™¨     â”‚â”€â”€â”€â–¶â”‚ CookieCloud â”‚â”€â”€â”€â–¶â”‚   VabHub    â”‚â”€â”€â”€â–¶â”‚   PTç«™ç‚¹    â”‚
â”‚  (Cookieæ‰©å±•) â”‚    â”‚   æœåŠ¡å™¨     â”‚    â”‚  (åŒæ­¥æœåŠ¡)   â”‚    â”‚  (è‡ªåŠ¨ç™»å½•)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶

1. **CookieCloudSyncService** - æ ¸å¿ƒåŒæ­¥æœåŠ¡
2. **APIè·¯ç”±** - 7ä¸ªRESTfulç«¯ç‚¹
3. **å®šæ—¶ä»»åŠ¡** - APScheduleré›†æˆ
4. **å‰ç«¯ç•Œé¢** - Settingsé¡µé¢é›†æˆ
5. **æ•°æ®æ¨¡å‹** - CookieCloudSettingsè¡¨

---

## ğŸ”§ å¿«é€Ÿå¼€å§‹

### 1. è·å–CookieCloudæœåŠ¡å™¨ä¿¡æ¯

#### æ–¹å¼ä¸€ï¼šè‡ªå»ºCookieCloudæœåŠ¡å™¨
```bash
# Docker éƒ¨ç½²
docker run -d \
  --name cookiecloud \
  -p 8088:80 \
  -v /path/to/data:/data \
  yokingma/cookiecloud:latest
```

#### æ–¹å¼äºŒï¼šä½¿ç”¨å…¬å…±æœåŠ¡å™¨
- å®˜æ–¹æœåŠ¡å™¨ï¼š`https://cookiecloud.yokingma.com`
- ç¬¬ä¸‰æ–¹æœåŠ¡å™¨ï¼šè¯·ç¡®ä¿æœåŠ¡å™¨å¯ä¿¡åº¦

### 2. è·å–UUIDå’Œå¯†ç 

1. åœ¨æµè§ˆå™¨ä¸­å®‰è£…CookieCloudæ‰©å±•
2. è®¿é—®CookieCloudæœåŠ¡å™¨Webç•Œé¢
3. åˆ›å»ºè´¦æˆ·å¹¶è·å–UUIDå’Œå¯†ç 
4. åœ¨æ‰©å±•ä¸­é…ç½®æœåŠ¡å™¨ä¿¡æ¯å¹¶æµ‹è¯•è¿æ¥

### 3. é…ç½®VabHub

1. ç™»å½•VabHubç®¡ç†ç•Œé¢
2. è¿›å…¥ **è®¾ç½® â†’ CookieCloudè®¾ç½®**
3. å¡«å†™é…ç½®ä¿¡æ¯ï¼š
   - âœ… å¯ç”¨CookieCloudåŒæ­¥
   - ğŸŒ CookieCloudæœåŠ¡å™¨åœ°å€ï¼š`https://your-server.com`
   - ğŸ”‘ UUIDï¼š`your-uuid-here`
   - ğŸ”’ å¯†ç ï¼š`your-password-here`
   - â° åŒæ­¥é—´éš”ï¼ˆåˆ†é’Ÿï¼‰ï¼š`60`
   - ğŸ›¡ï¸ å®‰å…¨åŸŸåç™½åå•ï¼š
     ```
     tracker.example.com
     pt.example.org
     *.example.net
     ```

4. ç‚¹å‡» **æµ‹è¯•è¿æ¥** éªŒè¯é…ç½®
5. ç‚¹å‡» **ä¿å­˜è®¾ç½®** å®Œæˆé…ç½®

---

## ğŸ“š APIæ–‡æ¡£

### åŸºç¡€ä¿¡æ¯

- **Base URL**: `/api/cookiecloud`
- **è®¤è¯æ–¹å¼**: Bearer Token
- **å“åº”æ ¼å¼**: JSON

### ç«¯ç‚¹åˆ—è¡¨

#### 1. è·å–è®¾ç½®
```http
GET /api/cookiecloud/settings
Authorization: Bearer {token}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "data": {
    "enabled": true,
    "host": "https://cookiecloud.example.com",
    "uuid": "12345678-1234-1234-1234-123456789abc",
    "password": "***",
    "sync_interval_minutes": 60,
    "safe_host_whitelist": ["tracker.example.com"],
    "last_sync_at": "2025-11-29T10:30:00Z",
    "last_status": "SUCCESS",
    "last_error": null,
    "created_at": "2025-11-29T09:00:00Z",
    "updated_at": "2025-11-29T10:30:00Z"
  },
  "message": "è·å–è®¾ç½®æˆåŠŸ"
}
```

#### 2. æ›´æ–°è®¾ç½®
```http
PUT /api/cookiecloud/settings
Authorization: Bearer {token}
Content-Type: application/json

{
  "enabled": true,
  "host": "https://cookiecloud.example.com",
  "uuid": "12345678-1234-1234-1234-123456789abc",
  "password": "your-password",
  "sync_interval_minutes": 60,
  "safe_host_whitelist": ["tracker.example.com"]
}
```

#### 3. è§¦å‘åŒæ­¥
```http
POST /api/cookiecloud/sync
Authorization: Bearer {token}
Content-Type: application/json

{
  "batch_size": 10,
  "site_timeout": 30
}
```

#### 4. ç«‹å³åŒæ­¥
```http
POST /api/cookiecloud/sync-immediate
Authorization: Bearer {token}
Content-Type: application/json

{
  "batch_size": 10,
  "site_timeout": 30
}
```

#### 5. å•ç«™ç‚¹åŒæ­¥
```http
POST /api/cookiecloud/sync-site/{site_id}
Authorization: Bearer {token}
```

#### 6. æµ‹è¯•è¿æ¥
```http
POST /api/cookiecloud/test-connection
Authorization: Bearer {token}
```

#### 7. è·å–çŠ¶æ€
```http
GET /api/cookiecloud/status
Authorization: Bearer {token}
```

#### 8. è·å–åŒæ­¥å†å²
```http
GET /api/cookiecloud/sync-history?page=1&size=20
Authorization: Bearer {token}
```

### é”™è¯¯ç è¯´æ˜

| çŠ¶æ€ç  | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|
| 200 | æˆåŠŸ | æ“ä½œæˆåŠŸå®Œæˆ |
| 400 | è¯·æ±‚é”™è¯¯ | é…ç½®ä¸å®Œæ•´ã€å‚æ•°æ— æ•ˆ |
| 401 | è®¤è¯å¤±è´¥ | Tokenæ— æ•ˆæˆ–è¿‡æœŸ |
| 404 | èµ„æºä¸å­˜åœ¨ | ç«™ç‚¹IDä¸å­˜åœ¨ |
| 429 | è¯·æ±‚è¿‡äºé¢‘ç¹ | è§¦å‘é€Ÿç‡é™åˆ¶ |
| 500 | æœåŠ¡å™¨é”™è¯¯ | å†…éƒ¨å¼‚å¸¸ |

---

## ğŸ›¡ï¸ å®‰å…¨é…ç½®

### åŸŸåç™½åå•

ä¸ºäº†å®‰å…¨èµ·è§ï¼Œå»ºè®®é…ç½®åŸŸåç™½åå•ï¼ŒåªåŒæ­¥æŒ‡å®šåŸŸåçš„Cookieï¼š

```yaml
# æ¨èé…ç½®ç¤ºä¾‹
safe_host_whitelist:
  - "tracker.example.com"      # ç²¾ç¡®åŒ¹é…
  - "pt.example.org"          # ç²¾ç¡®åŒ¹é…
  - "*.example.net"           # é€šé…ç¬¦åŒ¹é…
  - "forum.*.com"             # å¤šçº§é€šé…ç¬¦
```

### å®‰å…¨æœ€ä½³å®è·µ

1. **ä½¿ç”¨HTTPS**ï¼šç¡®ä¿CookieCloudæœåŠ¡å™¨ä½¿ç”¨HTTPS
2. **å®šæœŸæ›´æ¢å¯†ç **ï¼šå»ºè®®æ¯æœˆæ›´æ¢ä¸€æ¬¡CookieCloudå¯†ç 
3. **é™åˆ¶åŸŸåèŒƒå›´**ï¼šåªåŒæ­¥å¿…è¦çš„PTç«™ç‚¹åŸŸå
4. **ç›‘æ§åŒæ­¥æ—¥å¿—**ï¼šå®šæœŸæ£€æŸ¥åŒæ­¥çŠ¶æ€å’Œé”™è¯¯ä¿¡æ¯
5. **å¤‡ä»½æ•°æ®**ï¼šå®šæœŸå¤‡ä»½CookieCloudæœåŠ¡å™¨æ•°æ®

---

## âš™ï¸ é«˜çº§é…ç½®

### åŒæ­¥é—´éš”è®¾ç½®

| åœºæ™¯ | æ¨èé—´éš” | è¯´æ˜ |
|------|----------|------|
| ä¸ªäººä½¿ç”¨ | 60-120åˆ†é’Ÿ | å¹³è¡¡å®æ—¶æ€§å’Œèµ„æºæ¶ˆè€— |
| å¤šç”¨æˆ·å…±äº« | 30-60åˆ†é’Ÿ | æé«˜åŒæ­¥é¢‘ç‡ |
| æœåŠ¡å™¨èµ„æºæœ‰é™ | 120-240åˆ†é’Ÿ | é™ä½èµ„æºæ¶ˆè€— |
| é«˜é¢‘æ›´æ–°éœ€æ±‚ | 15-30åˆ†é’Ÿ | å®æ—¶æ€§ä¼˜å…ˆ |

### æ‰¹å¤„ç†å‚æ•°

```json
{
  "batch_size": 10,        // æ¯æ‰¹å¤„ç†çš„ç«™ç‚¹æ•°é‡
  "site_timeout": 30       // å•ç«™ç‚¹è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
}
```

**å‚æ•°å»ºè®®**ï¼š
- `batch_size`: 5-20ï¼ˆæ ¹æ®æœåŠ¡å™¨æ€§èƒ½è°ƒæ•´ï¼‰
- `site_timeout`: 15-60ç§’ï¼ˆæ ¹æ®ç½‘ç»œçŠ¶å†µè°ƒæ•´ï¼‰

---

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. è¿æ¥æµ‹è¯•å¤±è´¥

**å¯èƒ½åŸå› **ï¼š
- æœåŠ¡å™¨åœ°å€é”™è¯¯
- UUIDæˆ–å¯†ç é”™è¯¯
- ç½‘ç»œè¿æ¥é—®é¢˜
- CookieCloudæœåŠ¡å™¨æ•…éšœ

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥æœåŠ¡å™¨åœ°å€æ˜¯å¦æ­£ç¡®ï¼ˆåŒ…å«http://æˆ–https://ï¼‰
2. éªŒè¯UUIDå’Œå¯†ç æ˜¯å¦åŒ¹é…
3. æµ‹è¯•ç½‘ç»œè¿æ¥ï¼š`curl -I https://your-server.com`
4. æ£€æŸ¥CookieCloudæœåŠ¡å™¨çŠ¶æ€

#### 2. åŒæ­¥éƒ¨åˆ†å¤±è´¥

**å¯èƒ½åŸå› **ï¼š
- éƒ¨åˆ†ç«™ç‚¹åŸŸåä¸åœ¨ç™½åå•ä¸­
- ç«™ç‚¹ç½‘ç»œè¶…æ—¶
- Cookieæ ¼å¼ä¸å…¼å®¹

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥åŸŸåç™½åå•é…ç½®
2. å¢åŠ site_timeoutå‚æ•°
3. æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—

#### 3. å®šæ—¶ä»»åŠ¡ä¸æ‰§è¡Œ

**å¯èƒ½åŸå› **ï¼š
- æœåŠ¡å™¨é‡å¯åä»»åŠ¡æœªæ¢å¤
- åŒæ­¥é—´éš”è®¾ç½®ä¸º0
- è°ƒåº¦å™¨æœåŠ¡å¼‚å¸¸

**è§£å†³æ–¹æ³•**ï¼š
1. é‡æ–°ä¿å­˜è®¾ç½®ä»¥æ¢å¤å®šæ—¶ä»»åŠ¡
2. æ£€æŸ¥sync_interval_minutes > 0
3. æŸ¥çœ‹è°ƒåº¦å™¨æ—¥å¿—

### æ—¥å¿—æŸ¥çœ‹

```bash
# æŸ¥çœ‹CookieCloudç›¸å…³æ—¥å¿—
tail -f logs/vabhub.log | grep cookiecloud

# æŸ¥çœ‹è°ƒåº¦å™¨æ—¥å¿—
tail -f logs/vabhub.log | grep scheduler
```

---

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### çŠ¶æ€ç›‘æ§

é€šè¿‡APIè·å–å®æ—¶çŠ¶æ€ï¼š
```bash
curl -H "Authorization: Bearer {token}" \
  http://localhost:8001/api/cookiecloud/status
```

### æ€§èƒ½ä¼˜åŒ–

1. **æ•°æ®åº“ä¼˜åŒ–**ï¼šå®šæœŸæ¸…ç†åŒæ­¥å†å²è®°å½•
2. **ç½‘ç»œä¼˜åŒ–**ï¼šé…ç½®åˆé€‚çš„è¶…æ—¶å’Œé‡è¯•å‚æ•°
3. **èµ„æºç›‘æ§**ï¼šç›‘æ§CPUå’Œå†…å­˜ä½¿ç”¨æƒ…å†µ

### ç»´æŠ¤ä»»åŠ¡

```bash
# å®šæœŸç»´æŠ¤è„šæœ¬ç¤ºä¾‹
#!/bin/bash
# æ¯å‘¨æ‰§è¡Œä¸€æ¬¡

# 1. æ¸…ç†è¿‡æœŸæ—¥å¿—
find logs/ -name "*.log" -mtime +7 -delete

# 2. æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h

# 3. é‡å¯è°ƒåº¦å™¨ï¼ˆå¦‚éœ€è¦ï¼‰
systemctl restart vabhub
```

---

## ğŸ§ª æµ‹è¯•æŒ‡å—

### å•å…ƒæµ‹è¯•

```bash
# è¿è¡ŒCookieCloudç›¸å…³æµ‹è¯•
pytest tests/test_cookiecloud_*.py -v
```

### é›†æˆæµ‹è¯•

```bash
# æµ‹è¯•APIç«¯ç‚¹
pytest tests/test_cookiecloud_api.py -v

# æµ‹è¯•åŒæ­¥æœåŠ¡
pytest tests/test_cookiecloud_service.py -v
```

### æ‰‹åŠ¨æµ‹è¯•æ¸…å•

- [ ] é…ç½®ä¿å­˜å’ŒåŠ è½½
- [ ] è¿æ¥æµ‹è¯•åŠŸèƒ½
- [ ] æ‰‹åŠ¨åŒæ­¥è§¦å‘
- [ ] å®šæ—¶ä»»åŠ¡æ‰§è¡Œ
- [ ] é”™è¯¯å¤„ç†æœºåˆ¶
- [ ] å‰ç«¯ç•Œé¢äº¤äº’

---

## ğŸ“ˆ æ‰©å±•å¼€å‘

### è‡ªå®šä¹‰åŒæ­¥é€»è¾‘

```python
# æ‰©å±•ç¤ºä¾‹
class CustomCookieCloudSyncService(CookieCloudSyncService):
    async def custom_sync_logic(self, site: Site):
        """è‡ªå®šä¹‰åŒæ­¥é€»è¾‘"""
        # å®ç°è‡ªå®šä¹‰é€»è¾‘
        pass
```

### æ’ä»¶é›†æˆ

CookieCloudæ”¯æŒä¸VabHubæ’ä»¶ç³»ç»Ÿé›†æˆï¼š

```python
# æ’ä»¶ä¸­æ³¨å†ŒåŒæ­¥é’©å­
@register_sync_hook
def custom_sync_handler(site_data):
    """å¤„ç†åŒæ­¥æ•°æ®"""
    pass
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### è·å–å¸®åŠ©

1. **æ–‡æ¡£æŸ¥é˜…**ï¼šæŸ¥çœ‹æœ¬æ–‡æ¡£å’Œç›¸å…³APIæ–‡æ¡£
2. **æ—¥å¿—åˆ†æ**ï¼šæ£€æŸ¥è¯¦ç»†é”™è¯¯æ—¥å¿—
3. **ç¤¾åŒºæ”¯æŒ**ï¼šè®¿é—®VabHubç¤¾åŒºè®ºå›
4. **é—®é¢˜åé¦ˆ**ï¼šæäº¤Issueåˆ°é¡¹ç›®ä»“åº“

### è”ç³»æ–¹å¼

- **é¡¹ç›®ä»“åº“**ï¼šhttps://github.com/your-org/vabhub
- **æ–‡æ¡£ç«™ç‚¹**ï¼šhttps://docs.vabhub.com
- **ç¤¾åŒºè®ºå›**ï¼šhttps://community.vabhub.com

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (2025-11-29)
- âœ… å®Œæ•´çš„CookieCloudåŒæ­¥åŠŸèƒ½
- âœ… å®šæ—¶ä»»åŠ¡é›†æˆ
- âœ… å‰ç«¯ç•Œé¢é›†æˆ
- âœ… å®‰å…¨åŸŸåç™½åå•
- âœ… æ‰¹é‡å¤„ç†å’Œé‡è¯•æœºåˆ¶
- âœ… å®Œæ•´çš„APIæ–‡æ¡£

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®éµå¾ª MIT è®¸å¯è¯ã€‚è¯¦è§ [LICENSE](../LICENSE) æ–‡ä»¶ã€‚

---

*æœ€åæ›´æ–°ï¼š2025-11-29*
