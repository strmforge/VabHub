# Manga Source 用户指南

## 概述

本指南详细介绍如何使用 VabHub 的外部漫画源功能，包括搜索漫画、远程追更、接收通知等完整工作流程。

## 前置条件

1. **已配置漫画源**：参考 [配置指南](./CONFIGURATION.md)
2. **已启用通知**：Telegram Bot 或 Web 通知
3. **有访问权限**：能够访问漫画中心的用户账号

## 基础使用流程

### 1. 访问外部源功能

1. 登录 VabHub Web 界面
2. 进入「漫画中心」
3. 点击「从外部源导入」或「远程漫画浏览」

### 2. 搜索漫画

#### 单源搜索

1. 在源选择器中选择特定源（如 Komga）
2. 在搜索框输入漫画名称
3. 点击搜索或按回车
4. 浏览搜索结果

#### 聚合搜索（推荐）

1. 切换「聚合搜索」开关
2. 在搜索框输入漫画名称
3. 系统自动搜索所有启用的源
4. 结果按源分组显示

### 3. 查看漫画详情

1. 点击搜索结果中的漫画卡片
2. 查看详细信息：
   - 漫画封面和基本信息
   - 章节列表
   - 来源信息
   - 更新状态

### 4. 追更漫画

有两种方式可以追更漫画：

#### 方式一：从搜索结果追更

1. 在搜索结果中找到目标漫画
2. 点击「追这部」按钮
3. 确认追更成功

#### 方式二：从详情页面追更

1. 进入漫画详情页面
2. 点击右上角的「追这部」按钮
3. 确认追更成功

### 5. 管理追更列表

1. 进入「漫画中心」→「我的追更」
2. 查看所有追更的漫画：
   - 本地导入的漫画
   - 外部源追更的漫画（有源标识）
3. 可以进行以下操作：
   - 取消追更
   - 标记已读
   - 在原站打开

## 高级功能

### 聚合搜索技巧

#### 使用源过滤器

1. 在聚合搜索模式下
2. 点击源过滤器
3. 选择要搜索的特定源类型：
   - 全部源
   - 仅 Komga
   - 仅 OPDS
   - 仅 Suwayomi

#### 搜索优化

- **使用精确关键词**：避免过于通用的词汇
- **尝试不同语言**：某些源可能支持多语言搜索
- **检查源状态**：如果某个源无结果，检查该源是否正常运行

### 远程追更管理

#### 理解远程追更

远程追更的特点：
- ✅ 不下载章节到本地
- ✅ 节省存储空间
- ✅ 实时检测更新
- ✅ 原站阅读体验
- ❌ 需要网络连接
- ❌ 依赖外部源可用性

#### 批量追更操作

1. 在搜索结果页面
2. 勾选多个漫画
3. 点击批量操作
4. 选择「批量追更」

#### 追更状态查看

在追更列表中，每部漫画显示：
- **源标识**：显示漫画来源（Komga、OPDS 等）
- **未读章节数**：新增的章节数量
- **最后更新时间**：上次检测到更新的时间
- **操作按钮**：原站打开、取消追更等

### 通知管理

#### 开启通知

1. 进入「设置」→「通知设置」
2. 配置 Telegram Bot：
   - 添加 Bot Token
   - 绑定用户账号
3. 启用漫画更新通知

#### 通知内容

当追更的漫画有更新时，您会收到：

```
📚 漫画更新通知

《漫画名称》新增 3 章节
来源：Komga
📖 立即阅读 | 🌐 在原站打开
```

#### 通知操作

- **立即阅读**：跳转到 VabHub 阅读器（仅限本地导入）
- **在原站打开**：跳转到外部漫画源（远程追更）

## 实际使用场景

### 场景一：发现新漫画

1. **搜索感兴趣的漫画**
   ```
   搜索：进击的巨人
   模式：聚合搜索
   结果：Komga 源找到 1 个结果
   ```

2. **查看详情并追更**
   - 点击漫画查看章节列表
   - 确认是目标漫画
   - 点击「追这部」

3. **等待更新通知**
   - 系统会定期检查更新
   - 有新章节时发送通知

### 场景二：管理多个源

1. **配置多个漫画源**
   - 家庭 Komga 服务器
   - 公共 OPDS 图书馆
   - 个人 Suwayomi 服务

2. **聚合搜索所有源**
   ```
   搜索：海贼王
   结果：
   📁 Komga: 找到 1 个结果
   📁 OPDS: 找到 2 个结果
   📁 Suwayomi: 找到 1 个结果
   ```

3. **选择最佳版本**
   - 比较不同源的章节完整性
   - 选择更新及时的源进行追更

### 场景三：移动端使用

1. **Telegram 通知**
   - 收到漫画更新通知
   - 点击「在原站打开」
   - 在手机浏览器中阅读

2. **Web 端管理**
   - 在电脑上管理追更列表
   - 搜索和添加新漫画
   - 查看阅读历史

## 故障处理

### 搜索无结果

**可能原因**：
- 漫画源未正确配置
- 网络连接问题
- 搜索关键词不准确

**解决方法**：
1. 检查漫画源状态
2. 尝试不同的搜索关键词
3. 单独测试每个源的搜索功能

### 追更失败

**可能原因**：
- 漫画源认证失败
- 漫画已被删除
- API 兼容性问题

**解决方法**：
1. 检查漫画源配置
2. 尝试重新追更
3. 查看系统日志

### 通知不工作

**可能原因**：
- Telegram Bot 未正确配置
- 通知设置被禁用
- 网络连接问题

**解决方法**：
1. 检查 Telegram Bot 设置
2. 测试通知功能
3. 确认网络连接正常

## 最佳实践

### 搜索技巧

1. **使用完整名称**：比缩写更准确
2. **尝试不同语言**：中文、日文、英文
3. **利用源过滤**：快速定位特定源的内容

### 追更管理

1. **定期清理**：取消不再追更的漫画
2. **分类管理**：按类型或来源分组
3. **备份列表**：导出追更列表作为备份

### 性能优化

1. **合理配置源数量**：过多源可能影响搜索速度
2. **定期检查源状态**：禁用不常用的源
3. **使用聚合搜索**：比单源搜索更高效

## 常见问题

### Q: 远程追更会下载漫画到本地吗？

A: 不会。远程追更只保存漫画的基本信息和外部源引用，章节内容仍在原服务器。

### Q: 可以同时追更同一部漫画的不同源版本吗？

A: 可以，但建议只选择一个最完整的源，避免重复通知。

### Q: 如果外部源不可用怎么办？

A: VabHub 会检测源状态，暂时不可用的源会被跳过，不会影响其他源的使用。

### Q: 如何取消追更？

A: 在追更列表中找到目标漫画，点击「取消追更」按钮即可。

### Q: 通知频率可以调整吗？

A: 目前通知频率与漫画源的更新频率一致，未来版本将支持自定义通知设置。

## 进阶使用

### API 调用

开发者可以直接调用 API 进行高级操作：

```bash
# 聚合搜索
curl "http://localhost:8000/api/manga/remote/aggregated-search?q=海贼王"

# 获取源列表
curl "http://localhost:8000/api/manga/remote/sources"

# 远程追更
curl -X POST "http://localhost:8000/api/manga/remote/follow" \
  -H "Content-Type: application/json" \
  -d '{"source_id": 1, "remote_series_id": "123"}'
```

### 数据导出

导出追更列表：

```sql
-- 导出所有追更记录
SELECT 
  s.title,
  s.source_id,
  s.remote_series_id,
  f.unread_chapter_count,
  f.created_at
FROM user_manga_follow f
JOIN manga_series_local s ON f.series_id = s.id
WHERE f.user_id = YOUR_USER_ID;
```

更多技术细节请参考 [API 参考](./API_REFERENCE.md)。
