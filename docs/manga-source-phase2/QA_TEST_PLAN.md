# Manga Source Phase 2 QA 测试计划

## 测试概述

本文档提供 Manga Source Phase 2 功能的验收测试计划。重点验证核心功能的完整性和用户体验，确保功能达到生产就绪状态。

## 测试环境

### 基础环境
- **VabHub**: 最新版本（包含 Phase 2 功能）
- **数据库**: SQLite/PostgreSQL
- **漫画源测试环境**:
  - Komga 服务器（本地 Docker）
  - OPDS 服务（公共测试源）
  - Suwayomi 服务（可选）

### 测试数据
- 测试漫画：至少 3-5 部不同漫画
- 用户账号：测试用户账号
- 通知配置：Telegram Bot 测试环境

## 测试优先级

### 🔴 高优先级（必须通过）
1. 漫画源配置和连接
2. 聚合搜索功能
3. 远程追更功能
4. 通知发送和接收
5. 基础 UI 响应性

### 🟡 中优先级（重要功能）
1. 单源搜索和浏览
2. 外部 URL 构建
3. 追更列表管理
4. 错误处理和提示
5. 数据库迁移

### 🟢 低优先级（增强功能）
1. 性能测试
2. 并发场景测试
3. 边界情况处理
4. 高级配置选项

## 测试检查清单

### 1. 漫画源配置测试

#### 1.1 Komga 源配置
- [ ] 添加 Komga 源（正确 URL、认证信息）
- [ ] 测试连接成功
- [ ] 查看库列表
- [ ] 验证源状态显示为"已连接"

#### 1.2 OPDS 源配置
- [ ] 添加公共 OPDS 源
- [ ] 测试连接成功
- [ ] 验证无认证源配置
- [ ] 测试需要认证的 OPDS 源

#### 1.3 源管理功能
- [ ] 编辑源配置
- [ ] 启用/禁用源
- [ ] 删除源
- [ ] 源列表正确显示

### 2. 搜索功能测试

#### 2.1 单源搜索
- [ ] 选择 Komga 源进行搜索
- [ ] 验证搜索结果准确性
- [ ] 测试搜索结果分页
- [ ] 验证搜索无结果的处理

#### 2.2 聚合搜索
- [ ] 开启聚合搜索模式
- [ ] 输入搜索关键词
- [ ] 验证多源结果合并显示
- [ ] 检查结果按源分组

#### 2.3 源过滤功能
- [ ] 在聚合搜索中使用源过滤器
- [ ] 验证只搜索指定源
- [ ] 测试不同源类型组合

#### 2.4 搜索体验
- [ ] 搜索响应时间 < 5 秒
- [ ] 搜索结果加载状态显示
- [ ] 搜索历史记录（如果有）

### 3. 漫画详情和追更测试

#### 3.1 漫画详情页面
- [ ] 点击搜索结果查看详情
- [ ] 验证漫画信息完整性
- [ ] 章节列表正确显示
- [ ] 源信息正确标识

#### 3.2 远程追更功能
- [ ] 点击"追这部"按钮
- [ ] 验证追更成功提示
- [ ] 检查追更列表中显示新追更
- [ ] 验证源标识显示正确

#### 3.3 重复追更处理
- [ ] 尝试追更已追更的漫画
- [ ] 验证重复追更提示
- [ ] 确认不会创建重复记录

#### 3.4 外部 URL 功能
- [ ] 点击"在原站打开"按钮
- [ ] 验证 URL 正确构建
- [ ] 确认能跳转到原站

### 4. 追更管理测试

#### 4.1 追更列表显示
- [ ] 查看我的追更页面
- [ ] 验证本地和远程追更都显示
- [ ] 检查源标识和未读章节数
- [ ] 验证列表排序和筛选

#### 4.2 追更操作
- [ ] 取消追更功能
- [ ] 标记已读功能
- [ ] 批量操作（如果有）
- [ ] 追更状态更新

#### 4.3 混合模式测试
- [ ] 同时有本地和远程追更
- [ ] 验证列表正确区分显示
- [ ] 测试不同类型追更的操作

### 5. 通知系统测试

#### 5.1 Telegram 通知
- [ ] 配置 Telegram Bot
- [ ] 触发漫画更新通知
- [ ] 验证通知内容格式
- [ ] 测试通知按钮功能

#### 5.2 Web 通知
- [ ] 启用 Web 通知
- [ ] 验证通知弹窗显示
- [ ] 测试通知点击跳转

#### 5.3 通知内容验证
- [ ] 通知包含漫画名称
- [ ] 通知显示源信息
- [ ] 通知显示章节数量
- [ ] 通知按钮功能正常

### 6. 同步功能测试

#### 6.1 手动同步测试
- [ ] 手动触发追更同步
- [ ] 验证同步日志显示
- [ ] 检查未读章节数更新

#### 6.2 自动同步测试
- [ ] 等待自动同步执行
- [ ] 验证新章节检测
- [ ] 确认通知发送

#### 6.3 章节排序验证
- [ ] 验证章节按更新时间排序
- [ ] 检查新章节计数准确性
- [ ] 测试不同源的时间格式

### 7. 错误处理测试

#### 7.1 网络错误处理
- [ ] 断开漫画源网络连接
- [ ] 验证搜索失败提示
- [ ] 测试超时处理
- [ ] 检查重试机制

#### 7.2 认证错误处理
- [ ] 使用错误的认证信息
- [ ] 验证认证失败提示
- [ ] 测试权限不足处理

#### 7.3 数据错误处理
- [ ] 测试无效的漫画 ID
- [ ] 验证 API 错误响应
- [ ] 检查前端错误显示

### 8. 数据库迁移测试

#### 8.1 迁移执行
- [ ] 从旧版本升级
- [ ] 验证迁移自动执行
- [ ] 检查迁移日志
- [ ] 确认数据完整性

#### 8.2 新字段验证
- [ ] 检查 `last_remote_chapter_id` 字段
- [ ] 验证字段可为 NULL
- [ ] 测试远程追更数据写入

### 9. 性能测试

#### 9.1 搜索性能
- [ ] 聚合搜索响应时间 < 5 秒
- [ ] 多源并发搜索稳定性
- [ ] 大量搜索结果处理

#### 9.2 UI 响应性
- [ ] 页面加载时间 < 3 秒
- [ ] 按钮点击响应 < 1 秒
- [ ] 列表滚动流畅性

### 10. 用户体验测试

#### 10.1 操作流程
- [ ] 配置 → 搜索 → 追更 → 通知完整流程
- [ ] 界面导航直观性
- [ ] 错误信息清晰度
- [ ] 帮助文档可访问性

#### 10.2 移动端适配
- [ ] 响应式布局正确
- [ ] 触摸操作友好
- [ ] 移动端性能可接受

## 测试执行步骤

### 阶段一：环境准备（30分钟）
1. 部署测试环境
2. 配置漫画源
3. 准备测试数据
4. 设置通知配置

### 阶段二：核心功能测试（60分钟）
1. 执行高优先级测试项目
2. 记录发现的问题
3. 验证修复效果
4. 重复关键流程测试

### 阶段三：集成测试（30分钟）
1. 端到端流程测试
2. 多源协同测试
3. 通知集成测试
4. 数据一致性验证

### 阶段四：边界测试（30分钟）
1. 错误场景测试
2. 性能压力测试
3. 并发操作测试
4. 异常恢复测试

## 测试报告模板

### 测试结果记录

| 测试项目 | 状态 | 问题描述 | 严重程度 | 备注 |
|----------|------|----------|----------|------|
| Komga 源配置 | ✅/❌ | | 高/中/低 | |
| 聚合搜索 | ✅/❌ | | 高/中/低 | |
| 远程追更 | ✅/❌ | | 高/中/低 | |
| 通知发送 | ✅/❌ | | 高/中/低 | |

### 问题分类

- **阻塞性问题**：阻止核心功能使用
- **严重问题**：影响用户体验但不阻塞性
- **一般问题**：界面或交互问题
- **建议优化**：性能或体验改进建议

### 验收标准

#### 必须通过
- ✅ 所有高优先级测试项目通过
- ✅ 核心流程（配置→搜索→追更→通知）完整可用
- ✅ 无阻塞性问题
- ✅ 数据迁移安全可靠

#### 建议通过
- ✅ 中优先级测试项目 90% 通过
- ✅ 用户体验良好
- ✅ 性能表现可接受
- ✅ 错误处理合理

## 测试工具和脚本

### API 测试脚本

```bash
#!/bin/bash
# 基础 API 测试

echo "测试源列表 API..."
curl -f "http://localhost:8000/api/manga/remote/sources" || echo "❌ 源列表 API 失败"

echo "测试聚合搜索 API..."
curl -f "http://localhost:8000/api/manga/remote/aggregated-search?q=test" || echo "❌ 聚合搜索 API 失败"

echo "测试外部 URL API..."
curl -f "http://localhost:8000/api/manga/remote/series/1/123/external-url" || echo "❌ 外部 URL API 失败"
```

### 数据库验证脚本

```sql
-- 验证迁移结果
SELECT 
    COUNT(*) as total_follows,
    COUNT(CASE WHEN last_remote_chapter_id IS NOT NULL THEN 1 END) as remote_follows
FROM user_manga_follow;

-- 验证源配置
SELECT name, type, is_enabled FROM manga_sources;
```

## 测试完成检查

### 发布前检查清单
- [ ] 所有阻塞性问题已修复
- [ ] 核心功能稳定运行
- [ ] 文档更新完成
- [ ] 测试报告已审核
- [ ] 版本标记已更新

### 发布后验证
- [ ] 生产环境部署成功
- [ ] 用户反馈收集
- [ ] 监控指标正常
- [ ] 性能表现符合预期

---

**注意事项**：
1. 测试过程中发现的问题应立即记录并分类
2. 优先修复阻塞性和严重问题
3. 保持测试环境的一致性
4. 定期备份测试数据
5. 测试完成后清理测试环境

测试完成后，请将结果记录在项目文档中，为后续版本提供参考。
