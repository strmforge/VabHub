# docs 维护指北（给 AI / IDE / 人类文档作者）

> 本文件是给**所有会修改 VabHub 文档的角色**看的（包括 ChatGPT、Windsurf、SWE-1.5、以及人类维护者）。  
> 目的是：让"系统总览 / AI 总览 / 深度分析 / 前端路由图"等文档长期保持一致、可靠，不再各写各的。

---

## 0. 先说结论：写任务书前，必须先看哪些文档？

无论你是 AI 还是人类，只要要为 VabHub 写「任务书 / Phase 说明 / 大改动设计」，请按顺序阅读：

1. `docs/VABHUB_SYSTEM_OVERVIEW.md`  
   - 全局系统总览（模块地图、完成度、最近里程碑、给新 AI/IDE 的使用说明）。
2. 如果任务跟 **未来 AI 总控 / Orchestrator / AI 助手** 有关系，再看：  
   - `docs/FUTURE_AI_OVERVIEW.md` 
3. 如果任务需要深入某个模块（例如 Local Intel / 站点管理 / 漫画中心 / 音乐推荐等），按需查：  
   - `docs/TRUE_FILE_BY_FILE_DEEP_ANALYSIS.md` 对应章节
4. 如果任务涉及前端路由 / 页面结构：  
   - 查看或生成：`docs/FRONTEND_MAP.md`（如存在）

> 简单记忆：  
> **先看 SYSTEM_OVERVIEW → 再看 FUTURE_AI_OVERVIEW → 最后按需查 DEEP_ANALYSIS / FRONTEND_MAP。**

---

## 1. 文档分层结构（谁才是"单一事实来源"？）

### 1.1 系统总览：VABHUB_SYSTEM_OVERVIEW.md（SSoT #1）

- 定位：全项目的**单一事实来源**（Single Source of Truth）。
- 内容：
  - 项目定位 & 目标用户；
  - 核心模块地图（状态：`[DONE]/[WIP]/[PLANNED]/[LEGACY]`）；
  - 工作流 & RSSHub & 订阅体系整体位置；
  - 未来 AI 总控在整个系统中的"那一格"；
  - 最近里程碑（按时间排序）；
  - 给"新窗口 AI / IDE"的阅读顺序建议。
- 约定：
  - **任何涉及系统结构 / 模块状态的任务完成后，必须更新这里。**
  - 这是所有任务书引用系统现状时的底线来源。

### 1.2 未来 AI 总览：FUTURE_AI_OVERVIEW.md（SSoT #2）

- 定位：**未来 AI 总控 / AI Orchestrator 子系统的专用总览**。
- 内容：
  - 外部大模型 Endpoint + 本地 AI 器官 + Orchestrator 编排层 架构；
  - 5 种模式：`GENERIC / SUBS_ADVISOR / DIAGNOSE / CLEANUP_ADVISOR / READING_ASSISTANT`；
  - 每个模式对应的：
    - 后端文件（schema/service/api）
    - 前端页面（如 `/ai-lab`、`/ai-subs-assistant` 等）
  - 安全边界：站点 AI 适配通道专用、不做云端 PT 目录聚合、读写分层、危险操作双保险。
- 约定：
  - 任何**新增 / 调整 Orchestrator 模式 / AI 助手页面**的任务，必须同步更新这里；
  - 不允许在别的文档里单独定义一套"平行 AI 架构"。

### 1.3 模块深度分析：TRUE_FILE_BY_FILE_DEEP_ANALYSIS.md（技术细节）

- 定位：给需要"深挖某个模块代码"的人/AI看的**逐文件深度分析**。
- 内容：
  - 按模块（通常以 `service.py` 为中心）进行：
    - 功能总结（做什么）；
    - 技术亮点 / 复杂点；
    - 潜在问题 & 改进建议。
- 约定：
  - 这里**不决定模块状态**，状态以 SYSTEM_OVERVIEW 为准；
  - 当某个模块发生结构性重构时，可以在对应章节加一段 NOTE 或更新要点摘要。

### 1.4 前端路由图：FRONTEND_MAP.md

- 定位：前端页面 / 路由 / 导航结构的清单。
- 内容：
  - 每个主要页面的路由路径、组件名、所属模块；
  - 左侧导航结构、隐藏入口说明；
  - AI 相关页面集中标注。
- 约定：
  - 只要任务改动了前端路由 / 导航结构，就要更新这里；
  - 用于给新 IDE / 设计任务快速理解"页面在哪里"。

### 1.5 配置总览：CONFIG_OVERVIEW.md

- 定位：给用户和新 AI/IDE 的**配置快速上手指南**。
- 内容：
  - 必填 / 建议 / 可选配置分组；
  - 常见配置场景示例（最小安装 / 启用 AI / 启用推荐等）；
  - AI Orchestrator 配置专节。
- 约定：
  - 配置结构发生变化（新增重要配置项、分组调整）时更新；
  - 与 `config.py` / `.env.example` 中的注释保持一致。

### 1.6 自检指南：SYSTEM_SELF_CHECK_GUIDE.md

- 定位：系统健康检查和故障排查的**命令清单**。
- 内容：
  - 5 分钟基础检查 / 15 分钟深度检查命令；
  - AI 专项检查；
  - 常见问题排查路径。
- 约定：
  - 健康检查命令或排查流程有调整时更新；
  - 引用 `SYSTEM_HEALTH_P5_SELF_CHECK_COMMANDS.md` 中的详细命令。

### 1.7 部署指南：DEPLOY_WITH_DOCKER.md

- 定位：官方部署指南（SSoT 级别）
- 内容：
  - Docker/docker-compose 部署步骤；
  - 环境变量配置说明；
  - 目录与卷挂载约定；
  - 升级与备份指南；
  - 常见问题排查。
- 约定：
  - 修改它时需要同步考虑：README / GETTING_STARTED / KNOWN_LIMITATIONS；
  - 是唯一官方推荐的部署方式文档。
  - 包含最新的 Docker 部署最佳实践和常见问题解决方案。

### 1.8 预发布检查笔记：PRE_RELEASE_CHECK_NOTES.md

- 定位：记录真实环境检查过程和结果
- 内容：
  - 版本统一检查；
  - 仓库清理检查；
  - Docker 部署验证；
  - 文档更新检查；
  - 安全检查。
- 约定：
  - 每次预发布前执行检查并更新；
  - 记录实际环境中的检查结果和遇到的问题；
  - 包含具体的命令和输出示例。

### 1.9 已知限制：KNOWN_LIMITATIONS.md

- 定位：对用户期望管理的总入口
- 内容：
  - 功能层面限制；
  - 性能与规模限制；
  - 部署与环境限制；
  - Docker 首跑场景下的已知限制；
  - AI 与外部服务限制。
- 约定：
  - 如实记录当前版本的已知问题和限制；
  - 为用户提供清晰的预期管理；
  - 定期更新，反映最新状态。

### 1.7 上手指南：GETTING_STARTED.md

- 定位：面向用户 / 新 AI/IDE 的**从零到跑通核心流程**指南。
- 内容：
  - VabHub 是什么、目标用户；
  - 最小配置快速启动；
  - 第一次登录建议点哪些页面；
  - Telegram / AI / 推荐的额外配置。
- 约定：
  - 上手流程、导航结构有大变化时更新；
  - 保持与 `FRONTEND_MAP.md` 和 `CONFIG_OVERVIEW.md` 的一致性。

### 1.8 历史对照表：VABHUB_FEATURE_HISTORY_MAP.md

- 定位：历史称呼 / 早期设想 → 现版模块的**对照地图**。
- 内容：
  - 旧称 → 现版模块映射表；
  - 已废弃构想说明（[LEGACY]）；
  - 未来可能实现的方向（[PLANNED]）。
- 约定：
  - 合并模块、重命名重要概念、标记新 LEGACY 时更新；
  - 与 `VABHUB_SYSTEM_OVERVIEW.md` / `FUTURE_AI_OVERVIEW.md` 保持同步。

### 1.9 订阅体系总览：SUBS_RULES_OVERVIEW.md

- 定位：**订阅 / 规则 / RSSHub / 工作流 / AI 订阅助手** 之间关系的专用说明。
- 内容：
  - 订阅相关模块一览（按左侧导航）；
  - 典型使用路径（从添加规则 → 自动订阅 → 工作流 → 通知）；
  - 数据流与职责边界（规则中心 / 工作流 / AI 订阅助手各自的角色）；
  - 添加订阅的统一入口说明。
- 约定：
  - 订阅相关模块结构（模块数量、路由、职责分工）发生明显变化时，必须更新；
  - 与 `FRONTEND_MAP.md` 和 `FUTURE_AI_OVERVIEW.md` 中相关部分保持一致。

### 1.10 阅读栈总览：READING_STACK_OVERVIEW.md

- 定位：**阅读 / 听书 / 漫画 / 书架 / 通知 / Telegram / AI 阅读助手** 的整体关系说明。
- 内容：
  - TXT → EBook → TTS → 有声书 管线；
  - 漫画中心 & 第三方源接入；
  - 书架（Shelf Hub）统一进度管理；
  - 通知中心 & TG-BOT-BOOK 的角色；
  - AI 阅读助手在阅读栈中的位置。
- 约定：
  - 阅读相关模块结构或管线有明显调整时，必须更新；
  - 与 `FRONTEND_MAP.md` 和 `FUTURE_AI_OVERVIEW.md` 中相关部分保持一致。

### 1.11 站点智能栈总览：SITE_INTEL_OVERVIEW.md

- 定位：**站点管理 / Local Intel / TorrentIndex / External Indexer / 站点 AI 适配 / HR 安全策略** 的整体关系说明。
- 内容：
  - 站点管理模块职责；
  - Local Intel & TorrentIndex（本地大脑）；
  - External Indexer & 全局搜索；
  - 站点 AI 适配 & CF adapter 的用途与硬性边界；
  - HR/HNR 安全策略与上述模块的联动；
  - 云大脑 v1 的 LEGACY 状态说明。
- 约定：
  - 上述任一模块结构或职责有明显调整时，必须更新；
  - 与 `VABHUB_SYSTEM_OVERVIEW.md` §3.2/§4 和 `FUTURE_AI_OVERVIEW.md` §2.2/§2.3 保持一致。

### 1.12 电视墙播放策略总览：TV_WALL_PLAYBACK_OVERVIEW.md

- 定位：**电视墙 / 播放器 / LAN vs WAN / 115 播放** 的播放策略说明。
- 内容：
  - 电视墙作为选片中枢的定位；
  - 局域网（LAN）播放策略：媒体库优先；
  - 外网（WAN）播放策略：115 内置播放器；
  - 115 播放边界与 VabHub 职责；
  - 已实现/未实现功能清单。
- 约定：
  - 播放行为或策略有变化时必须更新；
  - 导航分组说明：短剧工作台归属影视中心，音乐独立为音乐中心。

### 1.13 AI 中心 UI 总览：AI_CENTER_UI_OVERVIEW.md

- 定位：**AI 中心各页面与 Orchestrator 模式映射、UI 交互规范** 的说明。
- 内容：
  - AI 中心各页面一览（AI 实验室/订阅助手/故障医生/整理顾问/阅读助手）；
  - 页面 ↔ Orchestrator 模式 ↔ 只读工具映射表；
  - 统一的 UI 交互规范（头部区域/配置状态提示/结果区域）；
  - 安全边界强调（只读/需确认/通道隔离）；
  - 典型使用路线。
- 约定：
  - 新增/删除 AI 页面、变更模式绑定关系时必须更新；
  - 与 `FUTURE_AI_OVERVIEW.md` 配合使用（架构层 vs UI 层）。

### 1.14 下载媒体流水线总览：DOWNLOAD_MEDIA_PIPELINE_OVERVIEW.md

- 定位：**下载→整理→入库→播放 & 通知** 的完整流水线说明。
- 内容：
  - 生命周期总览：从"想要"到"看/听到了"的整体流程；
  - 模块一览：按左侧导航列出各模块在流水线中的角色；
  - 入口层：搜索/订阅/RSSHub/工作流如何产生下载任务；
  - 下载层：任务管理与 HR 安全联动；
  - 整理层：重命名/刮削/STRM/入库策略；
  - 展示播放层：媒体库/电视墙/多入口播放；
  - 通知 & AI 顾问：结果的"收尾层"；
  - v1 限制与后续方向。
- 约定：
  - 当下载/整理/媒体库流程有结构性调整时（例如新增入库目标、改变触发逻辑）必须更新；
  - 与各专题文档（SUBS_RULES_OVERVIEW/SITE_INTEL_OVERVIEW/TV_WALL_PLAYBACK_OVERVIEW）配合使用，避免重复实现细节。

### 1.15 预发布检查笔记：PRE_RELEASE_CHECK_NOTES.md

- 定位：**预发布自检** 的过程记录和结果汇总。
- 内容：
  - 当前版本信息；
  - 检查范围；
  - 总体感受；
  - 文档检查发现；
  - 后端健康检查结果；
  - 前端健康检查结果；
  - UI 巡检结果；
  - Smoke Test 结果；
  - 已知问题与限制；
  - RC 评估结论。
- 约定：
  - 每次预发布检查后更新；
  - 记录检查过程中发现的问题和修复情况。

### 1.16 预发布 UI 检查清单：PRE_RELEASE_UI_CHECKLIST.md

- 定位：**UI 页面完整性** 的检查清单。
- 内容：
  - 按导航分组列出所有页面；
  - 每个页面的路由和组件名；
  - 检查状态标记。
- 约定：
  - 前端页面有新增或调整时更新；
  - 预发布检查时使用该清单进行 UI 巡检。

### 1.17 预发布冒烟测试脚本：PRE_RELEASE_SMOKE_SCENARIOS.md

- 定位：**核心业务链路** 的冒烟测试场景。
- 内容：
  - 下载→整理→入库→播放链路；
  - TXT→EBook→TTS→有声书链路；
  - 漫画追更链路；
  - 音乐自动循环订阅链路；
  - AI 中心只读助手链路；
  - 通知 & Telegram 链路。
- 约定：
  - 核心业务流程有变化时更新；
  - 预发布检查时使用该脚本进行冒烟测试。

### 1.18 已知限制文档：KNOWN_LIMITATIONS.md

- 定位：**当前版本限制和暂不处理事项** 的汇总。
- 内容：
  - 功能层面限制；
  - 性能与规模限制；
  - 部署与环境限制；
  - AI & 外部服务限制；
  - 测试与质量限制；
  - 文档与配置限制；
  - 其他限制。
- 约定：
  - 每次预发布检查后更新；
  - 记录当前版本已知的问题和限制。

### 1.19 内部 RC 版本说明：RELEASE_NOTES_0.1.0-rc1.md

- 定位：**VabHub 0.1.0-rc1（内部预发布版）** 的详细说明。
- 内容：
  - 版本概览；
  - 核心变化摘要；
  - 模块级亮点；
  - 已知限制概览；
  - 升级 & 使用建议；
  - 关联文档索引。
- 约定：
  - 记录内部 RC 版本的核心功能和变化；
  - 为后续正式 tag / 对外 changelog 打基础。

---

## 2. 常见改动场景 → 必须更新哪些文档？

> 下面是最常见的几类任务，方便 AI / IDE 快速判断需要改哪几份 docs。

### 2.1 改后端功能模块（非 AI）

例如：Local Intel、下载管理、站点管理、漫画中心、音乐中心等。

必须更新：

- `VABHUB_SYSTEM_OVERVIEW.md` 
  - 对应模块在 §3「核心模块地图」中的状态 / 要点；
  - 如是一个阶段性里程碑，追加到 §7「最近里程碑」。
- `TRUE_FILE_BY_FILE_DEEP_ANALYSIS.md` 
  - 若改动较大，更新对应模块的小节要点（或加 NOTE 标记该分析偏旧）。

### 2.2 改未来 AI 总控 / Orchestrator / AI 助手

例如：新增一个 AI 模式，给现有模式增加新工具，扩展 AI 订阅助手、故障医生、整理顾问、阅读助手等。

必须更新：

- `FUTURE_AI_OVERVIEW.md` 
  - §2 架构总览（如有新模式 / 新器官）；
  - §4 模式详解（新增/修改的模式）；
  - §5 已落地场景（新增页面或增强说明）。
- `VABHUB_SYSTEM_OVERVIEW.md` 
  - 在「核心模块地图」中更新 AI 总控 / 相关模块状态；
  - 在「最近里程碑」中追加本次任务。
- 对应 Notes 文件：
  - 例如 `FUTURE_AI_XYZ_NOTES.md` 增补设计细节 / 示例。

### 2.3 改前端页面 / 路由 / 导航

例如：给 AI 助手加入口，调整导航分组，重命名某个主页面。

必须更新：

- `VABHUB_SYSTEM_OVERVIEW.md` 
  - §5 「前端结构」中的页面 / 导航说明；
- `FRONTEND_MAP.md`（如存在）
  - 增删改页面路径、分组、入口位置。

### 2.4 仅修 Bug / 小范围重构

如果任务只是修内部逻辑 / 类型标注 / 小 bug，而不影响：

- 模块职责，
- 对外行为（API 形态不变），
- 模块完成度状态（仍然是 DONE/WIP），

则可以不改文档。  
**但如果任务书本身在标题中强调"阶段完成 / 功能升级"，仍然建议在里程碑中留一条简短记录。**

---

## 3. PZ. 文档更新要求（任务书尾部模板）

> 所有 VabHub 任务书，必须带一个类似下面的固定小节。  
> 可以按实际任务微调，但不要删掉"必须更新哪几份文档"的要求。

```markdown
PZ. 文档更新要求（必须执行）

1. 更新 `docs/VABHUB_SYSTEM_OVERVIEW.md`：
   - 在 **3. 核心模块地图** 中，调整本次涉及模块的状态标记，并简要补充新能力要点。
   - 在 **7. 最近里程碑** 末尾追加 1 条描述本次任务的记录（不超过 2 行）。

2. 如本任务涉及 AI Orchestrator / AI 助手：
   - 请同步更新 `docs/FUTURE_AI_OVERVIEW.md`：
     - 在相应模式小节中补充新能力或调整状态；
     - 如新增模式/页面，写明对应的后端文件和前端路由。

3. 如本任务涉及前端路由 / 页面结构改动：
   - 更新或生成 `docs/FRONTEND_MAP.md`：
     - 标明本次新增/修改的页面路径、组件名、所属分组。

4. 如本任务重构了某个模块的核心实现：
   - 在 `docs/TRUE_FILE_BY_FILE_DEEP_ANALYSIS.md` 中对应模块的小节补充一段 NOTE：
     - 简要说明本次重构对原分析的影响（例如"已更新至 2025-12-01 版本实现"）。
```

---

## 4. 写文档时的风格和约束

### 高层文档不写大段代码

在 `SYSTEM_OVERVIEW` / `FUTURE_AI_OVERVIEW` 里只放路径和一句话说明，不放大段代码片段。

### 控制长度

- `VABHUB_SYSTEM_OVERVIEW.md` 建议保持在 ~4000–6000 字符；
- `FUTURE_AI_OVERVIEW.md` 建议控制在 ~4000–7000 字符；
- 超出时优先把旧里程碑 / 历史方案移动到 `VABHUB_HISTORY.md` 或 `FUTURE_AI_HISTORY.md`。

### 状态标记统一

只用这四个：`[DONE]` / `[WIP]` / `[PLANNED]` / `[LEGACY]`；

避免自创标签（如 `[BROKEN]`、`[EXPERIMENTAL]`），可以在描述文本里说清楚。

### 命名一致

模块名、模式名、任务名以代码和 README 为准，例如：

- AI Orchestrator（不要改叫 AI Engine）；
- FUTURE-AI-ORCHESTRATOR-1（不要随意改缩写）。
