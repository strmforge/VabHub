# 阅读 / 听书 / 漫画 & Shelf / AI 阅读助手 体系总览

> **用途**：本文描述 VabHub 中"阅读/听书/漫画"这条完整链路，包括 TXT→EBook→TTS→有声书 管线、漫画追更、书架、通知中心、Telegram Bot、AI 阅读助手之间的关系。  
> **阅读对象**：新接手的开发者、新窗口 AI、以及想要了解阅读能力的用户。

---

## 0. 使用说明

### 0.1 本文目的

把"阅读/听书/漫画"这条线打通，作为理解 VabHub 阅读能力的起点：

- **小说管线**：本地 TXT/EPUB → EBook → TTS → 有声书
- **漫画追更**：第三方源接入 → 追更中心 → 更新通知
- **统一书架**：Shelf Hub 聚合小说/有声书/漫画的阅读进度
- **通知 & Bot**：阅读相关事件推送到通知中心和 Telegram
- **AI 阅读助手**：基于阅读数据生成阅读计划建议

### 0.2 给未来 AI 的提示

当用户问到以下问题时，请先读本文件：
- "TXT 怎么变成有声书？"
- "漫画追更怎么设置？"
- "书架/阅读进度在哪看？"
- "TG Bot 的阅读命令有哪些？"
- "AI 阅读助手能做什么？"

读完本文后，结合 `VABHUB_SYSTEM_OVERVIEW.md` §3.4 和 `FUTURE_AI_OVERVIEW.md` §4.5 可获得更多技术细节。

---

## 1. 模块一览（按左侧导航）

> **模块**：左侧导航项  
> **页面**：模块内的具体视图

### 📚 阅读 & 听书 模块组

| 模块 | 路由 | 职责说明 |
|------|------|----------|
| **阅读中心** | `/reading` | 聚合入口，展示阅读活动概览 |
| **我的书架** | `/my/shelf` | Shelf Hub，统一管理在读/收藏/最近活动 |
| **我的收藏** | `/reading/favorites` | 收藏书籍列表 |
| **小说中心** | `/novels` | EBook 列表、TTS 状态、电子书阅读入口 |
| **有声书中心** | `/audiobooks` | 有声书列表、播放器、听书进度 |
| **TTS 有声书** | `/tts/center` | TTS 任务管理、生成状态查看 |

### 📖 漫画中心 模块组

| 模块 | 路由 | 职责说明 |
|------|------|----------|
| **本地漫画库** | `/manga/library` | 本地漫画浏览 |
| **漫画追更中心** | `/manga/following` | UserMangaFollow 列表、追更状态 |
| **远程漫画** | `/manga/remote` | 远程源漫画浏览 |
| **第三方漫画源** | `/manga/source-browser` | MangaSource 配置（Komga/Kavita/OPDS/Suwayomi） |
| **阅读历史** | `/manga/history` | 漫画阅读记录 |

### 🤖 AI 中心 模块组

| 模块 | 路由 | 职责说明 |
|------|------|----------|
| **AI 阅读助手** | `/ai-reading-assistant` | 阅读进度分析、阅读计划建议（只读） |

### 🔔 通知中心（非独立模块组，但与阅读相关）

- **阅读通知卡片**：电子书导入完成、有声书 TTS 生成完成、漫画更新
- **点击跳转**：直接进入小说中心 / 有声书中心 / 漫画详情页

### Telegram Bot（非 UI 模块）

- **TG-BOT-BOOK-1/2/3**：阅读进度查看、修改、收藏、最近阅读时间线
- 通过 `ReadingControlService` 与 Web 端保持数据一致

---

## 2. TXT → EBook → TTS → 有声书链路

这是 VabHub 最具特色的阅读管线之一。

### 2.1 入口：本地文件发现

```
待整理目录（本地 TXT / EPUB 文件）
    │
    ▼
NovelToEbookPipeline（Novel 管线）
    │
    ├─ 自动识别文件
    ├─ 解析元数据（书名、作者、章节结构）
    └─ 生成 EBook 记录
```

- **不依赖 Web 上传**：主要靠"待整理目录 → 自动识别 → 管线处理"
- **支持格式**：TXT、EPUB 等常见电子书格式

### 2.2 EBook 生成 & 小说中心

```
EBook 模型
    │
    ├─ 元数据：书名、作者、封面
    ├─ 章节结构：按章节分段存储
    └─ 阅读进度：当前章节/位置
         │
         ▼
小说中心页面 (/novels)
    │
    ├─ 展示 EBook 列表
    ├─ 显示 TTS 状态（未生成 / 生成中 / 已完成）
    └─ 点击进入电子书阅读器
```

### 2.3 TTS → 有声书

```
EBook
    │
    ▼
TTS Runner / Job
    │
    ├─ 逐章节转语音
    ├─ 合成音频文件
    └─ 生成 Audiobook 记录
         │
         ▼
有声书中心页面 (/audiobooks)
    │
    ├─ 展示可用有声书
    ├─ 有声书播放器（支持断点续播）
    └─ UserAudiobookProgress 管理进度
```

- **TTS 任务管理**：在 `/tts/center` 查看任务队列和生成状态
- **进度精确存储**：`UserAudiobookProgress` 记录到秒级位置

### 2.4 进度存储 & 书架

```
小说阅读进度 ──┐
               │
有声书进度 ────┼──▶ Shelf Hub (/my/shelf)
               │       │
漫画进度 ──────┘       ├─ 在读列表
                       ├─ 收藏列表
                       └─ 最近活动时间线
```

- **统一视图**：Shelf Hub 聚合三种阅读类型
- **阅读中心**：`/reading` 作为更高层的聚合入口

---

## 3. 漫画中心 & 第三方源管线

### 3.1 MangaSource 适配框架

```
第三方漫画服务
├── Komga
├── Kavita
├── OPDS
└── Suwayomi
         │
         ▼
MangaSource 适配层
    │
    ├─ 统一 API 抽象
    ├─ 章节/页面拉取
    └─ 元数据同步
         │
         ▼
漫画库 / 远程浏览页面
```

- **不自带爬取**：只做第三方自建源集成
- **配置入口**：`/manga/source-browser`

### 3.2 UserMangaFollow + Runner

```
用户追更某部漫画
    │
    ▼
UserMangaFollow 记录
    │
    ▼
追更 Runner（定时任务）
    │
    ├─ 检查源端是否有新章节
    └─ 有更新时：
         ├─ 更新 UserMangaFollow 状态
         └─ 发送 MANGA_UPDATED 通知
              │
              ▼
         通知中心 + Telegram（可选）
```

### 3.3 漫画阅读进度

- **进度追踪**：记录当前阅读到哪一话/哪一页
- **与 Shelf Hub 协同**：漫画进度也出现在书架的"最近活动"中

---

## 4. 通知中心 & TG-BOT-BOOK 的角色

### 4.1 通知中心

进入阅读通知卡片的事件：

| 事件类型 | 说明 | 点击跳转 |
|----------|------|----------|
| **电子书导入完成** | Novel 管线处理完成 | 小说中心 |
| **有声书 TTS 生成完成** | TTS Runner 完成转换 | 有声书中心 |
| **漫画更新** | 追更的漫画有新章节 | 漫画详情页 |

- **卡片组件**：`ReadingNotificationCard` 等专用组件
- **一键跳转**：点击卡片直接进入对应模块

### 4.2 Telegram Bot – BOOK 系列

核心功能（TG-BOT-BOOK-1/2/3）：

| 命令类别 | 功能 |
|----------|------|
| **查看进度** | 小说/有声书/漫画的当前阅读位置 |
| **修改进度** | 跳转章节、标记已完成 |
| **收藏管理** | 添加/取消收藏 |
| **最近时间线** | `/reading_recent` 展示最近阅读活动 |

- **统一服务**：所有写操作通过 `ReadingControlService`
- **数据一致**：Telegram 端操作与 Web 端实时同步

---

## 5. AI 阅读助手在阅读栈中的位置

### 5.1 Orchestrator 模式：READING_ASSISTANT

```
阅读栈数据
├── Shelf Hub 进度
├── EBook/有声书列表
└── 漫画追更状态
         │
         ▼
AI Orchestrator (READING_ASSISTANT 模式)
    │
    ├─ 工具：reading_snapshot（阅读进度快照）
    ├─ 工具：library_books（书库统计）
    └─ 输出：ReadingInsights + ReadingPlan
```

### 5.2 提供的能力

| 能力 | 说明 |
|------|------|
| **阅读进度分析** | 总结"正在阅读/已完成/待读"状态 |
| **阅读目标规划** | 为 N 天/周/月生成阅读计划 |
| **优先级建议** | continue / start / finish + high/medium/low |

### 5.3 安全边界

- **v1 只读**：不会直接修改阅读进度或收藏状态
- **建议型输出**：用户自行决定是否采纳
- **实际操作**：通过 Web 或 Telegram 端手动执行

---

## 6. 典型使用路径

### 路径 A：本地 TXT → 小说中心 → TTS → 有声书 → 手机听

```
1. 把 TXT 文件放入待整理目录
2. Novel 管线自动识别并生成 EBook
3. 在小说中心 (/novels) 看到新书
4. 点击"生成有声书"，TTS Runner 开始处理
5. TTS 完成后，通知中心收到提醒
6. 进入有声书中心 (/audiobooks) 开始听书
7. 手机端通过 Telegram Bot 查看/控制进度
```

### 路径 B：追漫画 → 通知 → Web/TG 查看进度

```
1. 在第三方漫画源 (/manga/source-browser) 配置 Komga/Kavita
2. 浏览远程漫画，点击"追更"
3. 追更 Runner 定时检查新章节
4. 有更新时，通知中心收到 MANGA_UPDATED
5. 点击通知卡片进入漫画详情页阅读
6. 或通过 Telegram Bot 查看最近阅读时间线
```

### 路径 C：用 AI 阅读助手规划阅读目标

```
1. 进入 AI 阅读助手 (/ai-reading-assistant)
2. 输入需求，如"帮我规划这个月读完这三本书"
3. AI 分析当前阅读进度和书库状态
4. 生成阅读计划草案（每日/每周目标）
5. 用户参考建议，在 Web/TG 端实际推进阅读
6. 定期回到 AI 助手查看进度建议调整
```

---

## 7. v1 限制 & 后续可选任务

| 序号 | 限制说明 | 后续方向 |
|------|----------|----------|
| 1 | TTS 管线在 UI 上的可视化程度有限 | 增加 TTS 任务进度条、预计完成时间 |
| 2 | 部分漫画源配置偏技术向 | 提供更友好的源配置向导 |
| 3 | AI 阅读助手是建议型 | 可考虑与"阅读目标"页面联动，支持目标追踪 |
| 4 | Telegram Bot 阅读命令偏文字 | 可扩展语音消息/图片封面展示 |
| 5 | 小说/有声书/漫画进度各自存储 | 可考虑统一进度 API 简化前端调用 |

---

*最后更新：2025-12-03 UI-GLUE-FILL-GAPS-1*  

> **UI状态更新**：所有阅读/听书/漫画相关UI页面（阅读中心、我的书架、我的收藏、有声书中心、TTS有声书、漫画追更中心、远程漫画、第三方漫画源、阅读历史）已完成真实API对接，前端与后端数据链路已打通。
