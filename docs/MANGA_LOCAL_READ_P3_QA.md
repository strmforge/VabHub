# Manga Local Read P3 - QA 测试计划

## 📋 测试概述

**目标**: 验证本地漫画阅读进度完全接入 Reading 中心系统的功能完整性
**范围**: Web 阅读中心 + TG 命令 + 进度同步 + 异常处理
**测试类型**: 功能测试、集成测试、异常测试

---

## 🧪 场景 A: 单设备续读测试

### A1: Web 阅读器进度保存
**测试步骤**:
1. 登录 Web 系统，进入"本地漫画库"
2. 选择任意漫画，点击"开始阅读"
3. 在阅读器中翻页到第5话第10页
4. 等待5秒确保进度保存
5. 关闭阅读器标签页

**预期结果**:
- 阅读进度自动保存到数据库
- 无错误提示或异常行为

### A2: 阅读中心显示记录
**测试步骤**:
1. 进入"阅读中心"页面
2. 查看"正在阅读"列表
3. 确认刚才阅读的漫画出现在列表中

**预期结果**:
- 漫画条目显示在"正在阅读"列表中
- 进度标签显示: "第5话 · 第10页"
- 漫画类型标识: "漫画 · 本地" 或类似标识

### A3: 继续阅读功能
**测试步骤**:
1. 在阅读中心找到刚才的漫画条目
2. 点击"继续阅读"按钮

**预期结果**:
- 浏览器跳转到 `/manga/read/{seriesId}/{chapterId}`
- 阅读器自动打开到第5话第10页
- 页面滚动到正确位置

---

## 🔄 场景 B: 跨入口续读测试

### B1: 漫画中心入口
**测试步骤**:
1. 从侧边栏"漫画" → "本地漫画库"进入
2. 选择同一部漫画，阅读几页（到第3话第5页）
3. 等待进度保存

**预期结果**:
- 进度正确更新
- 阅读体验正常

### B2: TG 最近活动查看
**测试步骤**:
1. 打开 Telegram，绑定账号
2. 发送 `/reading_recent` 命令
3. 查看返回的阅读活动列表

**预期结果**:
- 列表中包含刚才阅读的漫画记录
- 显示格式: "🖼 《漫画名》 · 第3话 · 第5页"
- 时间戳为最近的活动时间

### B3: TG 继续阅读
**测试步骤**:
1. 记录漫画在列表中的序号（如第2条）
2. 发送 `/reading_open 2` 命令
3. 点击 TG 返回的 Web 链接

**预期结果**:
- TG 返回正确的 Web 链接: `{WEB_BASE_URL}/manga/read/{seriesId}/{chapterId}`
- 浏览器打开到第3话第5页
- 进度正确恢复

### B4: TG 漫画列表
**测试步骤**:
1. 发送 `/reading_manga` 命令
2. 查看返回的漫画列表

**预期结果**:
- 显示所有正在阅读的漫画
- 包含刚才测试的漫画
- 格式正确，状态准确

---

## 🚨 场景 C: 删除/修改后容错测试

### C1: 章节文件删除测试
**测试步骤**:
1. 在文件系统中删除某章节的图片文件
2. 从阅读中心打开该漫画的"继续阅读"
3. 观察系统行为

**预期结果**:
- **理想情况**: 显示"资源已缺失"友好提示
- **可接受情况**: 自动跳转到第1话第1页
- **不可接受**: 页面崩溃或白屏

### C2: 漫画系列删除测试
**测试步骤**:
1. 删除整个漫画系列文件夹
2. 刷新阅读中心页面
3. 确认列表状态

**预期结果**:
- 已删除的漫画条目在下次刷新时消失
- 不影响其他漫画的显示和操作

### C3: 网络异常测试
**测试步骤**:
1. 断开网络连接
2. 在阅读器中翻页
3. 观察进度保存行为

**预期结果**:
- 阅读器正常显示图片（已缓存）
- 进度保存失败时仅在 console 记录错误
- 不显示错误提示给用户
- 阅读体验不受影响

---

## 🔧 场景 D: API 集成测试

### D1: 进度 API 调用
**测试步骤**:
1. 打开浏览器开发者工具
2. 进入漫画阅读器
3. 翻页观察 Network 面板

**预期结果**:
- 看到 POST `/api/manga/local/progress/series/{seriesId}` 请求
- 请求 payload 格式正确:
  ```json
  {
    "series_id": 123,
    "chapter_id": 456,
    "last_page_index": 10,
    "total_pages": 30,
    "is_finished": false
  }
  ```
- 响应状态码 200

### D2: 进度恢复 API
**测试步骤**:
1. 清除浏览器缓存
2. 直接访问 `/manga/read/{seriesId}`
3. 观察 Network 面板

**预期结果**:
- 看到 GET `/api/manga/local/progress/series/{seriesId}` 请求
- 返回上次阅读进度数据
- 页面自动跳转到正确章节

### D3: ReadingHub API
**测试步骤**:
1. 进入阅读中心页面
2. 观察 Network 面板

**预期结果**:
- 看到 GET `/api/reading-hub/ongoing` 请求
- 响应包含本地漫画进度记录
- 数据格式正确，包含 route_name="MangaReaderPage"

---

## 📊 场景 E: 数据一致性测试

### E1: 多端进度同步
**测试步骤**:
1. 在设备A阅读漫画到第2话第5页
2. 在设备B查看阅读中心
3. 确认进度显示

**预期结果**:
- 设备B显示最新进度
- 时间戳同步正确

### E2: 章节切换进度
**测试步骤**:
1. 阅读第1话到第10页
2. 切换到第2话阅读到第3页
3. 返回阅读中心查看进度

**预期结果**:
- 显示当前章节: "第2话 · 第3页"
- 不显示历史章节进度

### E3: 完成状态标记
**测试步骤**:
1. 阅读章节到最后一页
2. 等待进度保存
3. 查看阅读中心状态

**预期结果**:
- 章节标记为已完成
- 状态显示: "已完成" 或类似标识

---

## 🎯 验收标准

### 功能完整性 ✅
- [ ] Web 阅读器进度正常保存
- [ ] 阅读中心正确显示本地漫画
- [ ] "继续阅读"按钮功能正常
- [ ] TG 命令支持本地漫画
- [ ] TG 链接格式正确

### 用户体验 ✅
- [ ] 进度恢复准确无误
- [ ] 界面响应流畅
- [ ] 错误处理友好
- [ ] 跨设备体验一致

### 技术指标 ✅
- [ ] API 调用成功率 > 99%
- [ ] 进度保存延迟 < 5秒
- [ ] 页面加载时间 < 3秒
- [ ] 异常情况下不崩溃

---

## 🐛 常见问题排查

### 问题1: 阅读中心不显示本地漫画
**排查步骤**:
1. 检查数据库 `manga_reading_progress` 表是否有记录
2. 确认 ReadingHubService 查询逻辑正确
3. 验证前端 ReadingHubPage 数据获取

### 问题2: TG 链接无法打开
**排查步骤**:
1. 确认 TG URL builder 使用正确格式
2. 检查 Vue Router 路由配置
3. 验证 WEB_BASE_URL 配置正确

### 问题3: 进度保存失败
**排查步骤**:
1. 检查前端 API 调用格式
2. 确认后端 API 端点正常
3. 验证数据库写入权限

---

## 📝 测试报告模板

```
测试日期: ____
测试人员: ____
测试环境: ____

场景A - 单设备续读: ✅/❌
场景B - 跨入口续读: ✅/❌  
场景C - 容错处理: ✅/❌
场景D - API集成: ✅/❌
场景E - 数据一致性: ✅/❌

发现的问题:
1. ____
2. ____

建议改进:
1. ____
2. ____

总体评价: 通过/需要修复
```

---

**文档版本**: 1.0  
**创建日期**: 2024年当前日期  
**适用范围**: Manga Local Read P3 完整功能验证
