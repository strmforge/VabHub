# 下载器同步问题分析

## 问题现象

运行 `sync_downloader_tasks.py` 脚本时：
- ✅ 配置读取：已使用正确的IP `192.168.51.105`
- ✅ 连接成功：没有连接错误
- ❌ 任务数量：两个下载器都返回 0 个任务

## 可能原因

### 1. 配置未正确保存到数据库
- `get_setting` 返回 `None`
- 但脚本已使用硬编码的IP作为后备方案

### 2. 下载器中确实没有任务
- 用户说"这两个下载器都有数据在的"
- 但API返回0个任务

### 3. 连接成功但权限不足
- 连接没有报错
- 但可能无法获取任务列表

### 4. API调用方式问题
- `get_torrents()` 可能需要特定参数
- 或者需要先登录/认证

## 解决方案

### 方案1：直接使用API验证
使用后端API来验证连接和获取任务：
```bash
# 获取下载器实例
curl http://localhost:8001/api/dl/instances

# 获取统计信息（包含任务数）
curl http://localhost:8001/api/dl/qbittorrent/stats
curl http://localhost:8001/api/dl/transmission/stats
```

### 方案2：检查下载器客户端实现
检查 `get_torrents()` 方法的实现，确认是否需要特定参数或标签过滤。

### 方案3：手动测试连接
直接在浏览器或使用curl测试下载器API：
```bash
# qBittorrent
curl -X POST http://192.168.51.105:8080/api/v2/auth/login -d "username=admin&password=China1987"
curl http://192.168.51.105:8080/api/v2/torrents/info

# Transmission
curl -u haishuai:China1987 http://192.168.51.105:9091/transmission/rpc -d '{"method":"torrent-get","arguments":{"fields":["id","name","hashString","status"]}}'
```

## 下一步

1. 使用后端API验证连接和任务数
2. 检查下载器客户端实现
3. 手动测试下载器API
4. 如果确实有任务，检查API调用方式

