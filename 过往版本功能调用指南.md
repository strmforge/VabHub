# è¿‡å¾€ç‰ˆæœ¬åŠŸèƒ½è°ƒç”¨æŒ‡å—

## ğŸ“š æ¦‚è¿°

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•åœ¨å½“å‰ç‰ˆæœ¬çš„VabHubä¸­ç›´æ¥è°ƒç”¨è¿‡å¾€ç‰ˆæœ¬ï¼ˆVabHub-1ã€VabHub1.4ç‰ˆã€VabHub-å˜å¼‚ç‰ˆç­‰ï¼‰ä¸­å·²å®ç°çš„åŠŸèƒ½ã€‚

## ğŸ”§ é€‚é…å™¨ç³»ç»Ÿ

### LegacyAdapter (legacy_adapter.py)

æ ¸å¿ƒé€‚é…å™¨ç±»ï¼Œè´Ÿè´£åŠ è½½å’Œè°ƒç”¨è¿‡å¾€ç‰ˆæœ¬çš„åŠŸèƒ½ã€‚

#### ä¸»è¦åŠŸèƒ½

1. **åŠ¨æ€æ¨¡å—åŠ è½½**: è‡ªåŠ¨åŠ è½½è¿‡å¾€ç‰ˆæœ¬çš„Pythonæ¨¡å—
2. **ç±»å®ä¾‹åŒ–**: åˆ›å»ºåŠŸèƒ½ç±»çš„å®ä¾‹ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰
3. **æ–¹æ³•è°ƒç”¨**: è°ƒç”¨åŠŸèƒ½ç±»çš„æ–¹æ³•
4. **ç‰ˆæœ¬ç®¡ç†**: æ”¯æŒå¤šä¸ªç‰ˆæœ¬çš„åŒä¸€åŠŸèƒ½

#### ä½¿ç”¨æ–¹æ³•

```python
from app.core.legacy_adapter import get_legacy_adapter

# è·å–é€‚é…å™¨å®ä¾‹
adapter = get_legacy_adapter()

# è·å–æ¨èå¼•æ“å®ä¾‹
engine = adapter.get_instance("recommendation_engine", version="vabhub_1")

# è°ƒç”¨æ–¹æ³•
recommendations = adapter.call_function(
    "recommendation_engine",
    "update_recommendations",
    version="vabhub_1",
    user_id=1
)
```

### ä¾¿æ·åŒ…è£…å™¨ (legacy_wrapper.py)

æä¾›æ›´å‹å¥½çš„è°ƒç”¨æ¥å£ï¼Œå°è£…äº†å¸¸ç”¨çš„åŠŸèƒ½è°ƒç”¨ã€‚

#### RecommendationWrapper

æ¨èå¼•æ“åŒ…è£…å™¨ï¼š

```python
from app.core.legacy_wrapper import RecommendationWrapper

# åˆ›å»ºåŒ…è£…å™¨
recommender = RecommendationWrapper(version="vabhub_1")

# è·å–æ¨è
recommendations = await recommender.get_recommendations(
    user_id=1,
    limit=20,
    algorithm="hybrid"
)
```

#### MediaParserWrapper

åª’ä½“è§£æå™¨åŒ…è£…å™¨ï¼š

```python
from app.core.legacy_wrapper import MediaParserWrapper

# åˆ›å»ºåŒ…è£…å™¨
parser = MediaParserWrapper(version="vabhub_1")

# è§£ææ–‡ä»¶å
result = parser.parse_filename("/path/to/movie.mkv")
# è¿”å›: {
#     "title": "ç”µå½±å",
#     "year": 2024,
#     "type": "movie",
#     "confidence": 0.95
# }
```

## ğŸ“‹ å·²æ³¨å†Œçš„åŠŸèƒ½

### 1. æ¨èå¼•æ“

#### recommendation_engine
- **ç‰ˆæœ¬**: vabhub_1, vabhub_14
- **è·¯å¾„**: `modules.ai.recommendation.recommendation_engine.RecommendationEngine`
- **åŠŸèƒ½**: ååŒè¿‡æ»¤ã€å†…å®¹æ¨èã€æ··åˆæ¨è
- **ä¸»è¦æ–¹æ³•**:
  - `generate_initial_recommendations(user_id)`: ç”Ÿæˆåˆå§‹æ¨è
  - `update_recommendations(user_id)`: æ›´æ–°ç”¨æˆ·æ¨è

#### intelligent_recommendation
- **ç‰ˆæœ¬**: vabhub_1
- **è·¯å¾„**: `modules.ai.core.intelligent_content_recommendation.IntelligentContentRecommendationEngine`
- **åŠŸèƒ½**: æ™ºèƒ½å†…å®¹æ¨èå¼•æ“ - ç”¨æˆ·ç”»åƒåˆ†æã€å†…å®¹ç›¸ä¼¼åº¦åˆ†æ
- **ä¸»è¦æ–¹æ³•**:
  - `get_recommendations(user_id, recommendation_types, top_k)`: è·å–æ¨è
  - `build_recommendation_models()`: æ„å»ºæ¨èæ¨¡å‹

#### simple_recommendation
- **ç‰ˆæœ¬**: vabhub_1
- **è·¯å¾„**: `modules.ai.core.simple_recommendation_engine.SimpleRecommendationEngine`
- **åŠŸèƒ½**: ç®€åŒ–ç‰ˆæ¨èå¼•æ“ - åŸºäºåµŒå…¥å‘é‡çš„æ¨è

### 2. åª’ä½“è¯†åˆ«

#### media_parser
- **ç‰ˆæœ¬**: vabhub_1
- **è·¯å¾„**: `modules.media.parser.MediaFileParser`
- **åŠŸèƒ½**: åª’ä½“æ–‡ä»¶è§£æå™¨ - æ–‡ä»¶åè§£æã€ç±»å‹è¯†åˆ«
- **ä¸»è¦æ–¹æ³•**:
  - `parse_filename(file_path)`: è§£ææ–‡ä»¶åè·å–åª’ä½“ä¿¡æ¯

#### media_identification
- **ç‰ˆæœ¬**: vabhub_1
- **è·¯å¾„**: `modules.media.media_identification_service.MediaIdentificationService`
- **åŠŸèƒ½**: åª’ä½“è¯†åˆ«æœåŠ¡ - åŸºäºæ–‡ä»¶åå’Œå…ƒæ•°æ®çš„è¯†åˆ«

#### enhanced_media_identification
- **ç‰ˆæœ¬**: vabhub_1
- **è·¯å¾„**: `modules.media.enhanced_media_identification_service.EnhancedMediaIdentificationService`
- **åŠŸèƒ½**: å¢å¼ºåª’ä½“è¯†åˆ«æœåŠ¡ - AIå¢å¼ºçš„è¯†åˆ«

### 3. æ¦œå•ç³»ç»Ÿ

#### music_charts
- **ç‰ˆæœ¬**: vabhub_1
- **è·¯å¾„**: `core.music_charts.MusicChartsService`
- **åŠŸèƒ½**: éŸ³ä¹æ¦œå•æœåŠ¡ - QQéŸ³ä¹ã€ç½‘æ˜“äº‘éŸ³ä¹ã€Spotifyç­‰
- **ä¸»è¦æ–¹æ³•**:
  - `get_charts(platform, chart_type, region, limit)`: è·å–æ¦œå•
  - `compare_charts(platform1, platform2, chart_type, limit)`: æ¯”è¾ƒæ¦œå•

#### charts_tmdb
- **ç‰ˆæœ¬**: vabhub_14
- **è·¯å¾„**: `plugins.charts_tmdb_plugin.ChartsTMDBPlugin`
- **åŠŸèƒ½**: TMDBå½±è§†æ¦œå•æ’ä»¶

#### charts_douban
- **ç‰ˆæœ¬**: vabhub_14
- **è·¯å¾„**: `plugins.charts_douban_plugin.ChartsDoubanPlugin`
- **åŠŸèƒ½**: è±†ç“£å½±è§†æ¦œå•æ’ä»¶

### 4. AIåŠŸèƒ½

#### ai_classifier
- **ç‰ˆæœ¬**: vabhub_1
- **è·¯å¾„**: `modules.ai.classifier.ai_classifier.AIClassifier`
- **åŠŸèƒ½**: AIåˆ†ç±»å™¨ - åª’ä½“å†…å®¹åˆ†ç±»

#### collaborative_filtering
- **ç‰ˆæœ¬**: vabhub_1
- **è·¯å¾„**: `modules.ai.core.collaborative_filtering.CollaborativeFiltering`
- **åŠŸèƒ½**: ååŒè¿‡æ»¤ç®—æ³•

#### content_based_recommender
- **ç‰ˆæœ¬**: vabhub_1
- **è·¯å¾„**: `modules.ai.core.content_based_recommender.ContentBasedRecommender`
- **åŠŸèƒ½**: åŸºäºå†…å®¹çš„æ¨è

### 5. ä¸‹è½½ç®¡ç†

#### download_manager
- **ç‰ˆæœ¬**: vabhub_1
- **è·¯å¾„**: `modules.download.download_service.DownloadService`
- **åŠŸèƒ½**: ä¸‹è½½æœåŠ¡ - ç»Ÿä¸€ä¸‹è½½ç®¡ç†

#### qbittorrent_client
- **ç‰ˆæœ¬**: vabhub_1
- **è·¯å¾„**: `modules.download.clients.qbittorrent_client.QBittorrentClient`
- **åŠŸèƒ½**: qBittorrentå®¢æˆ·ç«¯

#### transmission_client
- **ç‰ˆæœ¬**: vabhub_1
- **è·¯å¾„**: `modules.download.clients.transmission_client.TransmissionClient`
- **åŠŸèƒ½**: Transmissionå®¢æˆ·ç«¯

### 6. ç¼“å­˜ç®¡ç†

#### cache_manager
- **ç‰ˆæœ¬**: vabhub_1
- **è·¯å¾„**: `modules.cache.cache_manager.CacheManager`
- **åŠŸèƒ½**: ç¼“å­˜ç®¡ç†å™¨ - å¤šçº§ç¼“å­˜

### 7. æ’ä»¶ç³»ç»Ÿ

#### plugin_manager
- **ç‰ˆæœ¬**: vabhub_14
- **è·¯å¾„**: `core.plugin_manager.PluginManager`
- **åŠŸèƒ½**: æ’ä»¶ç®¡ç†å™¨

## ğŸ” æŸ¥è¯¢å¯ç”¨åŠŸèƒ½

```python
from app.core.legacy_adapter import get_legacy_adapter

adapter = get_legacy_adapter()
functions = adapter.get_available_functions()

for func_name, func_info in functions.items():
    print(f"{func_name}: {func_info['description']}")
    print(f"  ç‰ˆæœ¬: {', '.join(func_info['versions'])}")
```

## ğŸ“ æ³¨å†Œæ–°åŠŸèƒ½

å¦‚æœéœ€è¦æ³¨å†Œæ–°çš„è¿‡å¾€ç‰ˆæœ¬åŠŸèƒ½ï¼š

```python
from app.core.legacy_adapter import get_legacy_adapter

adapter = get_legacy_adapter()
adapter.register_function(
    name="new_function",
    version="vabhub_1",
    module_path="modules.new_module.NewClass",
    description="æ–°åŠŸèƒ½æè¿°"
)
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **è·¯å¾„ä¾èµ–**: ç¡®ä¿è¿‡å¾€ç‰ˆæœ¬çš„ä»£ç è·¯å¾„æ­£ç¡®
2. **ä¾èµ–é¡¹**: è¿‡å¾€ç‰ˆæœ¬çš„åŠŸèƒ½å¯èƒ½éœ€è¦ç‰¹å®šçš„ä¾èµ–åŒ…
3. **å…¼å®¹æ€§**: æŸäº›åŠŸèƒ½å¯èƒ½éœ€è¦é€‚é…æ‰èƒ½åœ¨å½“å‰ç‰ˆæœ¬ä¸­ä½¿ç”¨
4. **æ€§èƒ½**: åŠ¨æ€åŠ è½½å¯èƒ½å½±å“æ€§èƒ½ï¼Œå»ºè®®ä½¿ç”¨ç¼“å­˜

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1: ä½¿ç”¨æ¨èå¼•æ“

```python
from app.core.legacy_wrapper import RecommendationWrapper

# åˆ›å»ºæ¨èå¼•æ“åŒ…è£…å™¨
recommender = RecommendationWrapper(version="vabhub_1")

# è·å–ç”¨æˆ·æ¨è
recommendations = await recommender.get_recommendations(
    user_id=1,
    limit=20,
    algorithm="hybrid"
)

for rec in recommendations:
    print(f"æ¨è: {rec['media_id']} - åˆ†æ•°: {rec['score']} - åŸå› : {rec['reason']}")
```

### ç¤ºä¾‹2: ä½¿ç”¨åª’ä½“è§£æå™¨

```python
from app.core.legacy_wrapper import MediaParserWrapper

# åˆ›å»ºåª’ä½“è§£æå™¨åŒ…è£…å™¨
parser = MediaParserWrapper(version="vabhub_1")

# è§£ææ–‡ä»¶å
result = parser.parse_filename("/path/to/å‰§é›†.S01E01.1080p.mkv")

if result:
    print(f"æ ‡é¢˜: {result['title']}")
    print(f"ç±»å‹: {result['type']}")
    print(f"ç½®ä¿¡åº¦: {result['confidence']}")
```

### ç¤ºä¾‹3: ä½¿ç”¨éŸ³ä¹æ¦œå•æœåŠ¡

```python
from app.core.legacy_adapter import get_legacy_adapter

adapter = get_legacy_adapter()

# è·å–éŸ³ä¹æ¦œå•æœåŠ¡å®ä¾‹
charts_service = adapter.get_instance("music_charts", version="vabhub_1")

if charts_service:
    # è·å–QQéŸ³ä¹çƒ­æ­Œæ¦œ
    charts = await charts_service.get_charts(
        platform="qq_music",
        chart_type="hot",
        region="CN",
        limit=50
    )
    
    for chart in charts:
        print(f"{chart['rank']}. {chart['title']} - {chart['artist']}")
```

### ç¤ºä¾‹4: ç›´æ¥è°ƒç”¨æ–¹æ³•

```python
from app.core.legacy_wrapper import LegacyFunctionRegistry

# è°ƒç”¨æ¨èå¼•æ“æ–¹æ³•
recommendations = LegacyFunctionRegistry.call_function(
    function_name="recommendation_engine",
    method_name="update_recommendations",
    version="vabhub_1",
    user_id=1
)
```

## ğŸ“Š åŠŸèƒ½æ˜ å°„è¡¨

| åŠŸèƒ½åç§° | ç‰ˆæœ¬ | æ¨¡å—è·¯å¾„ | ä¸»è¦ç±»/å‡½æ•° |
|---------|------|---------|------------|
| recommendation_engine | vabhub_1 | modules.ai.recommendation.recommendation_engine | RecommendationEngine |
| intelligent_recommendation | vabhub_1 | modules.ai.core.intelligent_content_recommendation | IntelligentContentRecommendationEngine |
| media_parser | vabhub_1 | modules.media.parser | MediaFileParser |
| media_identification | vabhub_1 | modules.media.media_identification_service | MediaIdentificationService |
| music_charts | vabhub_1 | core.music_charts | MusicChartsService |
| charts_tmdb | vabhub_14 | plugins.charts_tmdb_plugin | ChartsTMDBPlugin |
| charts_douban | vabhub_14 | plugins.charts_douban_plugin | ChartsDoubanPlugin |
| ai_classifier | vabhub_1 | modules.ai.classifier.ai_classifier | AIClassifier |
| download_manager | vabhub_1 | modules.download.download_service | DownloadService |

## ğŸ”„ æ›´æ–°æ—¥å¿—

- **2025-01-08**: åˆå§‹ç‰ˆæœ¬ï¼Œæ”¯æŒæ¨èå¼•æ“ã€åª’ä½“è¯†åˆ«ã€æ¦œå•ç³»ç»Ÿç­‰æ ¸å¿ƒåŠŸèƒ½

---

**æ³¨æ„**: ä½¿ç”¨è¿‡å¾€ç‰ˆæœ¬åŠŸèƒ½æ—¶ï¼Œè¯·ç¡®ä¿ç›¸å…³ä¾èµ–å·²å®‰è£…ï¼Œå¹¶ä¸”ä»£ç è·¯å¾„æ­£ç¡®ã€‚

