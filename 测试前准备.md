# 测试前准备

## 当前状态

✅ **已完成的修复：**
1. 修复了 `status` 模块命名冲突（`subscription.py`）
2. 修复了 SQLAlchemy 对象序列化问题（所有订阅API端点）
3. 修复了数据库字段缺失问题（`downloader_hash`）
4. 修复了正则表达式错误（HNR检测器）
5. 修复了导入错误（`Optional`、`Dict`）

## 运行测试前的准备工作

### 1. 启动后端服务

在运行功能测试之前，**必须先启动后端服务**：

```bash
# 方法1: 使用快速启动脚本（推荐）
python backend/run_server.py

# 方法2: 使用批处理脚本（Windows）
快速启动服务.bat

# 方法3: 使用原始的启动脚本
python backend/scripts/start.py
```

服务启动后，应该能够访问：
- API文档: http://localhost:8000/docs
- 健康检查: http://localhost:8000/api/v1/health

### 2. 验证服务状态

运行服务状态检查脚本：

```bash
python backend/scripts/check_service_status.py
```

如果服务正常运行，应该看到：
- ✅ 服务健康检查通过
- ✅ API文档可访问
- ✅ 服务响应正常

### 3. 创建测试用户（可选）

如果测试用户不存在，可以运行：

```bash
python backend/scripts/create_test_user_simple.py
```

测试用户信息：
- 用户名: `test_user`
- 邮箱: `test@example.com`
- 密码: `test_password_123`

### 4. 运行功能测试

服务启动后，运行功能测试：

```bash
python backend/scripts/test_functional.py
```

## 测试结果说明

### 预期结果

如果所有修复都正确，应该看到：
- ✅ 用户注册/登录成功
- ✅ 获取用户信息成功
- ✅ 创建订阅成功
- ✅ 获取订阅列表成功
- ✅ 获取仪表盘数据成功
- ✅ 获取设置成功

### 常见问题

1. **连接错误 (`ConnectError`)**
   - 原因: 后端服务未启动
   - 解决: 先启动后端服务（见步骤1）

2. **超时错误 (`ReadTimeout`)**
   - 原因: 服务启动中或响应缓慢
   - 解决: 等待服务完全启动，或检查服务日志

3. **401 未授权错误**
   - 原因: Token 获取失败或已过期
   - 解决: 重新运行测试，确保用户登录成功

4. **500 内部服务器错误**
   - 原因: 后端代码错误或数据库问题
   - 解决: 检查服务日志，查看详细错误信息

## 下一步

测试通过后，可以继续：
1. 运行 API 端点测试 (`test_api_endpoints.py`)
2. 运行集成测试 (`test_integration.py`)
3. 运行性能测试 (`test_performance.py`)
4. 运行综合测试 (`test_comprehensive.py`)

