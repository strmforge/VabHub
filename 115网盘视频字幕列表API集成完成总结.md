# 115ç½‘ç›˜è§†é¢‘å­—å¹•åˆ—è¡¨APIé›†æˆå®Œæˆæ€»ç»“

## ğŸ“‹ æ¦‚è¿°

å·²æˆåŠŸé›†æˆ115ç½‘ç›˜å®˜æ–¹APIæ–‡æ¡£ä¸­çš„"è§†é¢‘å­—å¹•åˆ—è¡¨"åŠŸèƒ½ï¼Œæ”¯æŒè·å–è§†é¢‘æ–‡ä»¶çš„å­—å¹•åˆ—è¡¨ä¿¡æ¯ã€‚

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. è§†é¢‘å­—å¹•åˆ—è¡¨API âœ…

**å®ç°ä½ç½®**: `app/core/cloud_storage/providers/cloud_115_api.py`

**æ–¹æ³•**: `get_video_subtitle_list`

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… è°ƒç”¨ `/open/video/subtitle` ç«¯ç‚¹è·å–è§†é¢‘å­—å¹•åˆ—è¡¨
- âœ… æ”¯æŒé€šè¿‡ `pick_code` æŸ¥è¯¢è§†é¢‘æ–‡ä»¶çš„å­—å¹•
- âœ… è¿”å›è‡ªåŠ¨è½½å…¥å­—å¹•åˆ—è¡¨ (`autoload`) å’Œå­—å¹•åˆ—è¡¨ (`list`)
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

**APIå‚æ•°**:
- `pick_code` (å¿…é¡»): è§†é¢‘æ–‡ä»¶æå–ç 

**è¿”å›æ•°æ®ç»“æ„**:
```python
{
    "success": True,
    "pick_code": "è§†é¢‘æ–‡ä»¶æå–ç ",
    "autoload": {
        "sid": "å­—å¹•ID",
        "language": "è¯­è¨€",
        "title": "å­—å¹•æ ‡é¢˜",
        "url": "å­—å¹•æ–‡ä»¶åœ°å€",
        "type": "å­—å¹•æ–‡ä»¶ç±»å‹"
    },
    "list": [
        {
            "sid": "å­—å¹•ID",
            "language": "è¯­è¨€",
            "title": "å­—å¹•æ ‡é¢˜",
            "url": "å­—å¹•æ–‡ä»¶åœ°å€",
            "type": "å­—å¹•æ–‡ä»¶ç±»å‹",
            "sha1": "å­—å¹•æ–‡ä»¶å“ˆå¸Œå€¼",
            "file_id": "å­—å¹•æ–‡ä»¶ID",
            "file_name": "å¤–æŒ‚å­—å¹•æ–‡ä»¶å",
            "pick_code": "å¤–æŒ‚å­—å¹•æ–‡ä»¶æå–ç ",
            "caption_map_id": "å­—å¹•æ˜ å°„ID",
            "is_caption_map": 0/1,
            "sync_time": å­—å¹•åŒæ­¥æ—¶é—´
        },
        ...
    ],
    "count": å­—å¹•æ•°é‡
}
```

## ğŸ¯ æŠ€æœ¯å®ç°ç»†èŠ‚

### 1. APIç«¯ç‚¹

**ç«¯ç‚¹**: `GET /open/video/subtitle`

**è¯·æ±‚å¤´**:
- `Authorization: Bearer {access_token}`

**æŸ¥è¯¢å‚æ•°**:
- `pick_code` (å¿…é¡»): è§†é¢‘æ–‡ä»¶æå–ç 

### 2. è¿”å›æ•°æ®å¤„ç†

**æ•°æ®ç»“æ„è§£æ**:
- `state`: å“åº”çŠ¶æ€ï¼ˆbooleanï¼‰
- `message`: å“åº”æ¶ˆæ¯ï¼ˆstringï¼‰
- `code`: å“åº”ä»£ç ï¼ˆnumberï¼‰
- `data`: æ•°æ®å¯¹è±¡
  - `autoload`: è‡ªåŠ¨è½½å…¥å­—å¹•åˆ—è¡¨ï¼ˆobjectï¼‰
  - `list`: å­—å¹•åˆ—è¡¨ï¼ˆarray of objectsï¼‰

**å­—å¹•é¡¹å­—æ®µ**:
- `sid`: å­—å¹•ID
- `language`: è¯­è¨€
- `title`: å­—å¹•æ ‡é¢˜
- `url`: å­—å¹•æ–‡ä»¶åœ°å€
- `type`: å­—å¹•æ–‡ä»¶ç±»å‹
- `sha1`: å­—å¹•æ–‡ä»¶å“ˆå¸Œå€¼
- `file_id`: å­—å¹•æ–‡ä»¶ID
- `file_name`: å¤–æŒ‚å­—å¹•æ–‡ä»¶å
- `pick_code`: å¤–æŒ‚å­—å¹•æ–‡ä»¶æå–ç 
- `caption_map_id`: å­—å¹•æ˜ å°„ID
- `is_caption_map`: æ˜¯å¦ä¸ºå­—å¹•æ˜ å°„ï¼ˆ0/1ï¼‰
- `sync_time`: å­—å¹•åŒæ­¥æ—¶é—´

### 3. é”™è¯¯å¤„ç†

**é”™è¯¯æƒ…å†µ**:
- âœ… 401é”™è¯¯ï¼šè®¤è¯å¤±è´¥ï¼ˆaccess_tokenæ— æ•ˆæˆ–è¿‡æœŸï¼‰
- âœ… HTTPçŠ¶æ€é”™è¯¯ï¼šå…¶ä»–HTTPé”™è¯¯
- âœ… ç½‘ç»œå¼‚å¸¸ï¼šè¯·æ±‚è¶…æ—¶æˆ–ç½‘ç»œé”™è¯¯
- âœ… APIè¿”å›é”™è¯¯ï¼šstate=falseæ—¶çš„é”™è¯¯å¤„ç†

## ğŸ”§ ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ä½¿ç”¨

```python
from app.core.cloud_storage.providers.cloud_115_api import Cloud115API

# åˆå§‹åŒ–APIå®¢æˆ·ç«¯
api = Cloud115API(access_token="your_access_token")

# è·å–è§†é¢‘å­—å¹•åˆ—è¡¨
result = await api.get_video_subtitle_list(pick_code="b53gu6z3hvqji8wrm")

if result.get("success"):
    autoload = result.get("autoload")
    subtitle_list = result.get("list")
    count = result.get("count")
    
    print(f"å­—å¹•æ•°é‡: {count}")
    print(f"è‡ªåŠ¨è½½å…¥å­—å¹•: {autoload}")
    
    for subtitle in subtitle_list:
        print(f"å­—å¹•: {subtitle.get('title')} ({subtitle.get('language')})")
        print(f"  æ–‡ä»¶åœ°å€: {subtitle.get('url')}")
        print(f"  æ–‡ä»¶ç±»å‹: {subtitle.get('type')}")
else:
    print(f"è·å–å­—å¹•åˆ—è¡¨å¤±è´¥: {result.get('error')}")
```

### é›†æˆåˆ°ä¸Šä¼ ä»»åŠ¡ç®¡ç†

```python
# åœ¨ä¸Šä¼ å®Œæˆåè·å–å­—å¹•åˆ—è¡¨
upload_result = await upload_manager.upload_file(...)

if upload_result.get("success"):
    pick_code = upload_result.get("pick_code")
    
    if pick_code:
        # è·å–è§†é¢‘å­—å¹•åˆ—è¡¨
        subtitle_result = await api.get_video_subtitle_list(pick_code)
        
        if subtitle_result.get("success"):
            # å¤„ç†å­—å¹•åˆ—è¡¨
            subtitle_list = subtitle_result.get("list")
            # å¯ä»¥ä¸‹è½½å­—å¹•æ–‡ä»¶æˆ–ä¿å­˜å­—å¹•ä¿¡æ¯
```

## ğŸ“Š åº”ç”¨åœºæ™¯

### 1. è§†é¢‘ä¸Šä¼ åå­—å¹•ç®¡ç†

- ä¸Šä¼ è§†é¢‘æ–‡ä»¶åè‡ªåŠ¨è·å–å­—å¹•åˆ—è¡¨
- ä¸‹è½½å­—å¹•æ–‡ä»¶åˆ°æœ¬åœ°
- åŒæ­¥å­—å¹•æ–‡ä»¶åˆ°åª’ä½“æœåŠ¡å™¨

### 2. å­—å¹•æ–‡ä»¶ä¸‹è½½

- æ ¹æ® `pick_code` è·å–å­—å¹•åˆ—è¡¨
- ä½¿ç”¨ `url` ä¸‹è½½å­—å¹•æ–‡ä»¶
- ä¿å­˜å­—å¹•æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•

### 3. å­—å¹•ä¿¡æ¯å±•ç¤º

- åœ¨å‰ç«¯å±•ç¤ºè§†é¢‘çš„å­—å¹•åˆ—è¡¨
- æ˜¾ç¤ºå­—å¹•è¯­è¨€ã€æ ‡é¢˜ã€ç±»å‹ç­‰ä¿¡æ¯
- æ”¯æŒå­—å¹•æ–‡ä»¶é¢„è§ˆå’Œä¸‹è½½

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [115ç½‘ç›˜å®˜æ–¹APIæ–‡æ¡£é›†æˆå®Œæˆæ€»ç»“](./115ç½‘ç›˜å®˜æ–¹APIæ–‡æ¡£é›†æˆå®Œæˆæ€»ç»“.md)
- [115ç½‘ç›˜ä¸Šä¼ ä»»åŠ¡ç®¡ç†å®Œæ•´åŠŸèƒ½å®ç°æ€»ç»“](./115ç½‘ç›˜ä¸Šä¼ ä»»åŠ¡ç®¡ç†å®Œæ•´åŠŸèƒ½å®ç°æ€»ç»“.md)

## âœ… æ€»ç»“

å·²æˆåŠŸé›†æˆ115ç½‘ç›˜è§†é¢‘å­—å¹•åˆ—è¡¨APIï¼š

1. âœ… **APIæ–¹æ³•å®ç°** - å®Œæ•´å®ç° `get_video_subtitle_list` æ–¹æ³•
2. âœ… **å‚æ•°å¤„ç†** - æ­£ç¡®å¤„ç† `pick_code` å‚æ•°
3. âœ… **è¿”å›æ•°æ®è§£æ** - å®Œæ•´è§£æ `autoload` å’Œ `list` æ•°æ®ç»“æ„
4. âœ… **é”™è¯¯å¤„ç†** - å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
5. âœ… **æ–‡æ¡£è¯´æ˜** - è¯¦ç»†çš„APIæ–‡æ¡£å’Œä½¿ç”¨ç¤ºä¾‹

è¯¥åŠŸèƒ½å¯ä»¥ç”¨äºï¼š
- è§†é¢‘ä¸Šä¼ åè‡ªåŠ¨è·å–å­—å¹•åˆ—è¡¨
- å­—å¹•æ–‡ä»¶ä¸‹è½½å’Œç®¡ç†
- å­—å¹•ä¿¡æ¯å±•ç¤ºå’ŒåŒæ­¥

æ‰€æœ‰åŠŸèƒ½å·²é€šè¿‡linteræ£€æŸ¥ï¼Œä»£ç è´¨é‡è‰¯å¥½ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚

