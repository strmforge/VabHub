# VabHub 下一步工作计划

**更新时间**: 2025-01-XX  
**当前状态**: 密钥管理和STRM系统测试已完成

---

## ✅ 刚刚完成的工作

1. ✅ **STRM系统测试** - 核心功能测试通过
2. ✅ **系统设置UI完善** - API Token显示和密钥管理说明
3. ✅ **文档完善** - 密钥管理使用指南和部署文档更新

---

## 🎯 下一步建议（按优先级排序）

### 选项1: 完善STRM系统功能 ⭐⭐⭐⭐⭐

**优先级**: 最高  
**原因**: STRM系统是核心功能，需要完善才能正常使用

**待完成任务**:

1. **实现字幕文件下载地址获取** ⚠️
   - **位置**: `backend/app/modules/strm/generator.py:531`
   - **任务**: 从subtitle_file提取pick_code并获取下载地址
   - **影响**: STRM文件无法包含字幕文件链接

2. **实现123云盘支持** ⚠️
   - **位置**: `backend/app/api/strm.py:149`
   - **任务**: 实现123云盘的STRM重定向功能
   - **影响**: 目前只支持115网盘

3. **实现同步任务管理器** ⚠️
   - **位置**: `backend/app/api/strm.py:590`
   - **任务**: 存储和管理正在运行的同步任务
   - **影响**: 无法追踪同步任务状态

**预计工作量**: 2-3小时

---

### 选项2: 系统整体测试和优化 ⭐⭐⭐⭐

**优先级**: 高  
**原因**: 确保所有功能正常工作

**测试任务**:

1. **STRM系统完整测试**
   - 测试STRM文件生成（包含字幕）
   - 测试STRM重定向（115网盘）
   - 测试同步功能（全量和增量）
   - 测试生命周期追踪

2. **密钥管理功能测试**
   - 测试密钥自动生成
   - 测试密钥加载和持久化
   - 测试环境变量覆盖
   - 测试系统设置UI

3. **其他核心功能测试**
   - 媒体识别和整理
   - 订阅管理
   - 下载管理
   - 搜索功能

**预计工作量**: 3-4小时

---

### 选项3: 实现其他缺失功能 ⭐⭐⭐

**优先级**: 中  
**原因**: 提升系统完整性

**可选任务**:

<!-- 
已评估：不推荐实现
1. **AI Agent系统** ❌ 不推荐
   - 功能重复（VabHub已有更强大的AI功能）
   - 需要用户付费使用外部LLM
   - 使用率低，开发成本高
   - 详见：AI-Agent和Servarr集成必要性分析.md

2. **Servarr集成** ❌ 低优先级，不推荐
   - 使用场景有限（只有使用Overseerr/Jellyseerr的用户需要）
   - 功能重复（VabHub已有完整的订阅API）
   - 详见：AI-Agent和Servarr集成必要性分析.md
-->

3. **增强通知系统** ⚠️
   - 支持更多通知渠道（Telegram、WeChat等）
   - 优化通知模板

**预计工作量**: 根据功能复杂度而定

---

### 选项4: 代码优化和重构 ⭐⭐

**优先级**: 低  
**原因**: 提升代码质量

**优化任务**:

1. **清理TODO项**
   - 完成所有TODO标记的功能
   - 移除过时的TODO注释

2. **代码重构**
   - 优化重复代码
   - 提升代码可读性
   - 添加更多注释

3. **性能优化**
   - 优化数据库查询
   - 优化API响应速度
   - 优化前端加载速度

**预计工作量**: 持续进行

---

## 📊 推荐执行顺序

### 第一阶段：完善STRM系统（推荐）⭐⭐⭐⭐⭐

**理由**: STRM系统是核心功能，需要完善才能正常使用

**任务列表**:
1. ✅ 实现字幕文件下载地址获取
2. ✅ 实现123云盘支持（可选）
3. ✅ 实现同步任务管理器

**预计时间**: 2-3小时

### 第二阶段：系统测试和优化

**任务列表**:
1. ✅ STRM系统完整测试
2. ✅ 密钥管理功能测试
3. ✅ 其他核心功能测试

**预计时间**: 3-4小时

### 第三阶段：实现其他功能

**任务列表**:
<!-- 
已评估：不推荐实现
1. ❌ AI Agent系统 - 不推荐（功能重复，成本高，使用率低）
2. ❌ Servarr集成 - 不推荐（使用场景有限，功能重复）
-->
3. ⚠️ 增强通知系统（可选）
   - Telegram通知
   - WeChat通知
   - WebPush通知

**预计时间**: 根据功能复杂度而定

---

## 🎯 立即行动建议

### 推荐：完善STRM系统功能

**第一步**: 实现字幕文件下载地址获取
- 文件: `backend/app/modules/strm/generator.py`
- 行号: 531
- 任务: 从subtitle_file提取pick_code并获取115网盘下载地址

**第二步**: 实现同步任务管理器
- 文件: `backend/app/api/strm.py`
- 行号: 590
- 任务: 创建同步任务管理模型和API

**第三步**: 测试完整STRM工作流
- 测试STRM文件生成（包含字幕）
- 测试STRM重定向
- 测试同步功能

---

## 📝 待完成的TODO项

### 高优先级

1. **STRM字幕文件下载地址获取** (`generator.py:531`)
2. **STRM同步任务管理器** (`strm.py:590`)

### 中优先级

3. **123云盘支持** (`strm.py:149`)
4. **TMDB API集成优化** (`parser.py:278`)

### 低优先级

5. **邮件服务器配置** (`channels.py:167`)
6. **浏览器推送通知** (`channels.py:363`)
7. **存储统计** (`graphql/schema.py:360`)
8. **权限检查** (`log_center.py:122`)

---

## 🚀 快速开始

### 如果想立即开始：

**推荐任务**: 实现STRM字幕文件下载地址获取

**步骤**:
1. 打开 `backend/app/modules/strm/generator.py`
2. 找到第531行的TODO
3. 实现从subtitle_file提取pick_code的逻辑
4. 调用115 API获取下载地址
5. 测试功能

**预计时间**: 30-60分钟

---

**文档生成时间**: 2025-01-XX  
**建议优先级**: STRM系统完善 > 系统测试 > 其他功能

---

## ❌ 不推荐实现的功能

**已评估且不推荐的功能**（详见 `不推荐功能清单.md`）:
- ❌ **AI Agent系统** - 功能重复，成本高，使用率低
- ❌ **Servarr集成** - 使用场景有限，功能重复

**请勿重复讨论这些功能，优先实现推荐功能。**
