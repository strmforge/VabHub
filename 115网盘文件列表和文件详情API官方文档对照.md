# 115网盘文件列表和文件详情API官方文档对照

## 📋 官方文档规范

### 1. 获取文件列表API

**端点**: `GET 域名+/open/ufile/files`

**说明**: 获取文件列表

#### 请求参数

**Headers**:
- `Authorization: Bearer access_token`（必填）

**Query参数**:
- `cid`: 目录ID，对应parent id（可选）
- `type`: 文件类型（可选）
  - 1.文档
  - 2.图片
  - 3.音乐
  - 4.视频
  - 5.压缩
  - 6.应用
  - 7.书籍
- `limit`: 查询数量（可选，默认20，最大1150）
- `offset`: 查询起始位（可选，默认0）
- `suffix`: 文件后缀名（可选）
- `asc`: 排序（可选，1:升序 0:降序）
- `o`: 排序字段（可选）
  - `file_name`: 文件名
  - `file_size`: 文件大小
  - `user_utime`: 更新时间
  - `file_type`: 文件类型
- `custom_order`: 是否使用记忆排序（可选）
  - 1: 使用自定义排序，不使用记忆排序
  - 0: 使用记忆排序，自定义排序失效
  - 2: 自定义排序，非文件夹置顶
- `stdir`: 筛选文件时，是否显示文件夹（可选）
  - 1: 要展示文件夹
  - 0: 不展示
- `star`: 筛选星标文件（可选）
  - 1: 是
  - 0: 全部
- `cur`: 是否只显示当前文件夹内文件（可选）
- `show_dir`: 是否显示目录（可选，0或1，默认为0）

#### 返回数据

返回`data`数组，每个对象包含：
- `fid`: 文件ID
- `aid`: 文件状态（1正常, 7删除(回收站), 120彻底删除）
- `pid`: 父目录ID
- `fc`: 文件分类（0文件夹, 1文件）
- `fn`: 文件(夹)名称
- `fco`: 文件夹封面
- `ism`: 是否星标（1:星标）
- `isp`: 是否加密（1:加密）
- `pc`: 文件提取码
- `upt`: 修改时间
- `uet`: 修改时间
- `uppt`: 上传时间
- `cm`: 数字
- `fdesc`: 文件备注
- `ispl`: 是否统计文件夹下视频时长开关
- `fl`: 文件标签（对象数组）
  - `id`: 文件标签id
  - `name`: 文件标签名称
  - `sort`: 文件标签排序
  - `color`: 文件标签颜色
  - `is_default`: 文件标签类型（0:最近使用; 1:非最近使用; 2:为默认标签）
  - `update_time`: 文件标签更新时间
  - `create_time`: 文件标签创建时间
- `sha1`: sha1值
- `fs`: 文件大小
- `fta`: 文件状态（0/2未上传完成, 1已上传完成）
- `ico`: 文件后缀名
- `fatr`: 音频长度
- `isv`: 是否为视频
- `def`: 视频清晰度（1:标清 2:高清 3:超清 4:1080P 5:4k; 100:原画）
- `def2`: 视频清晰度
- `play_long`: 音视频时长
- `v_img`: 视频图片
- `thumb`: 图片缩略图
- `uo`: 原图地址

### 2. 获取文件(夹)详情API

**端点**: `GET/POST 域名+/open/folder/get_info`

**说明**: 获取文件(夹)详情

#### 请求参数

**Headers**:
- `Authorization: Bearer access_token`（必填）

**Query参数**（GET方法）:
- `file_id`: 文件(夹)ID（可选，和path需必传一个）

**Body参数**（POST方法，form-data）:
- `path`: 文件路径（可选，和file_id需必传一个）
  - 分隔符支持`/`和`>`两种符号
  - 最前面需分隔符开头
  - 以分隔符分隔目录层级
  - 示例: `/a/b/c.png` 或 `>a>b>c`

#### 返回数据

返回`data`对象，包含：
- `count`: 包含文件总数量
- `size`: 文件(夹)总大小（格式化字符串）
- `size_byte`: 文件(夹)总大小（字节单位）
- `folder_count`: 包含文件夹总数量
- `play_long`: 视频时长（-1:正在统计,其他数值为视频时长的数值(单位秒)）
- `show_play_long`: 是否开启展示视频时长
- `ptime`: 上传时间
- `utime`: 修改时间
- `file_name`: 文件名
- `pick_code`: 文件提取码
- `sha1`: sha1值
- `file_id`: 文件(夹)ID
- `is_mark`: 是否星标
- `open_time`: 文件(夹)最近打开时间
- `file_category`: 文件属性（1:文件; 0:文件夹）
- `paths`: 文件(夹)所在的路径（对象数组）
  - `file_id`: 父目录ID
  - `file_name`: 父目录名称

## ✅ 当前实现对照

### 1. 获取文件列表API

#### 实现检查

- **API端点**: ✅ 正确 (`GET /open/ufile/files`)
- **请求头**: ✅ 正确 (`Authorization: Bearer access_token`)
- **查询参数**: ✅ 已实现所有参数
  - `cid`: ✅ 支持
  - `type`: ✅ 支持（file_type参数）
  - `limit`: ✅ 支持（默认20，最大1150）
  - `offset`: ✅ 支持
  - `suffix`: ✅ 支持
  - `asc`: ✅ 支持
  - `o`: ✅ 支持（order_by参数）
  - `custom_order`: ✅ 支持
  - `stdir`: ✅ 支持
  - `star`: ✅ 支持
  - `cur`: ✅ 支持
  - `show_dir`: ✅ 支持（默认0）

- **返回数据**: ✅ 已实现完整字段映射
  - 所有官方文档中的字段都已映射
  - 包括文件标签（fl）的完整结构
  - 包括视频、音频、图片的扩展信息

#### 改进点

1. ✅ **参数完整性**: 已实现所有官方文档中的参数
2. ✅ **返回数据完整性**: 已映射所有官方文档中的返回字段
3. ✅ **错误处理**: 已添加HTTP错误处理（401未授权）
4. ✅ **参数验证**: 已添加limit最大值限制（1150）

### 2. 获取文件(夹)详情API

#### 实现检查

- **API端点**: ✅ 正确 (`GET/POST /open/folder/get_info`)
- **请求头**: ✅ 正确 (`Authorization: Bearer access_token`)
- **请求方法**: ✅ 支持GET（file_id）和POST（path）
- **路径格式**: ✅ 支持`/`和`>`分隔符
- **返回数据**: ✅ 已实现完整字段映射
  - 所有官方文档中的字段都已映射
  - 包括新增的`size_byte`字段
  - 包括`paths`路径数组

#### 改进点

1. ✅ **返回数据完整性**: 已映射所有官方文档中的返回字段
2. ✅ **新增字段**: 已添加`size_byte`字段（2025年6月6日新增）
3. ✅ **路径支持**: 已支持通过路径获取文件详情（2025年6月6日新增）
4. ✅ **错误处理**: 已添加HTTP错误处理（401未授权）

## 📊 字段映射对照

### 获取文件列表 - 返回字段映射

| 官方文档字段 | 当前实现字段 | 说明 |
|-------------|-------------|------|
| fid | file_id | 文件ID |
| aid | aid | 文件状态 |
| pid | parent_id | 父目录ID |
| fc | file_category | 文件分类 |
| fn | file_name | 文件名称 |
| fco | folder_cover | 文件夹封面 |
| ism | is_starred | 是否星标 |
| isp | is_encrypted | 是否加密 |
| pc | pick_code | 文件提取码 |
| upt | update_time | 修改时间 |
| uet | edit_time | 修改时间 |
| uppt | upload_time | 上传时间 |
| cm | cm | 数字字段 |
| fdesc | file_desc | 文件备注 |
| ispl | is_play_long | 是否统计视频时长 |
| fl | file_tags | 文件标签数组 |
| sha1 | sha1 | sha1值 |
| fs | file_size | 文件大小 |
| fta | file_status | 文件状态 |
| ico | file_ext | 文件后缀名 |
| fatr | audio_length | 音频长度 |
| isv | is_video | 是否为视频 |
| def | video_quality | 视频清晰度 |
| def2 | video_quality2 | 视频清晰度2 |
| play_long | play_duration | 音视频时长 |
| v_img | video_image | 视频图片 |
| thumb | thumbnail | 图片缩略图 |
| uo | original_image | 原图地址 |

### 获取文件(夹)详情 - 返回字段映射

| 官方文档字段 | 当前实现字段 | 说明 |
|-------------|-------------|------|
| count | count | 包含文件总数量 |
| size | size | 文件(夹)总大小（格式化） |
| size_byte | size_byte | 文件(夹)总大小（字节） |
| folder_count | folder_count | 包含文件夹总数量 |
| play_long | play_long | 视频时长 |
| show_play_long | show_play_long | 是否开启展示视频时长 |
| ptime | ptime | 上传时间 |
| utime | utime | 修改时间 |
| file_name | file_name | 文件名 |
| pick_code | pick_code | 文件提取码 |
| sha1 | sha1 | sha1值 |
| file_id | file_id | 文件(夹)ID |
| is_mark | is_mark | 是否星标 |
| open_time | open_time | 最近打开时间 |
| file_category | file_category | 文件属性 |
| paths | paths | 文件(夹)所在的路径 |

## 💡 使用示例

### 1. 获取文件列表

```python
from app.core.cloud_storage.providers.cloud_115_api import Cloud115API

# 初始化API客户端
api = Cloud115API(access_token=token_info["access_token"])

# 获取文件列表（基础用法）
files = await api.list_files(file_id="0")

# 获取视频文件列表
videos = await api.list_files(
    file_id="0",
    file_type=4,  # 4:视频
    limit=50,
    order_by="file_size",
    asc=0  # 降序
)

# 获取星标文件
starred_files = await api.list_files(
    file_id="0",
    star=1,  # 只显示星标文件
    show_dir=1  # 显示目录
)

# 按文件类型筛选
documents = await api.list_files(
    file_id="0",
    file_type=1,  # 1:文档
    suffix="pdf"  # PDF文件
)
```

### 2. 获取文件(夹)详情

```python
# 通过文件ID获取详情
file_info = await api.get_file_info(file_id="1288444975268439877")

# 通过路径获取详情
file_info = await api.get_file_info(path="/a/b/c.png")

# 使用>分隔符
file_info = await api.get_file_info(path=">a>b>c")

# 访问返回数据
print(f"文件名称: {file_info.get('file_name')}")
print(f"文件大小: {file_info.get('size')} ({file_info.get('size_byte')} 字节)")
print(f"包含文件数: {file_info.get('count')}")
print(f"包含文件夹数: {file_info.get('folder_count')}")
print(f"视频时长: {file_info.get('play_long')} 秒")
print(f"文件路径: {file_info.get('paths')}")
```

## 🎯 关键改进

### 1. 文件列表API

1. ✅ **参数完整性**: 实现了所有官方文档中的查询参数
2. ✅ **返回数据完整性**: 映射了所有官方文档中的返回字段
3. ✅ **文件标签支持**: 完整支持文件标签（fl）数组结构
4. ✅ **多媒体信息**: 支持视频、音频、图片的扩展信息
5. ✅ **参数验证**: 添加了limit最大值限制（1150）

### 2. 文件(夹)详情API

1. ✅ **路径支持**: 支持通过路径获取文件详情（2025年6月6日新增）
2. ✅ **size_byte字段**: 添加了字节单位的大小字段（2025年6月6日新增）
3. ✅ **路径数组**: 完整支持paths路径数组
4. ✅ **返回数据完整性**: 映射了所有官方文档中的返回字段

## 📝 更新记录

### 2025年6月6日
- 新增根据文件路径获取文件(夹)详情
- 新增size_byte字段返回

### 2025年4月3日
- 新增补充fl(文件标签)字段和其二级结构详情

## ✅ 结论

当前实现**完全符合**官方文档规范：

1. ✅ **获取文件列表API**: 已实现所有参数和返回字段
2. ✅ **获取文件(夹)详情API**: 已实现所有功能，包括最新更新
3. ✅ **错误处理**: 完善的错误处理和日志记录
4. ✅ **参数验证**: 添加了必要的参数验证
5. ✅ **字段映射**: 完整的字段映射，保持与官方文档一致

**总体评价**: ✅ **实现完整，完全符合官方文档规范**

## 🔗 相关文档

- [115网盘官方API文档](https://www.yuque.com/115yun/open/qur839kyx9cgxpxi)
- [文件列表API官方文档对照](./115网盘文件列表和文件详情API官方文档对照.md)
- [文件(夹)详情API官方文档对照](./115网盘文件列表和文件详情API官方文档对照.md)
- [API客户端使用](./115网盘官方API文档集成完成总结.md)

