# è¿‡å¾€ç‰ˆæœ¬åŠŸèƒ½å¿«é€Ÿå‚è€ƒ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. è·å–ç”¨æˆ·æ¨è

```python
# æ–¹æ³•1: ä½¿ç”¨ä¾¿æ·å‡½æ•°ï¼ˆæœ€ç®€å•ï¼‰
from app.core.legacy_utils import get_user_recommendations

recommendations = await get_user_recommendations(user_id=1, limit=20)

# æ–¹æ³•2: ä½¿ç”¨æœåŠ¡å±‚
from app.modules.recommendation.service import RecommendationService

service = RecommendationService(db)
recommendations = await service.get_recommendations(user_id=1, limit=20)

# æ–¹æ³•3: ç›´æ¥è°ƒç”¨é€‚é…å™¨
from app.core.legacy_adapter import get_recommendation_engine

engine = get_recommendation_engine(version="vabhub_1")
recommendations = engine.update_recommendations(user_id=1)
```

### 2. è§£æåª’ä½“æ–‡ä»¶å

```python
# æ–¹æ³•1: ä½¿ç”¨ä¾¿æ·å‡½æ•°
from app.core.legacy_utils import parse_media_filename

result = parse_media_filename("/path/to/movie.mkv")

# æ–¹æ³•2: ä½¿ç”¨æœåŠ¡å±‚
from app.modules.media_identification.service import MediaIdentificationService

service = MediaIdentificationService(db)
result = await service.identify_media("/path/to/movie.mkv")

# æ–¹æ³•3: ä½¿ç”¨åŒ…è£…å™¨
from app.core.legacy_wrapper import MediaParserWrapper

parser = MediaParserWrapper(version="vabhub_1")
result = parser.parse_filename("/path/to/movie.mkv")
```

### 3. è·å–éŸ³ä¹æ¦œå•

```python
# æ–¹æ³•1: ä½¿ç”¨ä¾¿æ·å‡½æ•°
from app.core.legacy_utils import get_music_charts

charts = await get_music_charts("qq_music", "hot", 50)

# æ–¹æ³•2: ä½¿ç”¨æœåŠ¡å±‚
from app.modules.charts.service import ChartsService

service = ChartsService(db)
charts = await service.get_charts("qq_music", "hot", "CN", 50)
```

## ğŸ“‹ åŠŸèƒ½åˆ—è¡¨

### æ¨èç³»ç»Ÿ

| åŠŸèƒ½ | ä¾¿æ·å‡½æ•° | æœåŠ¡ç±» | APIç«¯ç‚¹ |
|-----|---------|--------|---------|
| è·å–ç”¨æˆ·æ¨è | `get_user_recommendations()` | `RecommendationService` | `GET /recommendations/{user_id}` |
| è·å–ç›¸ä¼¼å†…å®¹ | - | `RecommendationService` | `GET /recommendations/{user_id}/similar/{media_id}` |
| è·å–çƒ­é—¨æ¨è | - | `RecommendationService` | `GET /recommendations/popular` |

### åª’ä½“è¯†åˆ«

| åŠŸèƒ½ | ä¾¿æ·å‡½æ•° | æœåŠ¡ç±» | APIç«¯ç‚¹ |
|-----|---------|--------|---------|
| è¯†åˆ«åª’ä½“æ–‡ä»¶ | `parse_media_filename()` | `MediaIdentificationService` | `POST /media-identification/identify` |
| æ‰¹é‡è¯†åˆ« | - | `MediaIdentificationService` | `POST /media-identification/identify/batch` |

### æ¦œå•ç³»ç»Ÿ

| åŠŸèƒ½ | ä¾¿æ·å‡½æ•° | æœåŠ¡ç±» | APIç«¯ç‚¹ |
|-----|---------|--------|---------|
| è·å–éŸ³ä¹æ¦œå• | `get_music_charts()` | `ChartsService` | `POST /charts/music` |
| è·å–å½±è§†æ¦œå• | - | `VideoChartsService` | `POST /charts/video` |
| æ¯”è¾ƒæ¦œå• | - | `ChartsService` | `GET /charts/music/compare` |

## ğŸ”§ é€‚é…å™¨è°ƒç”¨

### è·å–åŠŸèƒ½å®ä¾‹

```python
from app.core.legacy_adapter import get_legacy_adapter

adapter = get_legacy_adapter()

# è·å–æ¨èå¼•æ“
engine = adapter.get_instance("recommendation_engine", version="vabhub_1")

# è·å–åª’ä½“è§£æå™¨
parser = adapter.get_instance("media_parser", version="vabhub_1")

# è·å–éŸ³ä¹æ¦œå•æœåŠ¡
charts = adapter.get_instance("music_charts", version="vabhub_1")
```

### è°ƒç”¨åŠŸèƒ½æ–¹æ³•

```python
from app.core.legacy_adapter import get_legacy_adapter

adapter = get_legacy_adapter()

# è°ƒç”¨æ¨èå¼•æ“æ–¹æ³•
recommendations = adapter.call_function(
    "recommendation_engine",
    "update_recommendations",
    version="vabhub_1",
    user_id=1
)
```

### æŸ¥è¯¢å¯ç”¨åŠŸèƒ½

```python
from app.core.legacy_utils import list_available_functions

functions = list_available_functions()
for func_name, func_info in functions.items():
    print(f"{func_name}: {func_info['description']}")
    print(f"  ç‰ˆæœ¬: {', '.join(func_info['versions'])}")
```

## ğŸ“ ç‰ˆæœ¬ä¿¡æ¯

### æ”¯æŒçš„ç‰ˆæœ¬

- **vabhub_1**: VabHub-1ç‰ˆæœ¬
- **vabhub_14**: VabHub1.4ç‰ˆæœ¬
- **vabhub_variant**: VabHub-å˜å¼‚ç‰ˆ
- **vabhub_lingma**: VabHub-Lingmaç‰ˆ

### åŠŸèƒ½ç‰ˆæœ¬æ˜ å°„

| åŠŸèƒ½ | vabhub_1 | vabhub_14 | è¯´æ˜ |
|-----|----------|-----------|------|
| æ¨èå¼•æ“ | âœ… | âœ… | ååŒè¿‡æ»¤ã€å†…å®¹æ¨è |
| åª’ä½“è¯†åˆ« | âœ… | - | æ–‡ä»¶åè§£æã€AIè¯†åˆ« |
| éŸ³ä¹æ¦œå• | âœ… | - | QQéŸ³ä¹ã€ç½‘æ˜“äº‘ç­‰ |
| å½±è§†æ¦œå• | - | âœ… | TMDBã€è±†ç“£ |
| AIåˆ†ç±»å™¨ | âœ… | - | å†…å®¹åˆ†ç±» |
| ä¸‹è½½ç®¡ç† | âœ… | - | qBittorrentã€Transmission |

## âš¡ æ€§èƒ½æç¤º

1. **ä½¿ç”¨ç¼“å­˜**: é€‚é…å™¨ä¼šè‡ªåŠ¨ç¼“å­˜å·²åŠ è½½çš„æ¨¡å—
2. **å•ä¾‹æ¨¡å¼**: æ¯ä¸ªåŠŸèƒ½ç±»åªåˆ›å»ºä¸€ä¸ªå®ä¾‹
3. **æ‡’åŠ è½½**: åªæœ‰åœ¨å®é™…ä½¿ç”¨æ—¶æ‰åŠ è½½æ¨¡å—
4. **å¼‚æ­¥æ”¯æŒ**: æ‰€æœ‰æœåŠ¡éƒ½æ”¯æŒå¼‚æ­¥è°ƒç”¨

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜1: æ¨¡å—åŠ è½½å¤±è´¥

**åŸå› **: è¿‡å¾€ç‰ˆæœ¬çš„è·¯å¾„ä¸æ­£ç¡®

**è§£å†³**: æ£€æŸ¥`legacy_adapter.py`ä¸­çš„`LEGACY_PATHS`é…ç½®

### é—®é¢˜2: ä¾èµ–ç¼ºå¤±

**åŸå› **: è¿‡å¾€ç‰ˆæœ¬çš„åŠŸèƒ½éœ€è¦ç‰¹å®šçš„ä¾èµ–åŒ…

**è§£å†³**: å®‰è£…ç¼ºå¤±çš„ä¾èµ–åŒ…ï¼ˆå¦‚numpyã€pandasã€scikit-learnç­‰ï¼‰

### é—®é¢˜3: åŠŸèƒ½ä¸å¯ç”¨

**åŸå› **: åŠŸèƒ½æœªæ³¨å†Œæˆ–ç‰ˆæœ¬ä¸åŒ¹é…

**è§£å†³**: æ£€æŸ¥`FUNCTION_REGISTRY`ä¸­çš„åŠŸèƒ½æ³¨å†Œ

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [è¿‡å¾€ç‰ˆæœ¬åŠŸèƒ½è°ƒç”¨æŒ‡å—.md](./è¿‡å¾€ç‰ˆæœ¬åŠŸèƒ½è°ƒç”¨æŒ‡å—.md) - è¯¦ç»†çš„ä½¿ç”¨æŒ‡å—
- [è¿‡å¾€ç‰ˆæœ¬åŠŸèƒ½æ•´åˆæ€»ç»“.md](./è¿‡å¾€ç‰ˆæœ¬åŠŸèƒ½æ•´åˆæ€»ç»“.md) - æ•´åˆæ€»ç»“
- [æ¦œå•ç³»ç»Ÿæ•´åˆæŠ¥å‘Š.md](./æ¦œå•ç³»ç»Ÿæ•´åˆæŠ¥å‘Š.md) - æ¦œå•ç³»ç»Ÿæ•´åˆæŠ¥å‘Š

