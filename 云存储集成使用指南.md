# äº‘å­˜å‚¨é›†æˆä½¿ç”¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

VabHub ç°å·²é›†æˆä¸‰ç§äº‘å­˜å‚¨æ–¹å¼ï¼š
- **115ç½‘ç›˜** - ä½¿ç”¨å¼€å‘è€…å¯†é’¥è¿›è¡ŒAPIè°ƒç”¨
- **RClone** - é€šè¿‡RCloneå‘½ä»¤è¡Œå·¥å…·æ“ä½œäº‘å­˜å‚¨
- **OpenList** - é€šè¿‡OAuthè·å–115ç½‘ç›˜Token

---

## ğŸ”‘ åˆå§‹åŒ–115ç½‘ç›˜å¯†é’¥

### 1. è¿è¡Œåˆå§‹åŒ–è„šæœ¬

```bash
cd backend
python scripts/init_cloud_storage.py
```

### 2. éªŒè¯å¯†é’¥å­˜å‚¨

å¯†é’¥å·²åŠ å¯†å­˜å‚¨åˆ°ï¼š
- **å¯†é’¥æ–‡ä»¶**: `~/.vabhub/cloud_keys.encrypted`
- **ä¸»å¯†é’¥**: `~/.vabhub/.master_key`

**âš ï¸ é‡è¦**: è¯·å¦¥å–„ä¿ç®¡ä¸»å¯†é’¥æ–‡ä»¶ï¼Œä¸¢å¤±åå°†æ— æ³•è§£å¯†å­˜å‚¨çš„å¯†é’¥ï¼

---

## ğŸ—„ï¸ æ•°æ®åº“è¿ç§»

### åˆ›å»ºäº‘å­˜å‚¨ç›¸å…³è¡¨

```bash
cd backend
python migrate_add_cloud_storage.py
```

è¿™å°†åˆ›å»ºä»¥ä¸‹è¡¨ï¼š
- `cloud_storages` - äº‘å­˜å‚¨é…ç½®è¡¨
- `cloud_storage_auths` - äº‘å­˜å‚¨è®¤è¯è®°å½•è¡¨

---

## ğŸ”Œ APIç«¯ç‚¹

### é…ç½®ç®¡ç†

#### åˆ›å»ºäº‘å­˜å‚¨é…ç½®
```http
POST /api/v1/cloud-storage
Content-Type: application/json

{
  "name": "115ç½‘ç›˜",
  "provider": "115",
  "enabled": true
}
```

#### åˆ—å‡ºäº‘å­˜å‚¨é…ç½®
```http
GET /api/v1/cloud-storage
```

#### è·å–äº‘å­˜å‚¨é…ç½®
```http
GET /api/v1/cloud-storage/{storage_id}
```

#### æ›´æ–°äº‘å­˜å‚¨é…ç½®
```http
PUT /api/v1/cloud-storage/{storage_id}
Content-Type: application/json

{
  "enabled": false
}
```

#### åˆ é™¤äº‘å­˜å‚¨é…ç½®
```http
DELETE /api/v1/cloud-storage/{storage_id}
```

### è®¤è¯ï¼ˆ115ç½‘ç›˜ï¼‰

#### ç”ŸæˆäºŒç»´ç 
```http
POST /api/v1/cloud-storage/{storage_id}/qr-code
```

**å“åº”**:
```json
{
  "qr_content": "äºŒç»´ç å†…å®¹",
  "qr_url": "äºŒç»´ç URL",
  "message": "äºŒç»´ç ç”ŸæˆæˆåŠŸï¼Œè¯·ä½¿ç”¨115ç½‘ç›˜Appæ‰«æ"
}
```

#### æ£€æŸ¥äºŒç»´ç çŠ¶æ€
```http
GET /api/v1/cloud-storage/{storage_id}/qr-status
```

**å“åº”**:
```json
{
  "status": 2,  // 0=æœªæ‰«ç , 1=å·²æ‰«ç , 2=å·²ç¡®è®¤, -1=å·²è¿‡æœŸ/å¤±è´¥
  "message": "ç™»å½•æˆåŠŸ",
  "token_data": {
    "access_token": "...",
    "refresh_token": "...",
    "user_id": "...",
    "user_name": "..."
  }
}
```

### æ–‡ä»¶æ“ä½œ

#### åˆ—å‡ºæ–‡ä»¶
```http
GET /api/v1/cloud-storage/{storage_id}/files?path=/&recursive=false
```

**å“åº”**:
```json
{
  "files": [
    {
      "id": "æ–‡ä»¶ID",
      "name": "æ–‡ä»¶å",
      "path": "/æ–‡ä»¶è·¯å¾„",
      "size": 1024,
      "type": "file",
      "created_at": "2024-01-01T00:00:00",
      "modified_at": "2024-01-01T00:00:00"
    }
  ],
  "total": 1
}
```

#### è·å–å­˜å‚¨ä½¿ç”¨æƒ…å†µ
```http
GET /api/v1/cloud-storage/{storage_id}/usage
```

**å“åº”**:
```json
{
  "total": 1152921504606846976,
  "used": 576460752303423488,
  "available": 576460752303423488,
  "percentage": 50.0
}
```

---

## ğŸ”§ é…ç½®è¯´æ˜

### 115ç½‘ç›˜é…ç½®

115ç½‘ç›˜ä½¿ç”¨å¼€å‘è€…å¯†é’¥è¿›è¡Œè®¤è¯ï¼š
- **AppID**: 100197729
- **AppKey**: d099625d59aba2a79e70b81fc4589b26
- **AppSecret**: 3bbf9b42fad0012439a43006c74176c349614abd5b4933c466b37313ddec1a0d

å¯†é’¥å·²åŠ å¯†å­˜å‚¨ï¼Œåˆ›å»º115ç½‘ç›˜é…ç½®æ—¶ä¼šè‡ªåŠ¨ä»å¯†é’¥ç®¡ç†å™¨è¯»å–ã€‚

### RCloneé…ç½®

RCloneéœ€è¦ï¼š
1. å®‰è£…RCloneå‘½ä»¤è¡Œå·¥å…·
2. é…ç½®RCloneè¿œç¨‹ï¼ˆé€šè¿‡`rclone config`å‘½ä»¤ï¼‰
3. åœ¨åˆ›å»ºé…ç½®æ—¶æŒ‡å®šï¼š
   - `rclone_remote_name`: è¿œç¨‹åç§°ï¼ˆé»˜è®¤ä¸º"VabHub"ï¼‰
   - `rclone_config_path`: é…ç½®æ–‡ä»¶è·¯å¾„ï¼ˆé»˜è®¤ä¸º`~/.config/rclone/rclone.conf`ï¼‰

### OpenListé…ç½®

OpenListç”¨äºOAuthç™»å½•ï¼š
- `openlist_server_url`: OpenListæœåŠ¡å™¨åœ°å€ï¼ˆé»˜è®¤ä¸º"https://api.oplist.org.cn"ï¼‰

---

## ğŸ” å¯†é’¥å®‰å…¨

### åŠ å¯†æ–¹å¼

- **ç®—æ³•**: Fernetï¼ˆå¯¹ç§°åŠ å¯†ï¼‰
- **å¯†é’¥é•¿åº¦**: 256ä½
- **å­˜å‚¨ä½ç½®**: `~/.vabhub/cloud_keys.encrypted`
- **æ–‡ä»¶æƒé™**: 600ï¼ˆä»…æ‰€æœ‰è€…å¯è¯»å†™ï¼‰

### ä¸»å¯†é’¥

- **ä½ç½®**: `~/.vabhub/.master_key`
- **æƒé™**: 600ï¼ˆä»…æ‰€æœ‰è€…å¯è¯»å†™ï¼‰
- **âš ï¸ é‡è¦**: ä¸¢å¤±ä¸»å¯†é’¥å°†æ— æ³•è§£å¯†å­˜å‚¨çš„å¯†é’¥ï¼

### ç¯å¢ƒå˜é‡

å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡è®¾ç½®ä¸»å¯†é’¥ï¼š
```bash
export VABHUB_CLOUD_MASTER_KEY="base64_encoded_key"
```

---

## ğŸš€ ä½¿ç”¨æµç¨‹

### 115ç½‘ç›˜ä½¿ç”¨æµç¨‹

1. **åˆå§‹åŒ–å¯†é’¥**ï¼ˆä»…éœ€ä¸€æ¬¡ï¼‰
   ```bash
   python backend/scripts/init_cloud_storage.py
   ```

2. **åˆ›å»ºå­˜å‚¨é…ç½®**
   ```http
   POST /api/v1/cloud-storage
   {
     "name": "æˆ‘çš„115ç½‘ç›˜",
     "provider": "115",
     "enabled": true
   }
   ```

3. **ç”ŸæˆäºŒç»´ç **
   ```http
   POST /api/v1/cloud-storage/{storage_id}/qr-code
   ```

4. **æ‰«æäºŒç»´ç **
   - ä½¿ç”¨115ç½‘ç›˜Appæ‰«æäºŒç»´ç 
   - ç¡®è®¤ç™»å½•

5. **æ£€æŸ¥ç™»å½•çŠ¶æ€**
   ```http
   GET /api/v1/cloud-storage/{storage_id}/qr-status
   ```

6. **ä½¿ç”¨å­˜å‚¨**
   - åˆ—å‡ºæ–‡ä»¶ï¼š`GET /api/v1/cloud-storage/{storage_id}/files`
   - è·å–å­˜å‚¨ä½¿ç”¨æƒ…å†µï¼š`GET /api/v1/cloud-storage/{storage_id}/usage`

### RCloneä½¿ç”¨æµç¨‹

1. **å®‰è£…RClone**
   ```bash
   # Windows
   choco install rclone
   
   # Linux
   sudo apt install rclone
   
   # Mac
   brew install rclone
   ```

2. **é…ç½®RCloneè¿œç¨‹**
   ```bash
   rclone config
   ```

3. **åˆ›å»ºå­˜å‚¨é…ç½®**
   ```http
   POST /api/v1/cloud-storage
   {
     "name": "æˆ‘çš„RCloneå­˜å‚¨",
     "provider": "rclone",
     "enabled": true,
     "rclone_remote_name": "VabHub",
     "rclone_config_path": "~/.config/rclone/rclone.conf"
   }
   ```

4. **ä½¿ç”¨å­˜å‚¨**
   - åˆ—å‡ºæ–‡ä»¶ï¼š`GET /api/v1/cloud-storage/{storage_id}/files`
   - è·å–å­˜å‚¨ä½¿ç”¨æƒ…å†µï¼š`GET /api/v1/cloud-storage/{storage_id}/usage`

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **å¯†é’¥å®‰å…¨**: ä¸»å¯†é’¥æ–‡ä»¶éå¸¸é‡è¦ï¼Œè¯·å¦¥å–„ä¿ç®¡
2. **RCloneä¾èµ–**: ä½¿ç”¨RCloneéœ€è¦å…ˆå®‰è£…RCloneå‘½ä»¤è¡Œå·¥å…·
3. **OpenList**: OpenListä¸»è¦ç”¨äºOAuthç™»å½•ï¼Œå®é™…æ–‡ä»¶æ“ä½œéœ€è¦é€šè¿‡115ç½‘ç›˜API
4. **Tokenåˆ·æ–°**: 115ç½‘ç›˜Tokenä¼šè‡ªåŠ¨åˆ·æ–°ï¼Œæ— éœ€æ‰‹åŠ¨å¤„ç†
5. **Providerç¼“å­˜**: Providerå®ä¾‹ä¼šè¢«ç¼“å­˜ï¼Œæé«˜æ€§èƒ½

---

## ğŸ” æ•…éšœæ’é™¤

### 1. å¯†é’¥æœªé…ç½®é”™è¯¯

**é”™è¯¯**: "115ç½‘ç›˜å¯†é’¥æœªé…ç½®ï¼Œè¯·å…ˆåˆå§‹åŒ–å¯†é’¥"

**è§£å†³**: è¿è¡Œåˆå§‹åŒ–è„šæœ¬
```bash
python backend/scripts/init_cloud_storage.py
```

### 2. RCloneæœªå®‰è£…é”™è¯¯

**é”™è¯¯**: "RCloneæœªå®‰è£…æˆ–ä¸å¯ç”¨"

**è§£å†³**: å®‰è£…RClone
```bash
# æ£€æŸ¥RCloneæ˜¯å¦å®‰è£…
rclone version

# å¦‚æœæœªå®‰è£…ï¼Œæ ¹æ®ç³»ç»Ÿå®‰è£…RClone
```

### 3. æ•°æ®åº“è¡¨ä¸å­˜åœ¨é”™è¯¯

**é”™è¯¯**: "è¡¨ cloud_storages ä¸å­˜åœ¨"

**è§£å†³**: è¿è¡Œæ•°æ®åº“è¿ç§»
```bash
python backend/migrate_add_cloud_storage.py
```

### 4. Tokenè¿‡æœŸé”™è¯¯

**é”™è¯¯**: "ä»¤ç‰Œå·²è¿‡æœŸä¸”æ— æ³•åˆ·æ–°ï¼Œè¯·é‡æ–°ç™»å½•"

**è§£å†³**: é‡æ–°ç”ŸæˆäºŒç»´ç å¹¶ç™»å½•

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [115ç½‘ç›˜é›†æˆæ–¹æ¡ˆåˆ†æ](./115ç½‘ç›˜é›†æˆæ–¹æ¡ˆåˆ†æ.md)
- [äº‘å­˜å‚¨é›†æˆè¿›åº¦æŠ¥å‘Š](./äº‘å­˜å‚¨é›†æˆè¿›åº¦æŠ¥å‘Š.md)
- [åŠŸèƒ½å®ŒæˆçŠ¶æ€æ€»è§ˆ](./åŠŸèƒ½å®ŒæˆçŠ¶æ€æ€»è§ˆ.md)

---

**æœ€åæ›´æ–°**: 2025-11-08  
**çŠ¶æ€**: åç«¯åŠŸèƒ½å·²å®Œæˆï¼Œå‰ç«¯ç•Œé¢å¾…å®ç°

