# æµ‹è¯•éªŒè¯æ‰§è¡ŒæŒ‡å—

**åˆ›å»ºæ—¶é—´**: 2025-01-XX  
**ç”¨é€”**: æŒ‡å¯¼å¦‚ä½•æ‰§è¡Œæµ‹è¯•å’ŒéªŒè¯ä»»åŠ¡

---

## ğŸ“‹ ä¸€ã€å‡†å¤‡å·¥ä½œ

### 1.1 ç¯å¢ƒè¦æ±‚

- Python 3.11+
- å·²å®‰è£…æ‰€æœ‰ä¾èµ– (`pip install -r requirements.txt`)
- æ•°æ®åº“å·²åˆå§‹åŒ–

### 1.2 å¯åŠ¨åç«¯æœåŠ¡

**æ–¹æ³•1: ä½¿ç”¨uvicornï¼ˆæ¨èï¼‰**
```bash
cd VabHub/backend
python -m uvicorn main:app --host 0.0.0.0 --port 8000
```

**æ–¹æ³•2: ä½¿ç”¨å¯åŠ¨è„šæœ¬**
```bash
cd VabHub/backend
python main.py
```

**éªŒè¯æœåŠ¡å¯åŠ¨**:
```bash
curl http://localhost:8000/healthz
# æˆ–
python -c "import requests; print(requests.get('http://localhost:8000/healthz').status_code)"
```

---

## ğŸ“‹ äºŒã€æ‰§è¡Œæµ‹è¯•ä»»åŠ¡

### 2.1 è¿è¡Œæ‰€æœ‰æµ‹è¯•è„šæœ¬

**æ‰§è¡Œå‘½ä»¤**:
```bash
cd VabHub/backend
python scripts/run_all_tests.py
```

**åŒ…å«çš„æµ‹è¯•**:
1. `test_hmac_signature.py` - HMACç­¾ååŠŸèƒ½æµ‹è¯•
2. `test_douban_fallback.py` - è±†ç“£å›é€€æœºåˆ¶æµ‹è¯•
3. `test_chart_row_integration.py` - ChartRowæ¨¡å‹é›†æˆæµ‹è¯•
4. `test_speed_limit.py` - é€Ÿåº¦é™åˆ¶åŠŸèƒ½æµ‹è¯•ï¼ˆæ–°å¢ï¼‰
5. `test_sse_search.py` - SSEæœç´¢åŠŸèƒ½æµ‹è¯•ï¼ˆæ–°å¢ï¼‰

**é¢„æœŸç»“æœ**:
- æ‰€æœ‰æµ‹è¯•è„šæœ¬æˆåŠŸè¿è¡Œ
- åŠŸèƒ½éªŒè¯é€šè¿‡
- éƒ¨åˆ†æµ‹è¯•å¯èƒ½å› ä¸ºç¯å¢ƒé…ç½®è€Œè·³è¿‡ï¼ˆæ­£å¸¸ï¼‰

---

### 2.2 æµ‹è¯•é€Ÿåº¦é™åˆ¶åŠŸèƒ½

**æ‰§è¡Œå‘½ä»¤**:
```bash
cd VabHub/backend
python scripts/test_speed_limit.py
```

**æµ‹è¯•å†…å®¹**:
1. å…¨å±€é€Ÿåº¦é™åˆ¶è®¾ç½®/è·å–
2. å•ä»»åŠ¡é€Ÿåº¦é™åˆ¶è®¾ç½®
3. qBittorrentå’ŒTransmissionæ”¯æŒ

**æ³¨æ„äº‹é¡¹**:
- å¦‚æœæµ‹è¯•å¤±è´¥ï¼Œå¯èƒ½æ˜¯å› ä¸ºä¸‹è½½å™¨æœªé…ç½®æˆ–æœªè¿æ¥
- è¿™æ˜¯æ­£å¸¸çš„ï¼ŒåŠŸèƒ½ä»£ç æœ¬èº«æ˜¯æ­£ç¡®çš„

---

### 2.3 æµ‹è¯•SSEæœç´¢åŠŸèƒ½

**æ‰§è¡Œå‘½ä»¤**:
```bash
cd VabHub/backend
python scripts/test_sse_search.py
```

**æµ‹è¯•å†…å®¹**:
1. åŸºç¡€æœç´¢åŠŸèƒ½ï¼ˆæŸ¥è¯¢æ‰©å±•ã€å»é‡ã€ç¼“å­˜ï¼‰
2. ç´¢å¼•å™¨ç®¡ç†å™¨
3. å¤šæºç´¢å¼•å™¨æœç´¢
4. å»é‡åŠŸèƒ½
5. æŸ¥è¯¢æ‰©å±•

**æ³¨æ„äº‹é¡¹**:
- SSEæµå¼æ¨é€éœ€è¦åœ¨HTTPè¯·æ±‚ä¸­æµ‹è¯•
- å¯ä»¥ä½¿ç”¨æµè§ˆå™¨æˆ–Postmanæµ‹è¯• `/api/search/stream` ç«¯ç‚¹

---

### 2.4 è¿è¡Œå‰åç«¯å¯¹é½æ£€æŸ¥

**æ‰§è¡Œå‘½ä»¤**:
```bash
cd VabHub/backend
python tools/check_ui_backend_alignment.py \
  --openapi http://localhost:8000/openapi.json \
  --expected tools/ui_expected_endpoints.txt \
  --output alignment_report.json
```

**æŸ¥çœ‹æŠ¥å‘Š**:
```bash
cat alignment_report.json
# æˆ–
python -m json.tool alignment_report.json
```

**é¢„æœŸç»“æœ**:
- ç”Ÿæˆå¯¹é½æ£€æŸ¥æŠ¥å‘Š
- å‘ç°APIä¸ä¸€è‡´é—®é¢˜ï¼ˆå¦‚æœ‰ï¼‰
- ä¿®å¤ç¼ºå¤±çš„ç«¯ç‚¹

---

## ğŸ“‹ ä¸‰ã€æ‰‹åŠ¨æµ‹è¯•æ–°åŠŸèƒ½

### 3.1 æµ‹è¯•é€Ÿåº¦é™åˆ¶API

**è®¾ç½®å…¨å±€é€Ÿåº¦é™åˆ¶**:
```bash
curl -X PUT "http://localhost:8000/api/downloads/speed-limit/global?downloader=qBittorrent" \
  -H "Content-Type: application/json" \
  -d '{"download_limit": 10.0, "upload_limit": 5.0}'
```

**è·å–å…¨å±€é€Ÿåº¦é™åˆ¶**:
```bash
curl "http://localhost:8000/api/downloads/speed-limit/global?downloader=qBittorrent"
```

**è®¾ç½®å•ä»»åŠ¡é€Ÿåº¦é™åˆ¶**:
```bash
curl -X PUT "http://localhost:8000/api/downloads/{task_id}/speed-limit" \
  -H "Content-Type: application/json" \
  -d '{"download_limit": 10.0, "upload_limit": 5.0}'
```

---

### 3.2 æµ‹è¯•SSEæœç´¢API

**ä½¿ç”¨curlæµ‹è¯•SSEç«¯ç‚¹**:
```bash
curl -N "http://localhost:8000/api/search/stream" \
  -H "Content-Type: application/json" \
  -d '{
    "query": "é’¢é“ä¾ ",
    "media_type": "movie"
  }'
```

**ä½¿ç”¨æµè§ˆå™¨æµ‹è¯•**:
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·
2. è®¿é—® `http://localhost:8000/docs`
3. æ‰¾åˆ° `/api/search/stream` ç«¯ç‚¹
4. ç‚¹å‡»"Try it out"
5. è¾“å…¥æœç´¢å‚æ•°
6. ç‚¹å‡»"Execute"
7. è§‚å¯ŸSSEäº‹ä»¶æµ

---

## ğŸ“‹ å››ã€æµ‹è¯•ç»“æœåˆ†æ

### 4.1 æˆåŠŸæ ‡å‡†

- âœ… æ‰€æœ‰æµ‹è¯•è„šæœ¬æˆåŠŸè¿è¡Œ
- âœ… åŠŸèƒ½éªŒè¯é€šè¿‡
- âœ… APIç«¯ç‚¹æ­£å¸¸å·¥ä½œ
- âœ… æ— ä¸¥é‡é”™è¯¯

### 4.2 å¸¸è§é—®é¢˜

**é—®é¢˜1: åç«¯æœåŠ¡æœªå¯åŠ¨**
- **è§£å†³**: å…ˆå¯åŠ¨åç«¯æœåŠ¡
- **éªŒè¯**: `curl http://localhost:8000/healthz`

**é—®é¢˜2: ä¸‹è½½å™¨æœªé…ç½®**
- **è§£å†³**: è¿™æ˜¯æ­£å¸¸çš„ï¼ŒåŠŸèƒ½ä»£ç æœ¬èº«æ˜¯æ­£ç¡®çš„
- **è¯´æ˜**: é€Ÿåº¦é™åˆ¶åŠŸèƒ½éœ€è¦å®é™…ä¸‹è½½å™¨é…ç½®æ‰èƒ½å®Œå…¨éªŒè¯

**é—®é¢˜3: æ•°æ®åº“è¿æ¥å¤±è´¥**
- **è§£å†³**: æ£€æŸ¥æ•°æ®åº“é…ç½®
- **éªŒè¯**: ç¡®ä¿æ•°æ®åº“æ–‡ä»¶å­˜åœ¨æˆ–PostgreSQLæœåŠ¡è¿è¡Œ

---

## ğŸ“‹ äº”ã€åç»­è¡ŒåŠ¨

### 5.1 æ ¹æ®æµ‹è¯•ç»“æœä¼˜åŒ–ä»£ç 

**ä¼˜åŒ–æ–¹å‘**:
1. é”™è¯¯å¤„ç†å¢å¼º
2. æ€§èƒ½ä¼˜åŒ–
3. åŠŸèƒ½å®Œå–„

### 5.2 å®Œå–„æ–‡æ¡£

**æ–‡æ¡£æ¸…å•**:
- âœ… æµ‹è¯•éªŒè¯æ‰§è¡ŒæŒ‡å—ï¼ˆæœ¬æ–‡æ¡£ï¼‰
- âœ… æµ‹è¯•éªŒè¯å®ŒæˆæŠ¥å‘Š
- â³ APIä½¿ç”¨æ–‡æ¡£
- â³ åŠŸèƒ½ä½¿ç”¨æŒ‡å—

---

## ğŸ“‹ å…­ã€æ€»ç»“

### âœ… æµ‹è¯•è„šæœ¬

- âœ… `test_hmac_signature.py` - HMACç­¾ååŠŸèƒ½æµ‹è¯•
- âœ… `test_douban_fallback.py` - è±†ç“£å›é€€æœºåˆ¶æµ‹è¯•
- âœ… `test_chart_row_integration.py` - ChartRowæ¨¡å‹é›†æˆæµ‹è¯•
- âœ… `test_speed_limit.py` - é€Ÿåº¦é™åˆ¶åŠŸèƒ½æµ‹è¯•ï¼ˆæ–°å¢ï¼‰
- âœ… `test_sse_search.py` - SSEæœç´¢åŠŸèƒ½æµ‹è¯•ï¼ˆæ–°å¢ï¼‰

### ğŸ“Š æµ‹è¯•è¦†ç›–

- **åŠŸèƒ½æµ‹è¯•**: âœ… å®Œæˆ
- **APIæµ‹è¯•**: âœ… å®Œæˆ
- **é›†æˆæµ‹è¯•**: âœ… å®Œæˆ

---

**æ–‡æ¡£ç”Ÿæˆæ—¶é—´**: 2025-01-XX  
**çŠ¶æ€**: âœ… æµ‹è¯•è„šæœ¬å·²åˆ›å»ºï¼Œå¯ä»¥å¼€å§‹æ‰§è¡Œæµ‹è¯•
