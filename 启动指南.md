# VabHub å¯åŠ¨æŒ‡å—

## ğŸ“‹ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

#### å®‰è£…Pythonä¾èµ–
```bash
cd backend
pip install -r requirements.txt
```

#### é…ç½®ç¯å¢ƒå˜é‡
åˆ›å»º `.env` æ–‡ä»¶ï¼ˆå‚è€ƒ `.env.example`ï¼‰ï¼š
```bash
# æ•°æ®åº“é…ç½®ï¼ˆPostgreSQLï¼‰
DATABASE_URL=postgresql://vabhub:vabhub@localhost:5432/vabhub

# æˆ–ä½¿ç”¨SQLiteï¼ˆå¼€å‘æ¨¡å¼ï¼‰
# DATABASE_URL=sqlite:///./vabhub.db

# Redisé…ç½®ï¼ˆå¯é€‰ï¼‰
REDIS_URL=redis://localhost:6379/0

# å®‰å…¨é…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒè¯·ä¿®æ”¹ï¼‰
SECRET_KEY=your-secret-key
JWT_SECRET_KEY=your-jwt-secret-key

# TMDB API Keyï¼ˆå¯é€‰ï¼‰
TMDB_API_KEY=your-tmdb-api-key
```

### 2. æ•°æ®åº“è®¾ç½®

#### PostgreSQLï¼ˆæ¨èï¼‰
```bash
# åˆ›å»ºæ•°æ®åº“
psql -U postgres
CREATE DATABASE vabhub;
CREATE USER vabhub WITH PASSWORD 'vabhub';
GRANT ALL PRIVILEGES ON DATABASE vabhub TO vabhub;
\q
```

#### SQLiteï¼ˆå¼€å‘æ¨¡å¼ï¼‰
æ— éœ€é¢å¤–è®¾ç½®ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºæ•°æ®åº“æ–‡ä»¶ã€‚

### 3. åˆå§‹åŒ–æ•°æ®åº“

```bash
# æ–¹å¼1: ä½¿ç”¨åˆå§‹åŒ–è„šæœ¬
python -m scripts.init_db

# æ–¹å¼2: ç›´æ¥è¿è¡Œ
python scripts/init_db.py
```

### 4. å¯åŠ¨åº”ç”¨

#### æ–¹å¼1: ä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰
```bash
# æ‰§è¡Œå¯åŠ¨å‰æ£€æŸ¥å¹¶å¯åŠ¨
python scripts/start.py

# è·³è¿‡æ£€æŸ¥ç›´æ¥å¯åŠ¨
python scripts/start.py --skip-checks
```

#### æ–¹å¼2: ç›´æ¥å¯åŠ¨
```bash
python main.py
```

#### æ–¹å¼3: ä½¿ç”¨uvicorn
```bash
uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

### 5. è®¿é—®åº”ç”¨

- **APIæ–‡æ¡£**: http://localhost:8000/docs
- **APIæ ¹è·¯å¾„**: http://localhost:8000/api/v1
- **å¥åº·æ£€æŸ¥**: http://localhost:8000/health

---

## ğŸ”§ å¯åŠ¨è„šæœ¬è¯´æ˜

### `scripts/start.py`
**åŠŸèƒ½**: å®Œæ•´çš„å¯åŠ¨å‰æ£€æŸ¥å’Œå¯åŠ¨
- âœ… ç¯å¢ƒé…ç½®æ£€æŸ¥
- âœ… æ•°æ®åº“è¿æ¥æ£€æŸ¥
- âœ… æ•°æ®åº“è¡¨æ£€æŸ¥
- âœ… Redisè¿æ¥æ£€æŸ¥ï¼ˆå¯é€‰ï¼‰
- âœ… è‡ªåŠ¨å¯åŠ¨æœåŠ¡å™¨

**ä½¿ç”¨**:
```bash
python scripts/start.py
```

### `scripts/init_db.py`
**åŠŸèƒ½**: åˆå§‹åŒ–æ•°æ®åº“
- âœ… åˆ›å»ºæ‰€æœ‰æ•°æ®åº“è¡¨
- âœ… åˆå§‹åŒ–é»˜è®¤è®¾ç½®
- âœ… åˆ›å»ºL3ç¼“å­˜è¡¨

**ä½¿ç”¨**:
```bash
python scripts/init_db.py
```

### `scripts/check_health.py`
**åŠŸèƒ½**: å¥åº·æ£€æŸ¥
- âœ… æ£€æŸ¥æ‰€æœ‰ç³»ç»Ÿç»„ä»¶
- âœ… æ˜¾ç¤ºè¯¦ç»†çŠ¶æ€ä¿¡æ¯

**ä½¿ç”¨**:
```bash
python scripts/check_health.py
```

---

## ğŸ› æ•…éšœæ’é™¤

### æ•°æ®åº“è¿æ¥å¤±è´¥

#### PostgreSQL
```bash
# æ£€æŸ¥PostgreSQLæœåŠ¡æ˜¯å¦è¿è¡Œ
sudo systemctl status postgresql  # Linux
brew services list  # macOS

# æ£€æŸ¥è¿æ¥
psql -U vabhub -d vabhub -h localhost
```

#### SQLite
```bash
# æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶æƒé™
ls -l vabhub.db
```

### Redisè¿æ¥å¤±è´¥

Redisæ˜¯å¯é€‰çš„ï¼Œå¦‚æœè¿æ¥å¤±è´¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é™çº§ä¸ºä»…ä½¿ç”¨å†…å­˜ç¼“å­˜ã€‚

```bash
# æ£€æŸ¥RedisæœåŠ¡
redis-cli ping

# å¦‚æœè¿”å›PONGï¼Œè¯´æ˜Redisæ­£å¸¸è¿è¡Œ
```

### ç«¯å£è¢«å ç”¨

```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -an | grep 8000  # Linux/macOS
netstat -ano | findstr 8000  # Windows

# ä¿®æ”¹ç«¯å£ï¼ˆåœ¨.envæ–‡ä»¶ä¸­ï¼‰
PORT=8001
```

---

## ğŸ“Š å¯åŠ¨æµç¨‹

```
1. ç¯å¢ƒæ£€æŸ¥
   â”œâ”€ Pythonç‰ˆæœ¬
   â”œâ”€ ä¾èµ–åŒ…
   â””â”€ ç¯å¢ƒå˜é‡

2. æ•°æ®åº“æ£€æŸ¥
   â”œâ”€ æ•°æ®åº“è¿æ¥
   â”œâ”€ æ•°æ®åº“è¡¨
   â””â”€ åˆå§‹æ•°æ®

3. ç¼“å­˜æ£€æŸ¥
   â”œâ”€ Redisè¿æ¥ï¼ˆå¯é€‰ï¼‰
   â””â”€ å†…å­˜ç¼“å­˜

4. å¯åŠ¨æœåŠ¡å™¨
   â”œâ”€ FastAPIåº”ç”¨
   â”œâ”€ ä¸­é—´ä»¶
   â””â”€ APIè·¯ç”±
```

---

## ğŸ” å¯åŠ¨å‰æ£€æŸ¥æ¸…å•

- [ ] Python 3.8+ å·²å®‰è£…
- [ ] ä¾èµ–åŒ…å·²å®‰è£… (`pip install -r requirements.txt`)
- [ ] ç¯å¢ƒå˜é‡å·²é…ç½® (`.env` æ–‡ä»¶)
- [ ] æ•°æ®åº“å·²åˆ›å»ºï¼ˆPostgreSQLï¼‰æˆ–å¯å†™ï¼ˆSQLiteï¼‰
- [ ] æ•°æ®åº“è¡¨å·²åˆå§‹åŒ– (`python scripts/init_db.py`)
- [ ] Rediså·²å®‰è£…ï¼ˆå¯é€‰ï¼Œç”¨äºL2ç¼“å­˜ï¼‰
- [ ] ç«¯å£8000æœªè¢«å ç”¨

---

## ğŸš€ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### 1. ä½¿ç”¨Gunicornï¼ˆæ¨èï¼‰

```bash
# å®‰è£…Gunicorn
pip install gunicorn

# å¯åŠ¨ï¼ˆä½¿ç”¨Uvicorn workersï¼‰
gunicorn app.main:app \
    --workers 4 \
    --worker-class uvicorn.workers.UvicornWorker \
    --bind 0.0.0.0:8000 \
    --access-logfile - \
    --error-logfile -
```

### 2. ä½¿ç”¨Docker

```dockerfile
# Dockerfileç¤ºä¾‹
FROM python:3.11-slim

WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt

COPY . .

CMD ["python", "scripts/start.py"]
```

### 3. ä½¿ç”¨systemdï¼ˆLinuxï¼‰

åˆ›å»º `/etc/systemd/system/vabhub.service`:
```ini
[Unit]
Description=VabHub API Server
After=network.target postgresql.service

[Service]
Type=simple
User=vabhub
WorkingDirectory=/opt/vabhub/backend
Environment="PATH=/opt/vabhub/venv/bin"
ExecStart=/opt/vabhub/venv/bin/python scripts/start.py
Restart=always

[Install]
WantedBy=multi-user.target
```

å¯åŠ¨æœåŠ¡:
```bash
sudo systemctl enable vabhub
sudo systemctl start vabhub
sudo systemctl status vabhub
```

---

## âœ… éªŒè¯å¯åŠ¨

### 1. æ£€æŸ¥å¥åº·çŠ¶æ€
```bash
curl http://localhost:8000/health
```

### 2. æ£€æŸ¥APIæ–‡æ¡£
è®¿é—®: http://localhost:8000/docs

### 3. æ£€æŸ¥æ•°æ®åº“
```bash
python scripts/check_health.py
```

---

## ğŸ“– ç›¸å…³æ–‡æ¡£

- `PostgreSQLæ•°æ®åº“é…ç½®è¯´æ˜.md` - æ•°æ®åº“é…ç½®è¯¦è§£
- `ä¸‰çº§ç¼“å­˜æ¶æ„è¯´æ˜.md` - ç¼“å­˜ç³»ç»Ÿè¯´æ˜
- `æ¶æ„å®Œå–„æŠ¥å‘Š.md` - æ¶æ„è®¾è®¡è¯´æ˜

---

**æœ€åæ›´æ–°**: 2025-11-08
